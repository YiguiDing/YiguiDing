import{_ as s,c as a,e as p,o as t}from"./app-CHjqYunX.js";const e={};function c(l,n){return t(),a("div",null,n[0]||(n[0]=[p(`<p><strong>容量计算</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">SegmentTree</span> <span class="token punctuation">{</span></span>
<span class="line"> <span class="token keyword">int</span> data<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token keyword">int</span> arrLength<span class="token punctuation">;</span></span>
<span class="line"> <span class="token keyword">int</span> capacity<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> <span class="token class-name">SegmentTree</span><span class="token punctuation">(</span><span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 层数就是 1 + ceil( log_2(end-start+1) )</span></span>
<span class="line">  <span class="token keyword">double</span> layer <span class="token operator">=</span> <span class="token number">1d</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token function">log_2</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 满二叉树元素个数,个层元素数的和，等比数列求和：S_n = a1*((1-q^n)/(1-q)) 公比：q = 2</span></span>
<span class="line">  <span class="token keyword">double</span> capacity <span class="token operator">=</span> <span class="token number">1d</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1d</span> <span class="token operator">-</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2d</span><span class="token punctuation">,</span> layer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1d</span> <span class="token operator">-</span> <span class="token number">2d</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>arrLength <span class="token operator">=</span> length<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>capacity<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>capacity<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="完整实现" tabindex="-1"><a class="header-anchor" href="#完整实现"><span>完整实现</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> 线段树的实现 <span class="token punctuation">{</span></span>
<span class="line"> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token class-name">SegmentTree</span> st <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SegmentTree</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 长度为 5 的线段树的结构 index:[start,end]</span></span>
<span class="line">  <span class="token comment">// ----------------------0:[0,4]</span></span>
<span class="line">  <span class="token comment">// -------------1:[0,2]-----------2:[3,4]</span></span>
<span class="line">  <span class="token comment">// -------3:[0,1]----4:[2,2]---5:[3,3]-----6:[4,4]</span></span>
<span class="line">  <span class="token comment">// ---7:[0,0]-7:[1,1]</span></span>
<span class="line"></span>
<span class="line">  st<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 非递归方式在0的位置统计元素</span></span>
<span class="line">  <span class="token comment">// 输出：</span></span>
<span class="line">  <span class="token comment">// 插入操作</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,4],1]</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,2],1]</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,1],1]</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,0],1]</span></span>
<span class="line">  st<span class="token punctuation">.</span><span class="token function">insert_r</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 递归方式在1的位置统计元素</span></span>
<span class="line">  <span class="token comment">// 输出：</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,4],2]</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,2],2]</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,1],2]</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[1,1],1]</span></span>
<span class="line">  st<span class="token punctuation">.</span><span class="token function">query_r</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 输出：</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,4],2]</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,2],2]</span></span>
<span class="line">  <span class="token comment">// debug:[[left,right],value]:[[0,1],2]</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">SegmentTree</span> <span class="token punctuation">{</span></span>
<span class="line"> <span class="token keyword">int</span> data<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token keyword">int</span> arrLength<span class="token punctuation">;</span></span>
<span class="line"> <span class="token keyword">int</span> capacity<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> <span class="token class-name">SegmentTree</span><span class="token punctuation">(</span><span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 层数就是 1 + ceil( log_2(end-start+1) )</span></span>
<span class="line">  <span class="token keyword">double</span> layer <span class="token operator">=</span> <span class="token number">1d</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token function">log_2</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 满二叉树元素个数,个层元素数的和，等比数列求和：S_n = a1*((1-q^n)/(1-q)) 公比：q = 2</span></span>
<span class="line">  <span class="token keyword">double</span> capacity <span class="token operator">=</span> <span class="token number">1d</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1d</span> <span class="token operator">-</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2d</span><span class="token punctuation">,</span> layer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1d</span> <span class="token operator">-</span> <span class="token number">2d</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>arrLength <span class="token operator">=</span> length<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>capacity<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>capacity<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"> <span class="token comment">// 非递归方式的插入</span></span>
<span class="line"> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> targetIdx<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> targetIdx <span class="token operator">&amp;&amp;</span> targetIdx <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>arrLength<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">   <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> right <span class="token operator">=</span> arrLength <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> mid <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> curIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   data<span class="token punctuation">[</span>curIdx<span class="token punctuation">]</span> <span class="token operator">+=</span> num<span class="token punctuation">;</span><span class="token comment">// 自增</span></span>
<span class="line">   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;debug:[[left,right],value]:[[%d,%d],%d]\\n&quot;</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> data<span class="token punctuation">[</span>curIdx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">   <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">==</span> left<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 到达叶节点</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">   <span class="token comment">// 计算下一轮的位置信息。</span></span>
<span class="line">   <span class="token comment">// 第i个节点的左子树的是2i+1 右子树是2i+2</span></span>
<span class="line">   <span class="token comment">// ----------------------0:[0,4]</span></span>
<span class="line">   <span class="token comment">// -------------1:[0,2]-----------2:[3,4]</span></span>
<span class="line">   <span class="token comment">// -------3:[0,1]----4:[2,2]---5:[3,3]-----6:[4,4]</span></span>
<span class="line">   <span class="token comment">// ---7:[0,0]-7:[1,1]</span></span>
<span class="line">   <span class="token comment">// 计算中间位置</span></span>
<span class="line">   mid <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token comment">// 注意第一个是小于等于</span></span>
<span class="line">   <span class="token keyword">if</span> <span class="token punctuation">(</span>targetIdx <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    right <span class="token operator">=</span> mid<span class="token punctuation">;</span></span>
<span class="line">    curIdx <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 进入左子树</span></span>
<span class="line">   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>targetIdx <span class="token operator">&gt;</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    curIdx <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">// 进入右子树</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"> <span class="token comment">// 递归方式版</span></span>
<span class="line"> <span class="token keyword">void</span> <span class="token function">insert_r</span><span class="token punctuation">(</span><span class="token keyword">int</span> targetIdx<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">insert_r</span><span class="token punctuation">(</span>targetIdx<span class="token punctuation">,</span> num<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arrLength <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"> <span class="token comment">// 递归方式版</span></span>
<span class="line"> <span class="token keyword">void</span> <span class="token function">insert_r</span><span class="token punctuation">(</span><span class="token keyword">int</span> targetIdx<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">int</span> curIdx<span class="token punctuation">,</span> <span class="token keyword">int</span> curLeft<span class="token punctuation">,</span> <span class="token keyword">int</span> curRight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>curLeft <span class="token operator">&lt;=</span> curRight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">   data<span class="token punctuation">[</span>curIdx<span class="token punctuation">]</span> <span class="token operator">+=</span> num<span class="token punctuation">;</span><span class="token comment">// 自增</span></span>
<span class="line">   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;debug:[[left,right],value]:[[%d,%d],%d]\\n&quot;</span><span class="token punctuation">,</span> curLeft<span class="token punctuation">,</span> curRight<span class="token punctuation">,</span> data<span class="token punctuation">[</span>curIdx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">   <span class="token comment">// 未到达叶节点</span></span>
<span class="line">   <span class="token keyword">if</span> <span class="token punctuation">(</span>curLeft <span class="token operator">!=</span> curRight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 计算下一轮的位置信息。</span></span>
<span class="line">    <span class="token comment">// 第i个节点的左子树的是2i+1 右子树是2i+2</span></span>
<span class="line">    <span class="token comment">// ----------------------0:[0,4]</span></span>
<span class="line">    <span class="token comment">// -------------1:[0,2]-----------2:[3,4]</span></span>
<span class="line">    <span class="token comment">// -------3:[0,1]----4:[2,2]---5:[3,3]-----6:[4,4]</span></span>
<span class="line">    <span class="token comment">// ---7:[0,0]-7:[1,1]</span></span>
<span class="line">    <span class="token comment">// 计算中间位置</span></span>
<span class="line">    <span class="token keyword">int</span> curMid <span class="token operator">=</span> curLeft <span class="token operator">+</span> <span class="token punctuation">(</span>curRight <span class="token operator">-</span> curLeft<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 注意第一个是小于等于</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetIdx <span class="token operator">&lt;=</span> curMid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">     <span class="token comment">// 进入左子树</span></span>
<span class="line">     <span class="token function">insert_r</span><span class="token punctuation">(</span>targetIdx<span class="token punctuation">,</span> num<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> curLeft<span class="token punctuation">,</span> curMid<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>targetIdx <span class="token operator">&gt;</span> curMid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">     <span class="token comment">// 进入右子树</span></span>
<span class="line">     <span class="token function">insert_r</span><span class="token punctuation">(</span>targetIdx<span class="token punctuation">,</span> num<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> curMid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> curRight<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"> <span class="token comment">// 可以查找任意区间的统计结果,递归方式</span></span>
<span class="line"> <span class="token keyword">int</span> <span class="token function">query_r</span><span class="token punctuation">(</span><span class="token keyword">int</span> targetLeft<span class="token punctuation">,</span> <span class="token keyword">int</span> targetRight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">query_r</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arrLength <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> targetLeft<span class="token punctuation">,</span> targetRight<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"> <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">query_r</span><span class="token punctuation">(</span><span class="token keyword">int</span> curIdx<span class="token punctuation">,</span> <span class="token keyword">int</span> curLeft<span class="token punctuation">,</span> <span class="token keyword">int</span> curRight<span class="token punctuation">,</span> <span class="token keyword">int</span> targetLeft<span class="token punctuation">,</span> <span class="token keyword">int</span> targetRight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>curLeft <span class="token operator">&lt;=</span> curRight <span class="token operator">&amp;&amp;</span> <span class="token comment">// 过滤非法的当前区间</span></span>
<span class="line">    targetLeft <span class="token operator">&lt;=</span> targetRight<span class="token comment">// 过滤非法的目标区间</span></span>
<span class="line">  <span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;debug:[[left,right],value]:[[%d,%d],%d]\\n&quot;</span><span class="token punctuation">,</span> curLeft<span class="token punctuation">,</span> curRight<span class="token punctuation">,</span> data<span class="token punctuation">[</span>curIdx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">   <span class="token keyword">if</span> <span class="token punctuation">(</span>curLeft <span class="token operator">==</span> targetLeft <span class="token operator">&amp;&amp;</span> targetRight <span class="token operator">==</span> curRight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 所查找的区间和当前所在区间完全匹配,直接返回其统计结果</span></span>
<span class="line">    <span class="token keyword">return</span> data<span class="token punctuation">[</span>curIdx<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> mid <span class="token operator">=</span> curLeft <span class="token operator">+</span> <span class="token punctuation">(</span>curRight <span class="token operator">-</span> curLeft<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetRight <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">     <span class="token comment">// 查找的区间在左子树</span></span>
<span class="line">     k <span class="token operator">+=</span> <span class="token function">query_r</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> curLeft<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> targetLeft<span class="token punctuation">,</span> targetRight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 左子树查询</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mid <span class="token operator">&lt;</span> targetLeft<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">     <span class="token comment">// 查找的区间在右子树</span></span>
<span class="line">     k <span class="token operator">+=</span> <span class="token function">query_r</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> curRight<span class="token punctuation">,</span> targetLeft<span class="token punctuation">,</span> targetRight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 右子树查询</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">     <span class="token comment">// 查找的区间横跨左右子树,则分别去查找</span></span>
<span class="line">     k <span class="token operator">+=</span> <span class="token function">query_r</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> curLeft<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> targetLeft<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 左子树查询</span></span>
<span class="line">     k <span class="token operator">+=</span> <span class="token function">query_r</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> curRight<span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> targetRight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 右子树查询</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> k<span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">log_2</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// &gt; 需要使用换底公式：log_A{B} = log_n{B}/log_n{A}</span></span>
<span class="line">  <span class="token comment">// &gt; 即log_2{B} = log_n{B}/log_n{2}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"> <span class="token comment">// 这种查找方式不能查找横跨中间位置的区间,没什么用。</span></span>
<span class="line"> <span class="token keyword">int</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">int</span> targetLeft<span class="token punctuation">,</span> <span class="token keyword">int</span> targetRight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>targetLeft <span class="token operator">&gt;</span> targetRight<span class="token punctuation">)</span></span>
<span class="line">   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> right <span class="token operator">=</span> arrLength <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> mid <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> curIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;debug:[[left,mid,right],value]:[[%d,%d,%d],%d]\\n&quot;</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> right<span class="token punctuation">,</span> data<span class="token punctuation">[</span>curIdx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> targetLeft <span class="token operator">&amp;&amp;</span> right <span class="token operator">==</span> targetRight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 到达目标位置</span></span>
<span class="line">    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">   <span class="token comment">// 计算下一轮的信息</span></span>
<span class="line">   mid <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token keyword">if</span> <span class="token punctuation">(</span>targetRight <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    right <span class="token operator">=</span> mid<span class="token punctuation">;</span></span>
<span class="line">    curIdx <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 进入左子树</span></span>
<span class="line">   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>targetLeft <span class="token operator">&gt;</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    curIdx <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> curIdx <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">// 进入右子树</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> data<span class="token punctuation">[</span>curIdx<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4)]))}const i=s(e,[["render",c],["__file","线段树的实现.html.vue"]]),u=JSON.parse('{"path":"/%E7%AE%97%E6%B3%95/zip%E5%BD%92%E6%A1%A3/%E7%BA%BF%E6%AE%B5%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0/%E7%BA%BF%E6%AE%B5%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0.html","title":"线段树的实现","lang":"zh-CN","frontmatter":{"date":"2023-03-08T20:58:00.000Z","title":"线段树的实现","cover":"./cover/default_cover.jpg","tag":["蓝桥杯","JAVA","算法","刷题笔记"],"category":"算法","description":"线段树的实现 结构 一个线段树的案例： 层数 层数 划分后的元素个数是之前元素个数的一半， 划分多少次就是 log(元素个数)， 另外根节点也算一层 层数就是 1 + ceil( log_2(end-start+1) ) 注大意 java 中，Math.log() 计算的是 log_e 要计算 log_2 需要使用换底公式：log_A{B} = log...","head":[["meta",{"property":"og:url","content":"https://dingdingdang.online/%E7%AE%97%E6%B3%95/zip%E5%BD%92%E6%A1%A3/%E7%BA%BF%E6%AE%B5%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0/%E7%BA%BF%E6%AE%B5%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0.html"}],["meta",{"property":"og:site_name","content":"YiguiDing的Blog小站"}],["meta",{"property":"og:title","content":"线段树的实现"}],["meta",{"property":"og:description","content":"线段树的实现 结构 一个线段树的案例： 层数 层数 划分后的元素个数是之前元素个数的一半， 划分多少次就是 log(元素个数)， 另外根节点也算一层 层数就是 1 + ceil( log_2(end-start+1) ) 注大意 java 中，Math.log() 计算的是 log_e 要计算 log_2 需要使用换底公式：log_A{B} = log..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-03-18T08:31:16.000Z"}],["meta",{"property":"article:author","content":"丁毅桂"}],["meta",{"property":"article:tag","content":"蓝桥杯"}],["meta",{"property":"article:tag","content":"JAVA"}],["meta",{"property":"article:tag","content":"算法"}],["meta",{"property":"article:tag","content":"刷题笔记"}],["meta",{"property":"article:published_time","content":"2023-03-08T20:58:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-03-18T08:31:16.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"线段树的实现\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-03-08T20:58:00.000Z\\",\\"dateModified\\":\\"2024-03-18T08:31:16.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"丁毅桂\\",\\"email\\":\\"2449695354@qq.com\\"}]}"],["meta",{"name":"baidu-site-verification","content":"codeva-PwE9Ts6nMl"}]]},"headers":[{"level":2,"title":"结构","slug":"结构","link":"#结构","children":[]},{"level":2,"title":"层数","slug":"层数","link":"#层数","children":[]},{"level":2,"title":"容量","slug":"容量","link":"#容量","children":[]},{"level":2,"title":"完整实现","slug":"完整实现","link":"#完整实现","children":[]}],"git":{"createdTime":1700226391000,"updatedTime":1710750676000,"contributors":[{"name":"YiguiDing","email":"2449695354@qq.com","commits":1}]},"readingTime":{"minutes":5.04,"words":1512},"filePathRelative":"算法/zip归档/线段树的实现/线段树的实现.md","localizedDate":"2023年3月8日","excerpt":"","autoDesc":true}');export{i as comp,u as data};
