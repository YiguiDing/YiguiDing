import{_ as n,o as s,c as a,e as t}from"./app-SitNf3_1.js";const p={},o=t(`<h1 id="express配置web服务记录" tabindex="-1"><a class="header-anchor" href="#express配置web服务记录" aria-hidden="true">#</a> express配置web服务记录</h1><p><code>server.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> Express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// express</span>
<span class="token keyword">let</span> connect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;connect&quot;</span><span class="token punctuation">)</span><span class="token comment">// express 的connect 模块</span>
<span class="token keyword">let</span> vhost <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vhost&quot;</span><span class="token punctuation">)</span><span class="token comment">// express 的 vhost 模块 子域名支持</span>
<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express-http-proxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// express的http代理中间件</span>
<span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// nodejs 原生http模块</span>
<span class="token keyword">let</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;https&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// nodejs 原生https模块</span>
<span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ---------------------------------config:https---------------------------------</span>
<span class="token keyword">const</span> host <span class="token operator">=</span> <span class="token string">&quot;0.0.0.0&quot;</span>
<span class="token keyword">const</span> port_http <span class="token operator">=</span> <span class="token number">80</span>
<span class="token keyword">const</span> port_https <span class="token operator">=</span> <span class="token number">443</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> key <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./ssl/dingdingdang.online.key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pem <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./ssl/dingdingdang.online.pem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> key<span class="token punctuation">,</span> <span class="token literal-property property">cert</span><span class="token operator">:</span> pem <span class="token punctuation">}</span>
<span class="token comment">// ---------------------------------config:https---------------------------------</span>

<span class="token keyword">const</span> mainApp <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> blogApp <span class="token operator">=</span> <span class="token function">Express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&quot;./blog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> codeApp <span class="token operator">=</span> <span class="token function">Express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:8080&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 由于code-server 需要使用 http://127.0.0.1:8080 还需要使用 ws://127.0.0.1:8080 所以这里的写法是不完整的</span>
<span class="token keyword">const</span> fileApp <span class="token operator">=</span> <span class="token function">Express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:8081&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

mainApp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">vhost</span><span class="token punctuation">(</span><span class="token string">&quot;dingdingdang.online&quot;</span><span class="token punctuation">,</span> blogApp<span class="token punctuation">)</span><span class="token punctuation">)</span>
mainApp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">vhost</span><span class="token punctuation">(</span><span class="token string">&quot;www.dingdingdang.online&quot;</span><span class="token punctuation">,</span> blogApp<span class="token punctuation">)</span><span class="token punctuation">)</span>
mainApp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">vhost</span><span class="token punctuation">(</span><span class="token string">&quot;blog.dingdingdang.online&quot;</span><span class="token punctuation">,</span> blogApp<span class="token punctuation">)</span><span class="token punctuation">)</span>
mainApp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">vhost</span><span class="token punctuation">(</span><span class="token string">&quot;code.dingdingdang.online&quot;</span><span class="token punctuation">,</span> codeApp<span class="token punctuation">)</span><span class="token punctuation">)</span>
mainApp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">vhost</span><span class="token punctuation">(</span><span class="token string">&quot;file.dingdingdang.online&quot;</span><span class="token punctuation">,</span> fileApp<span class="token punctuation">)</span><span class="token punctuation">)</span>


http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>mainApp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port_http<span class="token punctuation">,</span> host<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">server is running at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>port_http<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

https<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> mainApp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port_https<span class="token punctuation">,</span> host<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">server is running at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>port_https<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),e=[o];function c(u,i){return s(),a("div",null,e)}const k=n(p,[["render",c],["__file","express配置子域名和https证书.html.vue"]]);export{k as default};
