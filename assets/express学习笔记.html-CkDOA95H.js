import{_ as t,r as h,c as e,a as s,d as a,w as n,e as i,b as E,o as d}from"./app-DTZtoZLC.js";const r="/assets/express%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-D6itj5hg.png",g="/assets/94e6281102dfa399e3de1d15a143647e4bdec8256d7ce39ebff2d5eb91fcee3f-Bjnk8mJp.png",y="/assets/05ed400ef4edde4dad65a33e9bf0c8354e53ddb3f963aabae9c53f4a1c7dd4aa-BRBn-y3U.png",C="/assets/a6285567a812d97f3fe90506e6993ed9f7e77ca9e06f3b5bcedbca35616fe252-BcrLxc9I.png",D="/assets/2022-11-24-09-21-34-DnV1iiFB.png",F={},c=E('<h1 id="express学习笔记" tabindex="-1"><a class="header-anchor" href="#express学习笔记"><span>express学习笔记</span></a></h1><p><img src="'+r+`" alt=""></p><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录"><span>目录</span></a></h2><ul><li><a href="#express%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">express学习笔记</a><ul><li><a href="#%E7%9B%AE%E5%BD%95">目录</a></li><li><a href="#%E6%A6%82%E5%BF%B5">概念</a></li><li><a href="#%E5%AE%9E%E7%8E%B0api%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1%E5%99%A8">实现API接口服务器</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E7%A4%BA%E4%BE%8Bpost-get-all-listen">基本示例:post get all listen</a></li><li><a href="#%E8%8E%B7%E5%8F%96url%E4%B8%AD%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0">获取URL中的<strong>查询参数</strong></a></li><li><a href="#%E8%8E%B7%E5%8F%96url%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81%E5%8F%82%E6%95%B0">获取URL中的<strong>动态参数</strong></a></li></ul></li><li><a href="#%E9%9D%99%E6%80%81web%E6%9C%8D%E5%8A%A1%E5%99%A8">静态web服务器</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><strong>基本使用示例</strong></a></li><li><a href="#%E6%89%98%E7%AE%A1%E5%A4%9A%E4%B8%AA%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5"><strong>托管多个静态网页</strong></a></li><li><a href="#%E6%8C%82%E8%BD%BD%E8%B7%AF%E5%BE%84%E5%89%8D%E7%BC%80"><strong>挂载路径前缀</strong></a></li></ul></li><li><a href="#%E8%B7%AF%E7%94%B1">路由</a><ul><li><a href="#%E6%A6%82%E5%BF%B5-1">概念</a></li><li><a href="#%E6%9C%80%E7%AE%80%E7%94%A8%E6%B3%95%E7%9B%B4%E6%8E%A5%E6%8C%82%E8%BD%BD%E5%88%B0app%E4%B8%8A"><strong>最简用法:直接挂载到app上</strong></a></li><li><a href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95%E5%B0%86%E8%B7%AF%E7%94%B1%E6%8A%BD%E7%A6%BB%E4%B8%BA%E5%8D%95%E7%8B%AC%E6%A8%A1%E5%9D%97"><strong>高级用法:将路由抽离为单独模块</strong></a></li><li><a href="#%E4%B8%BA%E8%B7%AF%E7%94%B1%E6%B7%BB%E5%8A%A0%E8%AE%BF%E9%97%AE%E5%89%8D%E7%BC%80">为路由添加访问前缀</a></li></ul></li><li><a href="#%E4%B8%AD%E9%97%B4%E4%BB%B6">中间件</a><ul><li><a href="#%E6%A6%82%E5%BF%B5-2">概念</a></li><li><a href="#%E7%A4%BA%E4%BE%8B">示例</a></li><li><a href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E5%88%86%E7%B1%BB"><strong>中间件的分类</strong></a></li><li><a href="#%E5%BA%94%E7%94%A8%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6"><strong>应用级别中间件</strong></a></li><li><a href="#%E8%B7%AF%E7%94%B1%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6"><strong>路由级别中间件</strong></a></li><li><a href="#%E9%94%99%E8%AF%AF%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6"><strong>错误级别中间件</strong></a></li><li><a href="#%E5%86%85%E7%BD%AE%E4%B8%AD%E9%97%B4%E4%BB%B6"><strong>内置中间件</strong></a></li><li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E4%B8%AD%E9%97%B4%E4%BB%B6"><strong>第三方中间件</strong></a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%B0%9D%E8%AF%95%E5%AE%9E%E7%8E%B0urlencoded%E6%A8%A1%E5%9D%97"><strong>自定义中间件:尝试实现urlencoded模块</strong></a></li></ul></li><li><a href="#%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8">常用中间件的使用</a><ul><li><a href="#cors%E8%B7%A8%E6%BA%90%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6">CORS跨源访问限制</a></li><li><a href="#express-session%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81">express-session身份认证</a></li><li><a href="#jwt%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E6%9C%BA%E5%88%B6">JWT认证机制机制</a></li></ul></li><li><a href="#session%E8%AE%A4%E8%AF%81%E5%AE%8C%E6%95%B4%E6%A1%88%E4%BE%8B">session认证完整案例</a></li><li><a href="#jwt%E8%AE%A4%E8%AF%81%E5%AE%8C%E6%95%B4%E6%A1%88%E4%BE%8B">jwt认证完整案例</a></li><li><a href="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B%E7%BB%93%E5%90%88jwt%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6expressmysql%E6%97%B6%E9%97%B4api%E6%9C%8D%E5%8A%A1%E5%99%A8">综合案例：结合jwt认证机制、express、mysql时间api服务器</a></li></ul></li></ul><hr><h2 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h2><p>express作用和nodejs的http模块类似,用于创建web服务器<br><br> express是基于http模块封装的,使用起来比http模块简单,效率更高</p><p><strong>express用处</strong></p><ul><li>web服务器</li><li>API接口服务器</li></ul><hr><h2 id="实现api接口服务器" tabindex="-1"><a class="header-anchor" href="#实现api接口服务器"><span>实现API接口服务器</span></a></h2><h3 id="基本示例-post-get-all-listen" tabindex="-1"><a class="header-anchor" href="#基本示例-post-get-all-listen"><span>基本示例:post get all listen</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test_01&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;hello world!!&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test_02&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">hello:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;world&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">all</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test_03&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">hello:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;world&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,()</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="获取url中的查询参数" tabindex="-1"><a class="header-anchor" href="#获取url中的查询参数"><span>获取URL中的<strong>查询参数</strong></span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test_04&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // request.query默认是空对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 客户端使用 ?name=DingYigui&amp;age=20 这种查询字符串形式的URL时</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // request.query=={&quot;name&quot;=&quot;DingYigui&quot;,&quot;age&quot;=20}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">query</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">query</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="获取url中的动态参数" tabindex="-1"><a class="header-anchor" href="#获取url中的动态参数"><span>获取URL中的<strong>动态参数</strong></span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test_05/:name/:age&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // request.params 默认是空对象 是动态匹配到的URL参数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 客户端使用 /test_05/DingYigui/20 形式的URL时</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // request.params=={&quot;name&quot;=&quot;DingYigui&quot;,&quot;age&quot;=20}</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">params</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">params</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="静态web服务器" tabindex="-1"><a class="header-anchor" href="#静态web服务器"><span>静态web服务器</span></a></h2><h3 id="基本使用示例" tabindex="-1"><a class="header-anchor" href="#基本使用示例"><span><strong>基本使用示例</strong></span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">static</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./site0&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,()</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>要访问 <code>/site0/index</code> 只需访问 <code>/index</code></p></blockquote><hr><h3 id="托管多个静态网页" tabindex="-1"><a class="header-anchor" href="#托管多个静态网页"><span><strong>托管多个静态网页</strong></span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">static</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./site1&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">static</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./site2&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意: 若访问的index.html在两个文件目录中均存在,则优先访问第一个文件夹</p></blockquote><hr><h3 id="挂载路径前缀" tabindex="-1"><a class="header-anchor" href="#挂载路径前缀"><span><strong>挂载路径前缀</strong></span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/subSite&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">static</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./site1&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>要访问 <code>/site1/index</code> 则需访问 <code>/subSite/index</code></p></blockquote><hr><h2 id="路由" tabindex="-1"><a class="header-anchor" href="#路由"><span>路由</span></a></h2><h3 id="概念-1" tabindex="-1"><a class="header-anchor" href="#概念-1"><span>概念</span></a></h3><p>路由就是<strong>映射关系</strong>,在express中就是指<strong>客户端请求</strong>和<strong>服务端处理函数</strong>的<strong>映射关系</strong></p><p>express路由的<strong>组成</strong>: <code>app.METHOD(PATH,HANDLER)</code></p><ul><li><code>METHOD</code> 请求的方法</li><li><code>PATH</code> 请求的URL地址</li><li><code>HANDLER</code> 处理函数</li></ul><p>express路由的<strong>匹配规则</strong></p><ul><li>将按照定义的<strong>先后顺序</strong>进行匹配</li><li><strong>请求类型</strong>和<strong>请求URL</strong>需<strong>同时匹配</strong>才会调用对应的<strong>处理函数</strong></li></ul><hr>`,41),u={id:"最简用法-直接挂载到app上",tabindex:"-1"},v={class:"header-anchor",href:"#最简用法-直接挂载到app上"},o=E(`<div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test_01&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;hello world!!&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test_02&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">hello:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;world&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">all</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test_03&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">hello:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;world&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>`,2),m={id:"高级用法-将路由抽离为单独模块",tabindex:"-1"},A={class:"header-anchor",href:"#高级用法-将路由抽离为单独模块"},b=E(`<div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// ./src/user.js</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> routerApp</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">Router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//创建路由对象</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">routerApp</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/user/list&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//挂载路由</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;getted user list&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">routerApp</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/user/add&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//挂载路由</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;added user&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> routerApp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> //导出路由对象</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// ./index.js</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userRouter</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./src/user.js&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//导入user路由模块</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userRouter</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//注册路由</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,()</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>app.use()</code>用于注册全局<strong>中间件</strong></p></blockquote><hr><h3 id="为路由添加访问前缀" tabindex="-1"><a class="header-anchor" href="#为路由添加访问前缀"><span>为路由添加访问前缀</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userRouter</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//添加访问前缀</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件"><span>中间件</span></a></h2><h3 id="概念-2" tabindex="-1"><a class="header-anchor" href="#概念-2"><span>概念</span></a></h3><p>中间件(Middleware),特指业务流程的中间处理环节</p><p>但一个请求到达express服务器后,可连续调用多个中间件对请求进行<strong>预处理</strong><br><img src="`+g+`" alt="图 1"></p><p><strong>中间件本质为函数</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> mw</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;"> function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">request</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">){</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;这是一个中间件函数&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>next()函数</strong><br> next()函数实现多个中间件之间的<strong>连续调用</strong>,表示把<strong>流转关系</strong>转交给<strong>下一个中间件</strong>或<strong>路由</strong></p><p><img src="`+y+`" alt="图 2"></p><h3 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h3><p><strong>案例1:全局生效的中间件</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//定义中间件1</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> mw1</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;"> function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">){</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">startTime</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Date</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">now</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;执行了第1个中间件&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//定义中间件2</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> mw2</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;"> function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">){</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;执行了第2个中间件&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//注册中间件1:先注册的先执行,后注册的后执行</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">mw1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//注册中间件2</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">mw2</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/testRW&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//挂载路由</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> now</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Date</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">now</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> gap</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> now</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">startTime</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;处理该请求耗时:&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> gap</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> +</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;ms&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,()</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意</strong>:对于全局生效的中间件,一定要在路由之前注册中间件</p></blockquote><p><strong>案例2:局部生效的中间件</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//定义中间件1</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> mw1</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;"> function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">){</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">startTime</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Date</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">now</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;执行了第1个中间件&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//定义中间件2</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> mw2</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;"> function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">){</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;执行了第2个中间件&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//以下三种方式均可</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/testRW_2_1&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">mw1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//挂载路由</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> now</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Date</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">now</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> gap</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> now</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">startTime</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;处理该请求耗时:&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> gap</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> +</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;ms&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// 以下两种方式等效</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/testRW_2_2&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">mw1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">mw2</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//挂载路由</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> now</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Date</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">now</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> gap</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> now</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">startTime</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;处理该请求耗时:&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> gap</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> +</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;ms&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/testRW_2_3&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,[</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">mw1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">mw2</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">],(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//挂载路由</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> now</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Date</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">now</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> gap</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> now</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">-</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">startTime</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;处理该请求耗时:&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">+</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> gap</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> +</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;ms&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,()</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="中间件的分类" tabindex="-1"><a class="header-anchor" href="#中间件的分类"><span><strong>中间件的分类</strong></span></a></h3><ul><li><p><strong>应用</strong>级别中间件</p></li><li><p><strong>路由</strong>级别中间件</p></li><li><p><strong>错误</strong>级别中间件</p></li><li><p>Express<strong>内置</strong>中间件</p></li><li><p><strong>第三方</strong>中间件</p></li></ul><h3 id="应用级别中间件" tabindex="-1"><a class="header-anchor" href="#应用级别中间件"><span><strong>应用级别中间件</strong></span></a></h3><p>通过<code>app.use()</code> <code>app.post()</code> <code>app.get()</code>绑定到<strong>app实例</strong>上的中间件都称为<strong>应用级别中间件</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;这是一个应用级别中间件,同时也是全局中间件&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/test&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;这是一个应用级别中间件,同时也是局部中间件&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">        next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    },</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;hello world&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="路由级别中间件" tabindex="-1"><a class="header-anchor" href="#路由级别中间件"><span><strong>路由级别中间件</strong></span></a></h3><p>绑定到<code>express.Router()</code>的<strong>实例</strong>上的中间件都称为<strong>路由级别中间件</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> router</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">Router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;这是一个路由级别中间件&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;这是一个路由级别中间件&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">        next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">();</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    },</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;hello world&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="错误级别中间件" tabindex="-1"><a class="header-anchor" href="#错误级别中间件"><span><strong>错误级别中间件</strong></span></a></h3>`,30),B=s("strong",null,"防止项目异常崩溃的问题",-1),q=s("br",null,null,-1),x=s("strong",null,"格式:",-1),f=s("code",null,"function(err,req,res,next){}",-1),j=s("br",null,null,-1),w=s("strong",null,"注意:",-1),_=E(`<div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//创建路由</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/test&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    throw</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;"> new</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> Error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;服务器发生了内部错误!!!&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//手动抛出一个错误</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;hello world&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//此处便不会执行</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//注册错误级别中间件</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//输出错误信息</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//向客户端响应</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="内置中间件" tabindex="-1"><a class="header-anchor" href="#内置中间件"><span><strong>内置中间件</strong></span></a></h3><p>自<code>express@4.16.0</code>起内置了三个常用中间件</p>`,3),I=s("li",null,[s("code",null,"express.static"),s("ul",null,[s("li",null,"用于托管指定目录下的静态网页"),s("li",null,"(该中间件可兼任旧版本)")])],-1),S=s("code",null,"express.json()",-1),U=s("strong",null,"请求体中",-1),R=s("strong",null,"JSON格式",-1),T=s("code",null,"req.body",-1),L=s("li",null,"(该中间件不可兼任旧版本的express)",-1),N=s("code",null,"express.urlencoded()",-1),H=s("strong",null,"请求体中",-1),J=s("strong",null,"URL-encoded格式",-1),O=s("code",null,"req.body",-1),V=s("li",null,"(该中间件不可兼任旧版本的express)",-1),P=E(`<div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// 解析 application/json 格式的数据</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">json</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// 解析 application/x-www-form-urlencoded 格式的数据</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">urlencoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">extented:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//此时便能够解析并获取到请求体中的json格式和urlencoded格式的数据了</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="第三方中间件" tabindex="-1"><a class="header-anchor" href="#第三方中间件"><span><strong>第三方中间件</strong></span></a></h3>`,2),$=s("code",null,"express@4.16.0",-1),M=s("code",null,"express.urlencoded",-1),K=s("br",null,null,-1),Q=s("code",null,"express.urlencoded",-1),z=E(`<div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> parser</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;body-parser&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">parser</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">urlencoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">extented:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义中间件-尝试实现urlencoded模块" tabindex="-1"><a class="header-anchor" href="#自定义中间件-尝试实现urlencoded模块"><span><strong>自定义中间件:尝试实现urlencoded模块</strong></span></a></h3><p>实现将请求体中的<code>a=123&amp;b=321</code>格式的数据解析为<code>{a:123,b:321}</code>格式的json对象</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">////////////////////////////////////////////////////////////////////////////////</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> qs</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;querystring&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> BodyUrlDataDecoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">){</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//定义中间件</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">bodyUrlData</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> []</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">on</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;data&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">chunk</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//监听req的data</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">bodyUrlData</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">push</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">chunk</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//收集数据片段</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">on</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;end&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,()</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//监听req的end事件</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">        var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> temp</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">bodyUrlData</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">toString</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//将收集的数据片段转换为字符串</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> qs</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">parse</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">temp</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// 将字符串通过nodejs内置的querystring模块解析为json对象</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">        next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">BodyUrlDataDecoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//注册中间件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">////////////////////////////////////////////////////////////////////////////////</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">all</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">setHeader</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;Access-Control-Allow-Origin&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;*&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">setHeader</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;Access-Control-Allow-Headers&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;*&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,()</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试自定义中间件</strong></p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">&lt;!-- jquery库 ,crossorigin=&quot;anonymous&quot;表示不携带当前页面的cookie --&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> crossorigin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;anonymous&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> src</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">&lt;!-- axios 库 ,crossorigin=&quot;anonymous&quot;表示不携带当前页面的cookie --&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> crossorigin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;anonymous&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> src</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.27.2/axios.min.js&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;btn&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">点击使用axios(config)发送请求</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#btn&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">click</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        //axios(config)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">        axios</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            method:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &#39;post&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            url:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;http://127.0.0.1:8000/&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            params:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//url格式数据</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">            },</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            headers:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">{</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//报头</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">            },</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            data:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;a=123&amp;b=321&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // data:{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            //     a:123,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            //     b:321</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">then</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">catch</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">then</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> () {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // always executed</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        });</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常用中间件的使用" tabindex="-1"><a class="header-anchor" href="#常用中间件的使用"><span>常用中间件的使用</span></a></h2><h3 id="cors跨源访问限制" tabindex="-1"><a class="header-anchor" href="#cors跨源访问限制"><span>CORS跨源访问限制</span></a></h3><p><strong>方法1:添加请求头</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">setHeader</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;Access-Control-Allow-Origin&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;*&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">setHeader</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;Access-Control-Allow-Headers&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;*&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>方法2: 通过第三方中间件cors</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> cors</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;cors&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">cors</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="express-session身份认证" tabindex="-1"><a class="header-anchor" href="#express-session身份认证"><span>express-session身份认证</span></a></h3><p><strong>基本使用</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> session</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express-session&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    secret:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;keyboard cat&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//任意字符串,用于加密cookie</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    resave:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//固定写法</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    saveUninitialized:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> true</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//固定写法</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">json</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">urlencoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">extended:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断用户名和密码是否正确</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> &amp;&amp;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //保存此次会话的用户信息</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">islogin</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> true</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>console.log(req.session);</code>输出的数据格式</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// 登陆前</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">Session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">  cookie</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: { </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">path</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&#39;/&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">_expires</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">originalMaxAge</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">httpOnly</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">true</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//登陆后</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">Session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">  cookie</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: { </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">path</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&#39;/&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">_expires</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">originalMaxAge</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">httpOnly</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">true</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> },</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">  userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: { </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&#39;admin&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&#39;admin&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> },</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E6E6E6;">  islogin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">true</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>实现 <code>登陆</code> <code>登出</code> 的案例</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> session</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express-session&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">static</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./webRoot&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    secret:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;keyboard cat&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//任意字符串,用于加密cookie</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    resave:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//固定写法</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    saveUninitialized:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> true</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//固定写法</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">json</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">urlencoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">extended:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断用户名和密码是否正确</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> &amp;&amp;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //保存此次会话的用户信息</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">islogin</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> true</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/logout&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断该请求的是否已经登陆</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">!</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">islogin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;logout失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //销毁该会话</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">destroy</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;logout成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/get-username&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断该请求的是否已经登陆</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">!</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">islogin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;get-username失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;get-username成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        username:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, () </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登陆</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> action</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/login&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> method</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;post&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;text&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> name</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;username&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> name</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;submit&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;登陆&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登出</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> action</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/logout&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> method</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;get&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;submit&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;登出&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">获取当前用户的用户名</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> action</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/get-username&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> method</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;get&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;submit&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;获取当前用户的用户名&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jwt认证机制机制" tabindex="-1"><a class="header-anchor" href="#jwt认证机制机制"><span>JWT认证机制机制</span></a></h3><p><strong>安装相关包</strong></p><ul><li><code>jsonwebtoken</code> 用于将用户信息<strong>加密</strong>为JWT字符串</li><li><code>express-jwt</code> 用于将从客户端收到的JWT字符串<strong>解密</strong>为用户信息</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">npm</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> jsonwebtoken</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> express-jwt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>实现JWT认证登陆的完整示例</strong></p><p><img src="`+C+`" alt="图 6"></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//jwt身份认证</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> jwtEncode</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;jsonwebtoken&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//加密</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// const jwtDecode = require(&quot;express-jwt&quot;)  //解密</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">expressjwt</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">jwtDecode</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> } </span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express-jwt&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> secretKey</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;dfwofwiefjw0wfej02fj023j0r2&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> //随便写一段密钥用于加密token</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//用于支持跨源</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> cors</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;cors&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">cors</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// 静态资源</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">static</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./webRoot&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//解密请求头中的 jwtToken 解析还原为json对象 并把解析出来的信息挂载到 req.auth 上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//同时配置了访问权限 没有Token则不能访问任何接口 </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//unless指定某些页面不需要Token 这里指定 /api/login 不需要身份认证便能访问</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    jwtDecode</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        secret:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> secretKey</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        algorithms:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;HS256&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//防止潜在的降级攻击所必需的</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">unless</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">path:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#D16969;">/</span><span style="--shiki-light:#F97583;--shiki-dark:#DCDCAA;">^</span><span style="--shiki-light:#85E89D;--shiki-dark:#D7BA7D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:inherit;">\\/</span><span style="--shiki-light:#DBEDFF;--shiki-dark:#D16969;">api</span><span style="--shiki-light:#85E89D;--shiki-dark:#D7BA7D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:inherit;">\\/</span><span style="--shiki-light:#DBEDFF;--shiki-dark:#D16969;">login</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#D16969;">/</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">] }) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//指定 /api/login 不需要身份认证便能访问</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//用于req.body</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">json</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">urlencoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">extended:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//登陆api</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断用户名和密码是否正确</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> &amp;&amp;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆失败&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //生成token</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //sign方法:sign(参数1,参数2,参数3)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 参数1 待加密的数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 参数2 加密密钥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 参数3 配置项,可配置有效期</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> token</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> jwtEncode</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">sign</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">secretKey</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, { </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">expiresIn:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;30s&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> })</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //发送token</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        token:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> token</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// app.get(&quot;/api/logout&quot;, (req, res) =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// logout不需要服务端执行任何操作了 只需要客户端删除token就好了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//     res.send({ </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//         status: 0, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//         msg: &quot;logout成功&quot; </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//     })</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//     return;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/get-userinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;获取用户的信息成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        userinfo:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">auth</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//处理错误</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">name</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;UnauthorizedError&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 401</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;未登陆或登陆状态已过期,请重新登陆&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            err:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> err</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 500</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;服务器未知错误&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            err:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> err</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, () </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>前端代码</strong></p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    &lt;!-- jquery库 ,crossorigin=&quot;anonymous&quot;表示不携带当前页面的cookie --&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> crossorigin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;anonymous&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> src</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    &lt;!-- axios 库 ,crossorigin=&quot;anonymous&quot;表示不携带当前页面的cookie --&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> crossorigin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;anonymous&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> src</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.27.2/axios.min.js&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登陆</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    用户:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;text&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;username&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    密码:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;btn-login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登陆</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">div</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;login-result&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">div</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">        $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#btn-login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">click</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> () {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;123&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            //axios(config)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">            axios</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                method:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &#39;post&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                url:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;/api/login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                data:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    username:</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#username&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">val</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(),</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    password:</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#password&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">val</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(),</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">            })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">then</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">                    $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#login-result&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">text</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">JSON</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">stringify</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">))</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    sessionStorage</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">setItem</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;token&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">token</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//保存token</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">获取用户的信息</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;btn-get-userinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">获取</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">div</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;get-userinfo-result&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">div</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">        $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#btn-get-userinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">click</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> () {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            //axios(config)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">            axios</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                method:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &#39;get&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                url:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;/api/get-userinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                headers:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//报头</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    Authorization:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;Bearer &quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> +</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> sessionStorage</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">getItem</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;token&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//获取token</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">            })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">then</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">                    $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#get-userinfo-result&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">text</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">JSON</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">stringify</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">))</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登出</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;btn-logout&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登出</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">div</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;logout-result&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">div</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">        $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#btn-logout&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">click</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> () {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            sessionStorage</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">setItem</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;token&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">, </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//清除token</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">            $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#logout-result&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">text</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;登出完毕&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="session认证完整案例" tabindex="-1"><a class="header-anchor" href="#session认证完整案例"><span>session认证完整案例</span></a></h2><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登陆</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> action</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/login&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> method</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;post&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;text&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> name</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;username&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> name</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;submit&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;登陆&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登出</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> action</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/logout&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> method</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;get&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;submit&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;登出&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">获取当前用户的用户名</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> action</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/get-username&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> method</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;get&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">        &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;submit&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;获取当前用户的用户名&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">form</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> session</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express-session&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">static</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./webRoot&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    secret:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;keyboard cat&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//任意字符串,用于加密cookie</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    resave:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//固定写法</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    saveUninitialized:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> true</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//固定写法</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">json</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">urlencoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">extended:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断用户名和密码是否正确</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> &amp;&amp;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //保存此次会话的用户信息</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">islogin</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> true</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/logout&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断该请求的是否已经登陆</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">!</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">islogin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;logout失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //销毁该会话</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">destroy</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;logout成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/get-username&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断该请求的是否已经登陆</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">!</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">islogin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;get-username失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;get-username成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        username:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">session</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> </span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, () </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="jwt认证完整案例" tabindex="-1"><a class="header-anchor" href="#jwt认证完整案例"><span>jwt认证完整案例</span></a></h2><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    &lt;!-- jquery库 ,crossorigin=&quot;anonymous&quot;表示不携带当前页面的cookie --&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> crossorigin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;anonymous&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> src</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    &lt;!-- axios 库 ,crossorigin=&quot;anonymous&quot;表示不携带当前页面的cookie --&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> crossorigin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;anonymous&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> src</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.27.2/axios.min.js&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登陆</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">h1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    用户:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;text&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;username&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    密码:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">input</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> type</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">br</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;btn-login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">登陆</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">button</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">div</span><span style="--shiki-light:#B392F0;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;login-result&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;&lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">div</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">        $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#btn-login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">click</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> () {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            // console.log(&quot;123&quot;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">            //axios(config)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">            axios</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                method:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &#39;post&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                url:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;/api/login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                data:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    username:</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#username&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">val</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(),</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    password:</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#password&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">val</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(),</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">            })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">then</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">                    $</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;#login-result&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">text</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">JSON</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">stringify</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">))</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    sessionStorage</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">setItem</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;token&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">response</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">token</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//保存token</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">                })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#D4D4D4;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">    &lt;/</span><span style="--shiki-light:#85E89D;--shiki-dark:#569CD6;">script</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#808080;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//jwt身份认证</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> jwtEncode</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;jsonwebtoken&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//加密</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// const jwtDecode = require(&quot;express-jwt&quot;)  //解密</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">expressjwt</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">jwtDecode</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> } </span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express-jwt&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> secretKey</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;dfwofwiefjw0wfej02fj023j0r2&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> //随便写一段密钥用于加密token</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//用于支持跨源</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> cors</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;cors&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">cors</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// 静态资源</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">static</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./webRoot&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//解密请求头中的 jwtToken 解析还原为json对象 并把解析出来的信息挂载到 req.auth 上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//同时配置了访问权限 没有Token则不能访问任何接口 </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//unless指定某些页面不需要Token 这里指定 /api/login 不需要身份认证便能访问</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    jwtDecode</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        secret:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> secretKey</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        algorithms:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;HS256&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//防止潜在的降级攻击所必需的</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">unless</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">path:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#D16969;">/</span><span style="--shiki-light:#F97583;--shiki-dark:#DCDCAA;">^</span><span style="--shiki-light:#85E89D;--shiki-dark:#D7BA7D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:inherit;">\\/</span><span style="--shiki-light:#DBEDFF;--shiki-dark:#D16969;">api</span><span style="--shiki-light:#85E89D;--shiki-dark:#D7BA7D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:inherit;">\\/</span><span style="--shiki-light:#DBEDFF;--shiki-dark:#D16969;">login</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#D16969;">/</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">] }) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//指定 /api/login 不需要身份认证便能访问</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//用于req.body</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">json</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">urlencoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">extended:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//登陆api</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/login&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //判断用户名和密码是否正确</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> &amp;&amp;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;admin&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆失败&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //生成token</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //sign方法:sign(参数1,参数2,参数3)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 参数1 待加密的数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 参数2 加密密钥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // 参数3 配置项,可配置有效期</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> token</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> jwtEncode</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">sign</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">secretKey</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, { </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">expiresIn:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;30s&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> })</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //发送token</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        token:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> token</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// app.get(&quot;/api/logout&quot;, (req, res) =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// logout不需要服务端执行任何操作了 只需要客户端删除token就好了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//     res.send({ </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//         status: 0, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//         msg: &quot;logout成功&quot; </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//     })</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//     return;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">// })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api/get-userinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;获取用户的信息成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        userinfo:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">auth</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//处理错误</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">name</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;UnauthorizedError&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 401</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;未登陆或登陆状态已过期,请重新登陆&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            err:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> err</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 500</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;服务器未知错误&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            err:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> err</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, () </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="综合案例-结合jwt认证机制、express、mysql时间api服务器" tabindex="-1"><a class="header-anchor" href="#综合案例-结合jwt认证机制、express、mysql时间api服务器"><span>综合案例：结合jwt认证机制、express、mysql时间api服务器</span></a></h2><p><img src="`+D+`" alt=""></p><p><code>package.json</code></p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;name&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;api_server&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;version&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;1.0.0&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;description&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;main&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;index.js&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;scripts&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">    &quot;test&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;echo </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">Error: no test specified</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &amp;&amp; exit 1&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">  },</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;keywords&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: [],</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;author&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;license&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;ISC&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">  &quot;dependencies&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">    &quot;bcryptjs&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;^2.4.3&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">    &quot;express-jwt&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;^7.7.5&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">    &quot;joi&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;^17.6.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">  }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>index.js</code></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> cors</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;cors&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> confg</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./confg&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">expressjwt</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">: </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">jwtDecode</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> } </span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express-jwt&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> app</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">msg</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">errMsg</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">status</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">data</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                status</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                msg</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                errMsg</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                data</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        )</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    jwtDecode</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        secret:confg</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">jwtSecretKey</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        algorithms:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;HS256&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">]</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        .</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">unless</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">path:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#D16969;">/</span><span style="--shiki-light:#85E89D;--shiki-dark:#D7BA7D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:inherit;">\\/</span><span style="--shiki-light:#DBEDFF;--shiki-dark:#D16969;">api</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#D16969;">/</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">]})</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">cors</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//跨域访问访问中间件</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">json</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">())</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//解析请求体中json格式字符串中间件</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">urlencoded</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">extended:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}))</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//解析请求体中url格式字符串中间件</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> user</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./router/user&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/api&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">user</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//注册user模块</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userinfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;./router/userinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/my&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//注册userinfo模块</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">use</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">name</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> ===</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;UnauthorizedError&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;身份认证失败,未登陆或登陆超时,请重新登陆&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    else</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;未知错误&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">    next</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">app</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">listen</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">8000</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,()</span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    console</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">log</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;api server is running at http://127.0.0.1:8000&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">);</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>confg.js</code></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> jwtSecretKey</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;2374bnp0r0fj3u3t7gh452ris95247&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // 随便写的用于加密的字符串</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> jwtExpiresIn</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;6h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> // jwt过期时间</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">{</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    jwtSecretKey</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    jwtExpiresIn</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>db/mysql.js</code></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> mysql</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;mysql&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> db</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> mysql</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">createPool</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        host:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        user:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;root&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        password:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;root&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        database:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;my_db_01&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> db</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">/*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">my_db_01</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    tb_users</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        id INT auto_increment NOT NULL UNIQUE PRIMARY KEY,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        username VARCHAR(255) NOT NULL UNIQUE,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        password VARCHAR(255) NOT NULL,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        nickname VARCHAR(255) ,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        email VARCHAR(255) ,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">        user_pic TEXT ,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">var sql = \`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">CREATE DATABASE IF NOT EXISTS my_db_01;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">use my_db_01;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">CREATE TABLE IF NOT EXISTS \`my_db_01\`.\`tb_users\` (</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  \`id\` INT NOT NULL AUTO_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  \`username\` VARCHAR(255) NOT NULL,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  \`password\` VARCHAR(255) NOT NULL,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  \`email\` VARCHAR(255) NULL,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  \`user_pic\` TEXT NULL,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  PRIMARY KEY (\`id\`),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  UNIQUE INDEX \`id_UNIQUE\` (\`id\` ASC) VISIBLE,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">  UNIQUE INDEX \`username_UNIQUE\` (\`username\` ASC) VISIBLE);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">\`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">db.query(sql,(err,result)=&gt;{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    console.log(err || result);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">*/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>router/user.js</code></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> user_handler</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;../router_handler/user&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> router</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">Router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/signup&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">user_handler</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">signup</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/signin&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">user_handler</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">signin</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>router_handler/user.js</code></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> db</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;../db/mysql&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> bcrypt</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;bcryptjs&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;joi&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">sign_schema</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> } </span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;../schema&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> jwt</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;jsonwebtoken&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> confg</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;../confg&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">signup</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//注册接口</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userinfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> sign_schema</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">validate</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> });</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//验证帐号密码合法性</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;用户名或密码格式不合法&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">details</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">        const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> sql</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;select * from tb_users where username=?&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        db</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">query</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">sql</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;SQL查询用户是否存在失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            else</span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;"> if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">length</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;用户名被占用,请更换其他用户名&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">                const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> passwordHash</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> bcrypt</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">hashSync</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//对密码进行加密</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">                const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> sql</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;insert into tb_users set ?&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                db</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">query</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">sql</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, { </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> passwordHash</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;注册用户失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                    else</span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;"> if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">affectedRows</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> ==</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;注册用户失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">                    } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;注册用户成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">                })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">signin</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//登陆接口</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    //应当先验证帐号密码是否合法;否则直接用该数据来拼接SQL查询语句将有可能导致数据库遭到注入攻击</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userinfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> sign_schema</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">validate</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> });</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//验证帐号密码合法性</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;用户名或密码格式不合法&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">details</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">        const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> sql</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;select * from tb_users where username=?&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        db</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">query</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">sql</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//查询用户名是否存在</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;SQL查询用户是否存在失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            else</span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;"> if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">length</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//查询结果应当有且只有一个</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;用户名不存在&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;"> if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">bcrypt</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">compareSync</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">].</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">==</span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;"> false</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//验证密码是否正确</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;密码错误,登陆失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">                const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> token</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> jwt</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">sign</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">].</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">id:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">].</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">id</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">confg</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">jwtSecretKey</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, { </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">expiresIn:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> confg</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">jwtExpiresIn</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> }) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//生成token</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">send</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    status:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    msg:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;登陆成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">                    token:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;Bearer &quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> +</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> token</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;"> //返回拼接好的token</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">                })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>router/userinfo.js</code></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;express&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userinfo_handler</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;../router_handler/userinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> router</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> express</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">Router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">get</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/getuserinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo_handler</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">getUserInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/setuserinfo&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo_handler</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">setUserInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">post</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;/update/avatar&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userinfo_handler</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">updateAvatar</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">router</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>router_handler/userinfo.js</code></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> db</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;../db/mysql&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> bcrypt</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;bcryptjs&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">setUserInfo_schema</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> } </span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;../schema&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">updateAvatar_schema</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> } </span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;../schema&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">getUserInfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userId</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">auth</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">id</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> sql</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;select * from tb_users where id=?&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    db</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">query</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">sql</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userId</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;SQL查询用户失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;"> if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;">length</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;SQL查询用户信息不唯一&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;获取用户信息成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, { </span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">...</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">[</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">], </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password:</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">setUserInfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userId</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">auth</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">id</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userInfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> setUserInfo_schema</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">validate</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">nickname:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">nickname</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">email:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">email</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> });</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//验证表单合法性</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;用户名或密码或email格式不合法&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">details</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">        var</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> setUserInfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//构建用于用于更新数据库的对象</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            setUserInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> bcrypt</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">hashSync</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//对密码进行加密</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">nickname</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            setUserInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">nickname</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">nickname</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">email</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">            setUserInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">email</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">email</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        }</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">        const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> sql</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;update tb_users set ? where id=?&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        db</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">query</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">sql</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, [</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">setUserInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userId</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">], (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;设置用户信息失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            else</span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;"> if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">affectedRows</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;设置用户信息失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;设置用户信息成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">updateAvatar</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userId</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">auth</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">id</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> userInfo</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> req</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">body</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> value</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> updateAvatar_schema</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">validate</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">avatar:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">avatar</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> });</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//验证表单合法性</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">        return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;avatar格式不合法&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">value</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">error</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">details</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">        const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> sql</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;"> &quot;update tb_users set ? where id=?&quot;</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">        db</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">query</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">sql</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, [{</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">user_pic:userInfo</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">avatar</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">userId</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">], (</span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">=&gt;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;更新用户头像失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">err</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">message</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">            else</span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;"> if</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> (</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">result</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">affectedRows</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> !=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;更新用户头像失败&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">            } </span><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">else</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C586C0;">                return</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> res</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">msgSend</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;更新用户头像成功&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#79B8FF;--shiki-dark:#569CD6;">null</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">        })</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>schema/index.js</code></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;"> require</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;joi&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> id</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">number</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">integer</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">min</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">1</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> username</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">string</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">alphanum</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">min</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">max</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">30</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> password</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">string</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">alphanum</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">min</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">max</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">30</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//.pattern(new RegExp(&#39;^[a-zA-Z0-9]{3,30}$&#39;))</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> nickname</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">string</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">alphanum</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">min</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">3</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">max</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;">30</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> email</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">string</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">email</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({ </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">minDomainSegments:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#B5CEA8;"> 2</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">tlds:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> { </span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">allow:</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;"> [</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&#39;com&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">, </span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&#39;net&#39;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">] } })</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> avatar</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">string</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">().</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">dataUri</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">()</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//&#39;data:image/png;base64,VE9PTUFOWVNFQ1JFVFM=&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> sign_schema</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">object</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    username:username</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">required</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(),</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    password:password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">required</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(),</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> setUserInfo_schema</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">object</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // id,//id不允许修改</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">    // username,//username不允许修改</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    nickname</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    password</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    email</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">    }).</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">or</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">(</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;nickname&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;password&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">,</span><span style="--shiki-light:#9ECBFF;--shiki-dark:#CE9178;">&quot;email&quot;</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A9955;">//至少包含一个信息</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#569CD6;">const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#9CDCFE;"> updateAvatar_schema</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> Joi</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">object</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">({</span></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">    avatar:avatar</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#DCDCAA;">required</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">() </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">sign_schema</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> sign_schema</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">setUserInfo_schema</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> setUserInfo_schema</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">module</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#4EC9B0;">exports</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#E6E6E6;">.</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;">updateAvatar_schema</span><span style="--shiki-light:#F97583;--shiki-dark:#D4D4D4;"> =</span><span style="--shiki-light:#E1E4E8;--shiki-dark:#9CDCFE;"> updateAvatar_schema</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,55);function W(Y,Z){const k=h("sky"),l=h("red"),p=h("gre");return d(),e("div",null,[c,s("h3",u,[s("a",v,[s("span",null,[s("strong",null,[a(k,null,{default:n(()=>[i("最简用法")]),_:1}),i(":直接挂载到app上")])])])]),a(l,null,{default:n(()=>[i("express不建议将路由直接挂载到app上,这样会导致代码量越来越多,不便管理")]),_:1}),o,s("h3",m,[s("a",A,[s("span",null,[s("strong",null,[a(k,null,{default:n(()=>[i("高级用法")]),_:1}),i(":将路由抽离为单独模块")])])])]),a(p,null,{default:n(()=>[i("express官方推荐用法")]),_:1}),i(),b,s("p",null,[i("用于捕获整个项目中发生异常错误的中间件,"),B,q,x,f,j,w,i(),a(l,null,{default:n(()=>[i("错误级别中间件需放在路由之后")]),_:1})]),_,s("ul",null,[I,s("li",null,[S,s("ul",null,[s("li",null,[i("用于解析"),a(l,null,{default:n(()=>[U]),_:1}),i("的"),R,i("的数据,解析完毕后将被挂载到"),T,i("上")]),L])]),s("li",null,[N,s("ul",null,[s("li",null,[i("用于解析"),a(l,null,{default:n(()=>[H]),_:1}),i("中的"),J,i("的数据,解析完毕后将被挂载到"),O,i("上")]),V])])]),P,s("p",null,[i("在"),$,i("内置"),M,i("模块之前,常使用的一个叫"),a(l,null,{default:n(()=>[i("body-parser")]),_:1}),i("的模块"),K,i(" 实际上该模块就是"),Q,i("的前身")]),z])}const G=t(F,[["render",W],["__file","express学习笔记.html.vue"]]),ss=JSON.parse('{"path":"/%E5%90%8E%E7%AB%AF/express%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/express%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html","title":"express学习笔记","lang":"zh-CN","frontmatter":{"title":"express学习笔记","date":"2022-08-30T00:05:00.000Z","cover":"./cover/express学习笔记.png","tag":["express"],"category":"后端","star":true,"description":"express学习笔记 目录 express学习笔记 目录 概念 实现API接口服务器 基本示例:post get all listen 获取URL中的查询参数 获取URL中的动态参数 静态web服务器 基本使用示例 托管多个静态网页 挂载路径前缀 路由 概念 最简用法:直接挂载到app上 高级用法:将路由抽离为单独模块 为路由添加访问前缀 中间件 概...","head":[["meta",{"property":"og:url","content":"https://dingdingdang.online/%E5%90%8E%E7%AB%AF/express%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/express%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"}],["meta",{"property":"og:site_name","content":"YiguiDing的Blog小站"}],["meta",{"property":"og:title","content":"express学习笔记"}],["meta",{"property":"og:description","content":"express学习笔记 目录 express学习笔记 目录 概念 实现API接口服务器 基本示例:post get all listen 获取URL中的查询参数 获取URL中的动态参数 静态web服务器 基本使用示例 托管多个静态网页 挂载路径前缀 路由 概念 最简用法:直接挂载到app上 高级用法:将路由抽离为单独模块 为路由添加访问前缀 中间件 概..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-11-28T11:27:55.000Z"}],["meta",{"property":"article:author","content":"丁毅桂"}],["meta",{"property":"article:tag","content":"express"}],["meta",{"property":"article:published_time","content":"2022-08-30T00:05:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-11-28T11:27:55.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"express学习笔记\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-08-30T00:05:00.000Z\\",\\"dateModified\\":\\"2023-11-28T11:27:55.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"丁毅桂\\",\\"email\\":\\"2449695354@qq.com\\"}]}"],["meta",{"name":"baidu-site-verification","content":"codeva-PwE9Ts6nMl"}]]},"headers":[{"level":2,"title":"目录","slug":"目录","link":"#目录","children":[]},{"level":2,"title":"概念","slug":"概念","link":"#概念","children":[]},{"level":2,"title":"实现API接口服务器","slug":"实现api接口服务器","link":"#实现api接口服务器","children":[{"level":3,"title":"基本示例:post get all listen","slug":"基本示例-post-get-all-listen","link":"#基本示例-post-get-all-listen","children":[]},{"level":3,"title":"获取URL中的查询参数","slug":"获取url中的查询参数","link":"#获取url中的查询参数","children":[]},{"level":3,"title":"获取URL中的动态参数","slug":"获取url中的动态参数","link":"#获取url中的动态参数","children":[]}]},{"level":2,"title":"静态web服务器","slug":"静态web服务器","link":"#静态web服务器","children":[{"level":3,"title":"基本使用示例","slug":"基本使用示例","link":"#基本使用示例","children":[]},{"level":3,"title":"托管多个静态网页","slug":"托管多个静态网页","link":"#托管多个静态网页","children":[]},{"level":3,"title":"挂载路径前缀","slug":"挂载路径前缀","link":"#挂载路径前缀","children":[]}]},{"level":2,"title":"路由","slug":"路由","link":"#路由","children":[{"level":3,"title":"概念","slug":"概念-1","link":"#概念-1","children":[]},{"level":3,"title":"最简用法:直接挂载到app上","slug":"最简用法-直接挂载到app上","link":"#最简用法-直接挂载到app上","children":[]},{"level":3,"title":"高级用法:将路由抽离为单独模块","slug":"高级用法-将路由抽离为单独模块","link":"#高级用法-将路由抽离为单独模块","children":[]},{"level":3,"title":"为路由添加访问前缀","slug":"为路由添加访问前缀","link":"#为路由添加访问前缀","children":[]}]},{"level":2,"title":"中间件","slug":"中间件","link":"#中间件","children":[{"level":3,"title":"概念","slug":"概念-2","link":"#概念-2","children":[]},{"level":3,"title":"示例","slug":"示例","link":"#示例","children":[]},{"level":3,"title":"中间件的分类","slug":"中间件的分类","link":"#中间件的分类","children":[]},{"level":3,"title":"应用级别中间件","slug":"应用级别中间件","link":"#应用级别中间件","children":[]},{"level":3,"title":"路由级别中间件","slug":"路由级别中间件","link":"#路由级别中间件","children":[]},{"level":3,"title":"错误级别中间件","slug":"错误级别中间件","link":"#错误级别中间件","children":[]},{"level":3,"title":"内置中间件","slug":"内置中间件","link":"#内置中间件","children":[]},{"level":3,"title":"第三方中间件","slug":"第三方中间件","link":"#第三方中间件","children":[]},{"level":3,"title":"自定义中间件:尝试实现urlencoded模块","slug":"自定义中间件-尝试实现urlencoded模块","link":"#自定义中间件-尝试实现urlencoded模块","children":[]}]},{"level":2,"title":"常用中间件的使用","slug":"常用中间件的使用","link":"#常用中间件的使用","children":[{"level":3,"title":"CORS跨源访问限制","slug":"cors跨源访问限制","link":"#cors跨源访问限制","children":[]},{"level":3,"title":"express-session身份认证","slug":"express-session身份认证","link":"#express-session身份认证","children":[]},{"level":3,"title":"JWT认证机制机制","slug":"jwt认证机制机制","link":"#jwt认证机制机制","children":[]}]},{"level":2,"title":"session认证完整案例","slug":"session认证完整案例","link":"#session认证完整案例","children":[]},{"level":2,"title":"jwt认证完整案例","slug":"jwt认证完整案例","link":"#jwt认证完整案例","children":[]},{"level":2,"title":"综合案例：结合jwt认证机制、express、mysql时间api服务器","slug":"综合案例-结合jwt认证机制、express、mysql时间api服务器","link":"#综合案例-结合jwt认证机制、express、mysql时间api服务器","children":[]}],"git":{"createdTime":1700226391000,"updatedTime":1701170875000,"contributors":[{"name":"YiguiDing","email":"2449695354@qq.com","commits":2}]},"readingTime":{"minutes":19.51,"words":5854},"filePathRelative":"后端/express学习笔记/express学习笔记.md","localizedDate":"2022年8月30日","excerpt":"","autoDesc":true}');export{G as comp,ss as data};
