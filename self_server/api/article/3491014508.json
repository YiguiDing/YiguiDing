{"shortInfo":{"title":"Eslint结合Prettier的配置记录","date":"2023-01-05T18:12:00.000Z","cover":"\\self_server\\assets\\images\\default_cover2.jpg","tags":["笔记"],"categories":"笔记","id":3491014508,"countWords":2177,"readSeconds":217.7,"assetsbaseUrl":"/self_server/assets/"},"content":"# Eslint 结合 Prettier 的配置记录\r\n\r\n这篇笔记是在学习解决 ESLint 与 Prettier 的冲突的过程中，边学边总结写成的，笔记简要回顾了下 Prettier 和 ESLint 的安装和配置，重点记录了两个工具的冲突解决原理和配置方法。\r\n\r\n## Prettier 和 ESLint 简介\r\n\r\n> **精简版**  \r\n> Prettier: 代码格式化的工具，美化代码，好看  \r\n> ESLint：代码质量检测、编码风格约束，好用\r\n\r\n**废话版**  \r\nPrettier 只关注格式化，并不具有 ESLint 检查语法等能力。它通过解析代码并匹配自己的一套规则，来强制执行一致的代码展示格式。\r\n\r\nESLint 是一个在 JavaScript 代码中通过规则模式匹配作代码识别和报告的插件化的检测工具，它的目的是保证代码规范的一致性和及时发现代码问题、提前避免错误发生。\r\nESLint 的关注点是代码质量，检查代码风格并且会提示不符合风格规范的代码。除此之外 ESLint 也具有一部分代码格式化的功能。\r\n\r\n## Prettier 安装和配置\r\n\r\n**安装**  \r\n这个东西其实没啥好讲的，以 VSCode 为例，总结起来就是，首先安装 prettier-vscode 插件 然后在 setting.json 中配置使得 prettier-vscode 插件为默认的代码格式化工具，这样在按下快捷键后，代码将自动格式化。\r\n\r\n`值得注意的是`，根据插件的 readme 文件，尽管 prettier-vscode 插件捆绑了 prettier，但 prettier-vscode 插件推荐在项目使用 npm 安装 prettier 为项目的本地依赖，可能是考虑到 prettier 版本差异的会导致不同的格式化结果的原因。\r\n\r\n> npm install prettier -D\r\n\r\n当然插件也能使用安装在全局的 prettier,但需要配置，详细看该插件的 readme。\r\n\r\n> This extension will use prettier from your project's local dependencies (recommended). When the prettier.resolveGlobalModules is set to true the extension can also attempt to resolve global modules. Should prettier not be installed locally with your project's dependencies or globally on the machine, the version of prettier that is bundled with the extension will be used.\r\n\r\n**配置**  \r\n首先要理清 prettier-vscode 和 prettier 的关系，prettier-vscode 是 vscode 的插件，在将 prettier-vscode 配置为 vscode 的默认的代码格式化工具后， 当在 vscode 中按下代码格式化的快捷键时，vscode 会找到 prettier-vscode 插件 使用该插件进行代码格式化 而 prettier-vscode 又会去找到 prettier , 让 prettier 来做代码格式化 而 prettier 在做代码格式化时，需要知道代码格式化的规则，项目根目录下的 .prettierrc 文件就是记录这个规则的文件。\r\n\r\n**画了个图**\r\n\r\n```txt\r\nvscode\r\n\t| =找插件=> prettier-vscode\r\n\t|\t\t\t\t| =找处理程序=> prettier\r\n\t|\t\t\t\t|\t\t\t\t\t| =找配置文件=> .prettierrc\r\n\t|\t\t\t\t|\t\t\t\t\t| => 处理程序得到格式化后的代码\r\n\t|\t\t\t\t| => 插件得到格式化后的代码\r\n\t| => vscode得到格式化后的代码\r\n```\r\n\r\n在 vscode 的插件 prettier-vscode 的加持下，以下配置文件按优先级作用\r\n\r\n1. Prettier 的配置文件\r\n2. .editorconfig\r\n3. vscode 的配置文件 (前两个文件存在，则忽略该文件)\r\n\r\n**Prettier 配置文件**  \r\n其配置文件名称为.prettierrc.js 后缀名可不同\r\n\r\n示例及说明\r\n\r\n```js\r\n//.prettierrc.js\r\nmodule.exports = {\r\n  tabWidth: 2, // 使用 2 个缩进\r\n  useTabs: true, // 使用Tab缩进符\r\n  printWidth: 150, // 一行最多字符\r\n  semi: true, // 行尾需要分号\r\n  singleQuote: false, // 使用双引号\r\n  quoteProps: \"as-needed\", // 对象的 key 仅在必要时用引号\r\n  trailingComma: \"none\", // 末尾不需要逗号\r\n  bracketSpacing: true, // 大括号内的首尾需要空格\r\n  endOfLine: \"crlf\", // 换行使用windows的换行符号\r\n  arrowParens: \"avoid\", // 箭头函数，只有一个参数的时候，不需要括号\r\n  rangeStart: 0, // 每个文件格式化的范围是文件的全部内容\r\n  rangeEnd: Infinity, // 每个文件格式化的范围是文件的全部内容\r\n  proseWrap: \"never\", // 使用默认的折行标准\r\n  // requirePragma: false, // 不需要写文件开头的 @prettier\r\n  // insertPragma: false, // 不需要自动在文件开头插入 @prettier\r\n  // jsxSingleQuote: false,// jsx 不使用单引号，而使用双引号\r\n};\r\n```\r\n\r\n## ESLint 安装和配置\r\n\r\n**安装**  \r\n也是首先在 vscode 中安装 vscode-ESLint 插件,但与 prettier-vscode 插件不同的是， vscode-ESLint 插件自身不携带 ESLint 这个库,需要在项目中安装 eslint 依赖或是将其安装在全局\r\n\r\n```bash\r\nnpm install eslint -D\r\nnpm install eslint -g\r\n```\r\n\r\n> The extension uses the ESLint library installed in the opened workspace folder. If the folder doesn't provide one the extension looks for a global install version. If you haven't installed ESLint either locally or globally do so by running npm install eslint in the workspace folder for a local install or npm install -g eslint for a global install.\r\n\r\n**配置**\r\n\r\n可以使用命令行工具通过回答问题的方式生成配置文件\r\n\r\n```bash\r\neslint --init # 全局安装eslint后执行该命令初始化\r\n./node_modules/.bin/eslint --init # 本地安装则执行这个\r\n```\r\n\r\n以下是生成好的，配置了支持 typescript，换行符，行尾是否有分号，没啥好讲的，傻瓜式生成。\r\n\r\n```json\r\n{\r\n  \"env\": {\r\n    \"browser\": true,\r\n    \"es2021\": true\r\n  },\r\n  \"extends\": [\"eslint:recommended\", \"plugin:@typescript-eslint/recommended\"],\r\n  \"overrides\": [],\r\n  \"parser\": \"@typescript-eslint/parser\",\r\n  \"parserOptions\": {\r\n    \"ecmaVersion\": \"latest\"\r\n  },\r\n  \"plugins\": [\"@typescript-eslint\"],\r\n  \"rules\": {\r\n    \"linebreak-style\": [\"error\", \"windows\"],\r\n    \"quotes\": [\"error\", \"double\"],\r\n    \"semi\": [\"error\", \"always\"]\r\n  }\r\n}\r\n```\r\n\r\n## 笔记重点：ESLint 与 Prettier 冲突的解决\r\n\r\n在代码格式化时采用 Perttier 规则，而我们代码校验使用的是 ESLint，如果同一个规则配置不一致，往往就会出现冲突问题；\r\n\r\n比如：字符串单、双引号的配置，eslint fix 后把字符串变成单引号，再次编辑文件后，保存（Prettier）自动格式化后却又变成双引号，导致代码校验异常。\r\n\r\n解决方式一：要么修改 eslintrc，要么修改 prettierrc 配置，让它们配置保持一致；\r\n\r\n解决方式二：\r\n\r\n- 1. 使用 Prettier 格式化代码后 ESLint 报错，那么就禁用 ESLint 中所有与格式化相关的规则\r\n  - (使用库：eslint-config-prettier)\r\n- 2. 把 Prettier 的代码格式化配置 注册到 ESLint 中，这样 ESLint 就会识别报告代码中与 Prettier 配置格式不一致的错误，同时也能修复它\r\n  - (使用库：eslint-plugin-prettier)\r\n  - 该库的 readme 自述：`将 Prettier 作为 ESLint 规则运行，并将差异报告为单个 ESLint 问题。`\r\n\r\n### 安装、注册、配置插件：eslint-plugin-prettier\r\n\r\n该插件用于将 Prettier 中配置的规则添加到 ESLint 中，这样不符合 Prettier 格式的代码 ESLint 就能识别报错和纠正\r\n\r\n**安装**\r\n\r\n```bash\r\nnpm install --save-dev eslint-plugin-prettier\r\n```\r\n\r\n**注册和配置插件**\r\n\r\n```json\r\n// ESLint的配置文件\r\n// .eslintrc.json\r\n{\r\n  \"plugins\": [\"prettier\"], // 注册插件： eslint-plugin-prettier 这样Prettier中的规则就注册到了ESLint中\r\n  \"rules\": {\r\n    \"prettier/prettier\": \"error\" // 配置插件：报告代码中和Prettier规则不一致的错误\r\n  }\r\n}\r\n```\r\n\r\n### 安装、注册、配置插件：eslint-config-prettier\r\n\r\n**安装**\r\n\r\n```bash\r\nnpm install --save-dev eslint-config-prettier\r\n```\r\n\r\n**配置**\r\n\r\n```json\r\n// .eslintrc.json\r\n{\r\n  \"extends\": [\r\n    \"...其他配置放在之前\",\r\n    \"plugin:prettier/recommended\" // 这一行代码实际等效于下面的几行代码\r\n  ]\r\n}\r\n```\r\n\r\n**上面代码等效下列代码**\r\n\r\n```json\r\n{\r\n  \"extends\": [\"prettier\"], // 启用来自 eslint-config-prettier 的配置文件，这将关闭一些导致冲突的规则\r\n  \"plugins\": [\"prettier\"], // 注册来自 eslint-plugin-prettier 的插件 这将把prettier的配置添加到eslint中\r\n  \"rules\": {\r\n    \"prettier/prettier\": \"error\", // 提示插件检测出的错误\r\n    \"arrow-body-style\": \"off\", // 关闭箭头函数的规则\r\n    \"prefer-arrow-callback\": \"off\" // 关闭箭头函数的规则\r\n  }\r\n}\r\n```\r\n\r\n## 总结\r\n\r\n第二个库的配置项包含了如何配置第一个库，所以只需要安装上述两个库，然后配置一行代码，或者直接使用上面的等效代码\r\n\r\n**配置**\r\n\r\n```json\r\n// .eslintrc.json\r\n{\r\n  \"extends\": [\"...其他配置放在之前\", \"plugin:prettier/recommended\"]\r\n}\r\n```\r\n\r\n## 当前使用的配置文件和依赖\r\n\r\n**当前使用的配置文件**\r\n\r\n```json\r\n{\r\n  \"env\": {\r\n    \"browser\": true,\r\n    \"es2021\": true\r\n  },\r\n  \"extends\": [\r\n    \"eslint:recommended\",\r\n    \"plugin:@typescript-eslint/recommended\",\r\n    \"prettier\"\r\n  ],\r\n  \"overrides\": [],\r\n  \"parser\": \"@typescript-eslint/parser\",\r\n  \"parserOptions\": {\r\n    \"ecmaVersion\": \"latest\"\r\n  },\r\n  \"plugins\": [\"@typescript-eslint\", \"prettier\"],\r\n  \"rules\": {\r\n    \"linebreak-style\": [\"error\", \"windows\"],\r\n    \"quotes\": [\"error\", \"double\"],\r\n    \"semi\": [\"error\", \"always\"],\r\n    \"prettier/prettier\": \"warn\"\r\n  }\r\n}\r\n```\r\n\r\n**依赖**\r\n\r\n```json\r\n{\r\n  \"devDependencies\": {\r\n    \"typescript\": \"^4.9.4\", //ts\r\n    \"@typescript-eslint/eslint-plugin\": \"^5.48.0\", //插件\r\n    \"@typescript-eslint/parser\": \"^5.48.0\", //语法分析器\r\n    \"eslint\": \"^8.31.0\", // eslint\r\n    \"eslint-config-prettier\": \"^8.6.0\", // 配置，用于关闭eslint中和prettier的配置\r\n    \"eslint-plugin-prettier\": \"^4.2.1\", // 插件，用于将prettier的配置附加到eslint中\r\n    \"prettier\": \"^2.8.1\" // 代码格式化\r\n  }\r\n}\r\n```\r\n\r\n## 缺点\r\n\r\n缺点很明显，因为始终是在使用 prettier 来做代码格式化，修改 ESLint 的配置文件并不能改变 prettier 的格式化规则，这是在让 ESLint 去迎合 prettier 的配置规则，这就导致在某些配置上，你可能需要让 ESLint 来检测某些错误，并自动修复它，但是当你按下保存时，prettier 又去自动格式化代码，格式化后的代码导致了 ESLint 报错，除非修改 prettier 的代码格式化规则，否则这是不可避免的。\r\n\r\n<style>\r\n    gold{\r\n        color:black;\r\n        background-color:gold;\r\n    }\r\n    green{\r\n        color:white;\r\n        background-color:green;\r\n    }\r\n    warn{\r\n        color:white;\r\n        background-color:red;\r\n    }\r\n</style>\r\n"}