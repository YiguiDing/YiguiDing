---
layout: post
cover: /images/article/DeepLearning.jpg
---

# 3.3利用深度学习框架实现线性回归


## 生成人工数据集

### 定义生成数据函数


```python
import torch
def stand_data_generator(W,b,X_num):
    X=torch.normal(0,1,(X_num,W.shape[0]))
    Y=torch.matmul(X,W)+b
    noise=torch.normal(0,0.5,Y.shape)
    Y += noise
    Y.reshape((-1,1))
    # Y = WX + b + noise
    return X,Y
```



### 生成数据


```python
real_w = torch.tensor([4.0,-4.0,0.0]).reshape(3,1) ;        print(real_w)
real_b = 4.2;                                               print(real_b)

samplesX , labelsY = stand_data_generator(real_w,real_b,500) #生成人工数据
```

    tensor([[ 4.],
            [-4.],
            [ 0.]])
    4.2
    

### 生成数据可视化


```python
import matplotlib.pyplot as plt
plt.rcParams["font.family"]="SimHei"

fig=plt.figure(num="id-1",figsize=(40,5))

axes1=fig.add_subplot(1,4,1)
axes1.set_title("samplesX[:,0]与labelsY的线性关系",fontsize=18,backgroundcolor='#3c7f99',fontweight='bold',color='white',verticalalignment="baseline")
axes1.scatter(samplesX[:,0].detach(),labelsY.detach(),color="r")

axes2=fig.add_subplot(1,4,2)
axes2.set_title("samplesX[:,1]与labelsY的线性关系",fontsize=18,backgroundcolor='#3c7f99',fontweight='bold',color='white',verticalalignment="baseline")
axes2.scatter(samplesX[:,1].detach(),labelsY.detach(),color="g")

axes3=fig.add_subplot(1,4,3)
axes3.set_title("samplesX[:,2]与labelsY的线性关系",fontsize=18,backgroundcolor='#3c7f99',fontweight='bold',color='white',verticalalignment="baseline")
axes3.scatter(samplesX[:,2].detach(),labelsY.detach(),color="b")

plt.show()
plt.rcParams["font.family"]=""

```

    G:\Program Files\Miniconda3\envs\ml\lib\site-packages\IPython\core\pylabtools.py:151: UserWarning: Glyph 8722 (\N{MINUS SIGN}) missing from current font.
      fig.canvas.print_figure(bytes_io, **kw)
    


    
![png](/李沫《动手学深度学习》学习笔记/3.线性神经网络/3.3利用深度学习框架实现线性回归/output_7_1.png)
    


## TensorDataset
* Dataset是一个包装类，用来将数据包装为Dataset类，然后传入DataLoader中，我们再使用DataLoader这个类来更加快捷的对数据进行操作。
* TensorDataset 可以用来对 tensor 进行打包，就好像 python 中的 zip 功能。
* 该类通过每一个 tensor 的第一个维度进行索引。
* 因此，该类中的 tensor 第一维度必须相等. 
* 另外：TensorDataset 中的参数必须是 tensor


```python
import torch.utils.data as data
a = torch.tensor([
                    [1, 2, 3], 
                    [4, 5, 6], 
                    [7, 8, 9], 
                    [1, 2, 3]
                ])
b = torch.tensor([44, 55, 66, 44])

dataSet = data.TensorDataset(a, b) 
print(dataSet)
print(dataSet.tensors)
```

    <torch.utils.data.dataset.TensorDataset object at 0x000001E80F6270D0>
    (tensor([[1, 2, 3],
            [4, 5, 6],
            [7, 8, 9],
            [1, 2, 3]]), tensor([44, 55, 66, 44]))
    

## DataLoader
* dataloader的返回值本质是一个如List、String的可迭代对象(iterable)
* 使用iter(可迭代对象)将返回一个迭代器，然后可以使用next(迭代器)访问；
* 可以使用for循环遍历


```python
# 从数据集中每次抽出batch size个样本
可迭代对象 = data.DataLoader(dataset=dataSet,
                         batch_size=2,
                         shuffle=False, # 是否打乱顺序
                         num_workers=0) #num_workers(加载数据的时候使用几个子进程)
                         
for X,Y in 可迭代对象:
    print(X)
    print(Y)
print("----------------------------")
迭代器 = iter(可迭代对象)
print(next(迭代器))
print(next(迭代器))
print("----------------------------")

```

    tensor([[1, 2, 3],
            [4, 5, 6]])
    tensor([44, 55])
    tensor([[7, 8, 9],
            [1, 2, 3]])
    tensor([66, 44])
    ----------------------------
    [tensor([[1, 2, 3],
            [4, 5, 6]]), tensor([44, 55])]
    [tensor([[7, 8, 9],
            [1, 2, 3]]), tensor([66, 44])]
    ----------------------------
    

# 定义返回值是“可迭代小批量数据”的函数


```python
import torch.utils.data as data
def dataLoader(XYset,batchSize,disOrder=True):
    dataSet=data.TensorDataset(*XYset)                                      #打包为数据集合 或者说转换成TensorDataset类
    iterableBatchList=data.DataLoader(dataSet,batchSize,shuffle=disOrder)   #生成可迭代对象，每个对象是一小批数据集
    return iterableBatchList
```


```python
iterableBatchList = dataLoader((samplesX,labelsY),20,True)

for X,Y in iterableBatchList:
    print(X)
    print(Y)
```

    tensor([[-2.2427e-01,  3.0487e-01, -4.8849e-01],
            [ 1.4699e+00,  1.6906e+00, -4.0544e-01],
            [ 9.3650e-01,  6.6236e-01,  1.8760e+00],
            [-1.3289e+00, -6.1868e-01,  1.4218e+00],
            [-8.7698e-02,  4.1414e-01, -1.2310e+00],
            [-3.1538e-01, -4.2853e-01,  6.8908e-01],
            [ 9.1349e-01,  1.9612e+00,  7.5800e-02],
            [-6.5236e-01, -9.9946e-01,  1.5193e+00],
            [ 4.3723e-01, -1.2993e+00,  1.1369e-01],
            [ 3.7885e-01,  6.0391e-01, -8.4447e-01],
            [-7.4397e-01,  1.9324e-01,  4.3630e-04],
            [ 4.8969e-01, -1.3271e+00, -1.5485e-01],
            [-1.3304e+00,  1.0269e+00,  2.9893e+00],
            [-4.1473e-01,  1.8239e+00, -9.9708e-01],
            [-1.6525e+00, -2.8958e-02,  4.2383e-01],
            [ 1.8957e+00,  7.6308e-01, -1.3879e-01],
            [ 2.1903e-01,  3.3058e-02, -7.6770e-01],
            [-1.8067e+00,  1.0971e+00,  1.0122e+00],
            [-3.3435e-01, -3.8212e-01,  7.3523e-01],
            [ 2.0851e-01, -1.5241e+00,  2.3372e-01]])
    tensor([[ 3.1758],
            [ 2.2590],
            [ 4.6818],
            [ 1.3247],
            [ 1.4800],
            [ 4.7735],
            [-0.0702],
            [ 5.9423],
            [11.4125],
            [ 2.9251],
            [ 0.5158],
            [11.7134],
            [-5.0757],
            [-4.3074],
            [-2.0593],
            [ 8.7801],
            [ 5.0045],
            [-8.6546],
            [ 4.4253],
            [11.6916]])
    tensor([[ 0.1056, -0.5625, -1.1136],
            [-0.1690,  0.0958, -0.1671],
            [-0.9106,  0.3225,  0.7280],
            [ 0.7942,  0.0105, -0.3856],
            [ 3.1126,  0.1677, -1.2926],
            [-1.3396, -1.2080, -0.4079],
            [-1.6633,  0.7856, -0.8176],
            [ 0.4468, -0.9593,  0.0651],
            [-0.1888, -0.1858,  1.2539],
            [ 2.1191,  0.7607, -0.3598],
            [ 0.7085,  0.5376, -3.6633],
            [ 1.0313,  1.6248,  0.6974],
            [ 2.1208,  0.0614, -1.2515],
            [-0.9943, -2.0435, -0.8443],
            [-1.3039, -0.8081, -0.7499],
            [ 1.1240, -0.0365,  0.1633],
            [ 0.4583, -1.0523,  2.0923],
            [ 0.9741, -0.6444, -2.0296],
            [ 1.1616,  0.3003,  0.4224],
            [-0.7015,  1.4521,  1.0057]])
    tensor([[ 8.0349],
            [ 2.6074],
            [-0.8920],
            [ 7.7851],
            [16.2952],
            [ 3.3428],
            [-5.6171],
            [ 9.6041],
            [ 3.8674],
            [ 9.4126],
            [ 4.4698],
            [ 2.0985],
            [11.9455],
            [ 8.1184],
            [ 2.4498],
            [ 9.1788],
            [ 9.5897],
            [10.9242],
            [ 7.1096],
            [-4.4470]])
    tensor([[-1.2491,  0.9808,  0.3041],
            [-0.0284,  0.2899, -0.9038],
            [ 0.6661, -1.9757, -0.7506],
            [-0.7570, -1.5590, -0.0537],
            [ 0.1677,  0.9583, -2.0381],
            [ 0.8370, -1.2426, -2.9966],
            [-0.5916,  0.9325,  1.1005],
            [ 0.9383,  2.2168,  0.9538],
            [ 1.1925,  0.7255, -0.2912],
            [ 1.9129,  0.7205, -0.4204],
            [ 0.9266, -0.9645, -1.7119],
            [-0.7650,  0.6043, -0.3086],
            [ 0.7328,  0.9191, -0.4883],
            [-0.1884, -0.8393,  1.0134],
            [-1.3747,  0.0377,  1.9668],
            [-1.2402,  0.9827, -0.0995],
            [-0.8349, -0.6095,  0.8233],
            [ 1.4139,  0.1832,  0.4754],
            [-0.2064,  0.8662,  1.9499],
            [ 0.1060,  0.4008,  1.5533]])
    tensor([[-5.2499],
            [ 2.2976],
            [14.9882],
            [ 7.6001],
            [ 0.6263],
            [12.6739],
            [-2.9583],
            [-1.2532],
            [ 6.2145],
            [ 8.2248],
            [12.1831],
            [-1.1116],
            [ 3.9207],
            [ 7.3309],
            [-1.6408],
            [-5.4506],
            [ 3.7102],
            [ 9.1100],
            [ 1.0424],
            [ 3.0079]])
    tensor([[-1.4797,  0.9987, -1.7682],
            [-1.6151, -0.9897,  0.7339],
            [-0.2396, -0.1595, -0.9136],
            [ 0.1695, -0.9127, -0.0301],
            [-0.5257, -0.2358, -0.5638],
            [ 0.7669,  0.8031, -0.6754],
            [-2.5459,  1.6835,  0.7136],
            [-1.0535,  1.0187,  0.5448],
            [-1.4201,  0.2081,  1.0495],
            [ 0.7024,  0.6500, -0.3752],
            [-1.5489, -1.3429,  1.4453],
            [-0.8472, -0.5916,  0.5346],
            [ 0.2121,  0.5016,  1.9348],
            [-0.0542,  0.2105,  0.1446],
            [-0.0584, -0.2285,  1.6695],
            [ 0.7748, -0.6402,  0.8417],
            [ 1.8170,  0.5396, -0.6259],
            [-0.0182,  0.9407,  1.9364],
            [ 1.1095, -0.0922,  0.1698],
            [ 1.4263, -1.2435,  0.4559]])
    tensor([[ -5.6100],
            [  2.5810],
            [  3.5153],
            [  8.1891],
            [  3.4403],
            [  3.4389],
            [-13.4061],
            [ -3.8587],
            [ -2.5110],
            [  4.4817],
            [  3.3296],
            [  2.8047],
            [  3.0675],
            [  3.3710],
            [  5.1546],
            [  9.8412],
            [  9.8928],
            [  0.6605],
            [  9.8762],
            [ 14.5494]])
    tensor([[ 1.5323e-01,  1.3023e+00, -1.1949e+00],
            [ 2.8085e-02,  2.6068e+00,  6.5707e-01],
            [ 5.5946e-01, -1.3206e-01, -8.2712e-01],
            [ 4.1533e-01,  1.8856e+00, -7.0869e-01],
            [ 3.6818e-01,  7.8157e-04, -5.0399e-01],
            [-3.5586e-01,  8.1994e-01, -2.1196e+00],
            [-8.3455e-01,  1.3088e-01, -2.5661e-02],
            [ 4.5900e-01,  7.2401e-01, -2.5026e+00],
            [-1.7615e+00, -5.1887e-01, -1.3750e+00],
            [ 1.0914e+00,  7.3586e-01, -4.1802e-01],
            [ 2.5684e-01,  1.9815e+00,  1.0115e-01],
            [-1.6147e-01, -1.3894e+00, -3.2712e-01],
            [-3.7117e-01,  2.6557e-01, -1.6864e+00],
            [-1.1739e+00,  1.4326e+00,  7.3701e-01],
            [-9.4641e-01, -4.5244e-02,  6.8184e-01],
            [-1.4024e-01, -1.0430e+00,  1.9084e-01],
            [-8.3727e-02,  1.6310e+00, -6.8535e-01],
            [-1.9162e+00, -2.1102e-01, -1.4152e+00],
            [ 2.7035e-02, -7.3635e-02,  9.4739e-01],
            [ 1.4402e+00, -1.2441e-02,  1.0580e+00]])
    tensor([[-0.2175],
            [-6.1386],
            [ 6.7628],
            [-2.0959],
            [ 6.0007],
            [-0.6769],
            [ 0.5417],
            [ 2.5402],
            [-0.5513],
            [ 5.6198],
            [-2.5768],
            [ 9.1381],
            [ 2.2204],
            [-6.9806],
            [ 0.6031],
            [ 7.9403],
            [-1.7183],
            [-2.9550],
            [ 4.1765],
            [ 9.9608]])
    tensor([[-0.6517, -2.1214, -0.7728],
            [-0.1601, -0.0402, -0.5033],
            [-0.2942, -0.3730, -0.6702],
            [ 0.2562,  0.7601, -1.6220],
            [-0.0652, -0.5613, -1.0936],
            [ 0.0875,  1.9314,  1.4452],
            [-0.2257, -1.4286,  0.9325],
            [-0.0969, -0.2150,  0.9086],
            [ 0.4722,  1.9972,  0.9886],
            [-1.4916,  0.1649,  0.3792],
            [-2.1744,  0.8687, -0.4089],
            [ 0.7875,  0.0461,  0.6664],
            [ 0.1319, -0.8788,  0.9657],
            [-0.4655, -0.1068, -1.2817],
            [ 0.1950, -1.0531, -0.0584],
            [-2.3142,  0.0976, -0.0586],
            [ 0.8263,  1.7168, -0.4541],
            [ 0.9911, -1.3996, -1.9072],
            [-0.1445,  0.8423,  0.2822],
            [-1.6798,  0.7014,  0.1231]])
    tensor([[10.3218],
            [ 3.4194],
            [ 3.3733],
            [ 2.5357],
            [ 6.6295],
            [-2.3792],
            [ 8.7626],
            [ 4.9147],
            [-2.0051],
            [-1.7603],
            [-7.8279],
            [ 6.9061],
            [ 7.7658],
            [ 2.6995],
            [ 8.9742],
            [-5.1490],
            [ 0.7835],
            [13.8683],
            [ 1.1674],
            [-6.2657]])
    tensor([[ 0.6721, -0.4149, -1.9249],
            [ 0.2394,  1.0057, -2.6195],
            [ 0.4312, -0.0189,  0.3449],
            [ 0.2797,  2.8553, -0.1184],
            [-0.6481,  0.1927, -1.3179],
            [ 0.3652, -0.6978,  0.0991],
            [-0.9611, -0.6891, -1.6412],
            [-0.0196, -2.8157,  1.2758],
            [-0.1041,  0.4285, -0.3650],
            [ 0.1914, -1.4124, -1.4772],
            [ 1.1354,  0.6912, -1.8568],
            [ 0.7874,  0.0116,  0.5375],
            [ 0.0925, -0.2144, -0.0577],
            [-1.4521,  0.8694,  1.5208],
            [ 1.4466, -0.0159,  2.2753],
            [-1.8679,  0.2107, -0.0645],
            [-0.0555,  0.2693,  0.2991],
            [ 1.4849,  0.1601, -0.3541],
            [ 0.4093,  0.1906,  0.2286],
            [-0.0538,  1.3169,  1.0729]])
    tensor([[ 8.8715],
            [ 1.6189],
            [ 5.3706],
            [-5.7628],
            [ 0.4788],
            [ 8.2015],
            [ 3.0324],
            [15.2866],
            [ 2.3299],
            [10.8019],
            [ 5.7336],
            [ 7.3360],
            [ 5.2144],
            [-4.3787],
            [ 9.7121],
            [-4.0551],
            [ 3.1553],
            [ 8.9889],
            [ 5.0220],
            [-1.7694]])
    tensor([[-0.0539,  0.7977,  0.3470],
            [ 1.0206,  1.5068,  1.2944],
            [ 1.4196, -0.4128, -0.5747],
            [ 2.4990, -0.2282, -1.0368],
            [ 1.8091,  0.3238, -1.0270],
            [ 3.0134,  1.6429, -0.2787],
            [-0.3441,  1.0041,  1.3746],
            [-0.1243, -0.3708, -1.0745],
            [-0.7819, -0.7857, -1.6888],
            [-0.8602,  0.7038, -1.7612],
            [-1.0517,  0.0567,  0.5966],
            [ 0.4026, -2.5575,  0.6639],
            [-1.6201,  0.0724,  0.4146],
            [ 1.5365, -2.1843,  1.0118],
            [-0.4970, -0.1227,  0.9978],
            [-1.2071, -0.1158,  0.6121],
            [ 0.2921,  0.0426, -0.0815],
            [-1.1453, -0.0814,  1.7962],
            [-0.5101, -0.4505,  0.1750],
            [ 1.0519,  0.2630, -0.7224]])
    tensor([[ 0.3462],
            [ 2.1056],
            [12.4433],
            [15.0744],
            [ 8.9758],
            [ 9.5559],
            [-1.3487],
            [ 5.3649],
            [ 4.4988],
            [-1.3765],
            [-0.3117],
            [16.0128],
            [-3.5445],
            [19.3534],
            [ 3.1739],
            [-0.3745],
            [ 5.0555],
            [-0.3336],
            [ 4.6146],
            [ 7.0010]])
    tensor([[ 0.4770,  1.4054, -0.4750],
            [ 0.3815,  0.4526,  0.5312],
            [ 0.1145,  0.5040,  0.4203],
            [-0.4314, -0.5167,  0.5266],
            [-1.1518, -2.0618, -0.0032],
            [-1.7601,  1.7168,  2.3953],
            [ 0.4475,  0.2761,  0.1691],
            [ 1.0913,  1.7226, -2.2885],
            [ 1.2385, -0.6471, -0.2023],
            [ 0.4968,  1.5036, -1.1048],
            [-0.0237, -0.4751, -0.1800],
            [-1.6954,  0.6662, -0.2504],
            [-0.1985, -1.2402,  0.8391],
            [ 0.3848,  2.7160, -1.5725],
            [-0.0371,  0.4132, -1.5350],
            [-1.6981,  1.2399, -0.3351],
            [ 0.0665, -0.7563,  1.2004],
            [-0.1710,  0.7211,  1.7774],
            [-0.1633, -2.1746, -1.3167],
            [-0.4318,  1.7017,  0.0294]])
    tensor([[-0.0148],
            [ 3.7431],
            [ 2.0131],
            [ 4.5354],
            [ 7.4198],
            [-9.7957],
            [ 5.2523],
            [ 0.7929],
            [11.9712],
            [-0.6159],
            [ 5.4378],
            [-5.0592],
            [ 7.9553],
            [-4.8818],
            [ 1.4394],
            [-8.7090],
            [ 7.7656],
            [-0.0165],
            [12.0635],
            [-4.1570]])
    tensor([[ 0.1865,  1.1571,  0.5892],
            [ 0.2851,  0.2529, -1.2040],
            [ 0.3054,  0.2191, -0.5630],
            [ 0.8851, -0.5935, -0.4272],
            [ 0.8916,  0.4175,  1.3723],
            [ 0.6117,  0.7745, -0.6735],
            [-1.5624, -0.6224, -1.1428],
            [-0.7007,  1.9914, -1.3469],
            [ 2.0645,  0.3167,  1.2453],
            [-1.2416, -0.5508, -1.2918],
            [-0.3585, -0.7206, -0.6924],
            [ 1.0671, -0.1635, -1.7418],
            [-0.2371, -0.1490,  0.2408],
            [ 0.3191, -1.3337,  1.1790],
            [ 1.8817,  0.2426, -0.4269],
            [ 2.3500, -0.7447, -0.5801],
            [ 0.8268, -0.3250, -0.7335],
            [ 0.3067, -1.4395,  0.0175],
            [ 0.0286,  0.1884, -0.7071],
            [-0.1579,  0.7668,  0.8180]])
    tensor([[ 0.6956],
            [ 4.7993],
            [ 4.5952],
            [10.1162],
            [ 5.1671],
            [ 3.8386],
            [ 1.1940],
            [-6.1408],
            [10.8885],
            [ 1.8651],
            [ 5.7578],
            [ 8.4016],
            [ 3.9931],
            [10.2680],
            [11.0953],
            [17.3184],
            [ 8.0579],
            [10.2883],
            [ 3.5242],
            [ 0.3345]])
    tensor([[ 0.4978,  0.4411, -1.1506],
            [-0.8482,  0.6954, -0.2734],
            [ 0.8248,  0.1164,  0.5651],
            [-0.6320,  0.3055,  0.5172],
            [ 0.5824,  0.0629, -0.3819],
            [-0.0488,  0.4915, -0.7932],
            [ 0.2989,  0.5319,  1.0046],
            [ 0.8285, -0.0356, -0.0156],
            [ 0.7087, -1.0583,  1.8622],
            [-0.1454,  1.0666, -0.0813],
            [-0.5385, -0.0897, -0.4179],
            [-0.5621,  1.8981,  0.0543],
            [-0.2723,  0.2270,  0.8600],
            [-1.5212,  2.4551, -0.9397],
            [ 0.8385, -0.5068, -0.3129],
            [ 0.3178,  0.0755,  0.1124],
            [ 1.1548, -0.6282, -0.9673],
            [-0.0422, -0.5255, -0.1879],
            [-0.9026,  0.3222, -1.0812],
            [ 2.4968,  0.2710, -1.1895]])
    tensor([[  3.8951],
            [ -1.9789],
            [  6.9998],
            [  0.1812],
            [  6.7483],
            [  2.2060],
            [  3.4102],
            [  7.9601],
            [ 10.9509],
            [ -1.3045],
            [  2.5509],
            [ -4.8438],
            [  2.7083],
            [-12.0394],
            [ 10.1367],
            [  4.3370],
            [ 11.8942],
            [  5.6298],
            [ -1.0434],
            [ 13.4481]])
    tensor([[ 0.1272, -0.1332, -0.5443],
            [-0.6733,  0.2327,  0.0485],
            [-2.0611, -0.3536,  0.3248],
            [-0.4366,  0.0721, -1.0331],
            [ 1.4922, -0.4403,  0.5878],
            [ 0.1804, -0.2961,  0.2102],
            [ 1.2940,  1.3558, -1.1941],
            [ 0.3568,  1.1653,  1.2152],
            [ 0.0860,  0.2583, -0.1414],
            [-1.5108, -0.7617, -0.8972],
            [-0.3739, -1.1306, -1.2133],
            [-1.0241, -0.7693,  0.0150],
            [ 0.8922,  0.6252, -0.3366],
            [ 0.7656,  0.0853, -0.0868],
            [-1.1467,  1.0182, -0.7720],
            [ 0.5780,  0.1099,  0.9910],
            [-0.3575, -0.7454,  0.6046],
            [ 0.7143,  2.4877,  1.1616],
            [-1.0744, -0.1269, -1.5939],
            [ 0.3287,  0.6692, -0.3149]])
    tensor([[ 4.6031],
            [-0.0383],
            [-1.9884],
            [ 1.8237],
            [11.5938],
            [ 6.7764],
            [ 3.4064],
            [ 1.0107],
            [ 3.8803],
            [ 0.7319],
            [ 6.8399],
            [ 3.3593],
            [ 5.2079],
            [ 7.8494],
            [-3.9388],
            [ 5.6599],
            [ 6.0198],
            [-3.6548],
            [ 1.0707],
            [ 3.1225]])
    tensor([[ 0.4929, -0.2252, -1.5694],
            [-2.3228, -3.0075, -0.5667],
            [-0.8935, -0.5798,  2.1089],
            [ 0.2505,  0.8152, -0.0497],
            [ 0.0655,  0.2328, -1.3075],
            [ 1.5841,  1.3538,  0.6998],
            [-0.2695, -1.0752,  0.4547],
            [-0.8783,  0.0578, -2.2478],
            [-0.8752,  0.6025,  0.4590],
            [-1.2415, -0.3907,  0.1477],
            [-0.4471, -1.0591, -0.4365],
            [-1.1046, -0.1853, -0.5949],
            [-2.0212,  1.2904,  0.4943],
            [ 0.4529,  0.0596, -0.7658],
            [-0.4616,  1.6006,  1.0893],
            [-0.8520,  0.1359,  1.7951],
            [-0.5779, -0.1217,  0.3598],
            [-0.7449, -1.0000, -0.8709],
            [ 0.0716,  0.9170,  0.8377],
            [-0.0639,  0.5729, -1.3212]])
    tensor([[ 6.3727],
            [ 6.0393],
            [ 3.5855],
            [ 1.4052],
            [ 3.5680],
            [ 4.8187],
            [ 6.9551],
            [-0.2190],
            [-1.4391],
            [ 0.2195],
            [ 6.3975],
            [ 0.3667],
            [-9.1924],
            [ 6.0394],
            [-3.2385],
            [ 0.6125],
            [ 3.1417],
            [ 5.1261],
            [ 0.2760],
            [ 2.2270]])
    tensor([[-0.6448, -1.5750, -0.8212],
            [-0.9531,  0.9115,  0.1053],
            [ 0.2335,  0.4674,  1.4958],
            [-0.3211, -0.1116,  0.8303],
            [ 0.7787, -0.7646,  0.5765],
            [-0.4881, -0.3919,  0.0693],
            [ 0.2876,  0.0922, -0.7169],
            [-1.7562,  0.8625,  2.1742],
            [-0.3323,  0.2528,  0.5212],
            [-1.2242, -0.1251, -1.2860],
            [-0.4171,  1.1499, -2.6345],
            [-1.3241, -0.9108, -0.4982],
            [-0.0407, -0.9859, -0.2243],
            [ 1.7812, -1.2723,  0.3879],
            [ 1.3089,  0.4337,  0.1849],
            [-0.9839, -1.3278, -0.4650],
            [ 0.8070,  0.4573, -1.0079],
            [-1.9253,  0.9967,  0.0145],
            [-0.9219, -1.4154,  0.3979],
            [-1.2403,  1.6386, -0.9881]])
    tensor([[ 8.2148],
            [-4.1118],
            [ 2.9158],
            [ 3.1375],
            [ 9.8759],
            [ 4.4208],
            [ 4.5230],
            [-5.9265],
            [ 0.5502],
            [-0.3358],
            [-2.3829],
            [ 2.2127],
            [ 8.7417],
            [15.3910],
            [ 7.7573],
            [ 5.4187],
            [ 5.4724],
            [-7.9900],
            [ 6.2524],
            [-7.5596]])
    tensor([[-0.9277,  0.2869,  0.2058],
            [-1.3373,  0.6541, -1.2302],
            [-0.2952,  1.4202,  0.5730],
            [-0.6167,  1.6458, -0.1558],
            [-0.4671,  0.3534,  0.0143],
            [ 0.4720, -1.0600, -1.0976],
            [-0.2493,  0.3080, -0.0737],
            [-1.3043, -0.4336,  1.8439],
            [-1.1820, -0.2551, -0.3874],
            [ 1.2205,  0.7130,  0.4872],
            [ 0.1431,  0.1743,  0.6280],
            [-1.2184, -2.2693,  1.3399],
            [-0.6139,  0.7064, -0.0187],
            [ 0.2893, -0.9597, -1.1698],
            [-0.5280, -0.1512,  0.7789],
            [-1.0931,  0.0601, -2.6819],
            [-0.4027, -1.0183, -2.7601],
            [ 0.9724,  1.0768, -0.0954],
            [ 1.9363,  0.9876,  1.0202],
            [ 0.6033,  0.3538, -0.5467]])
    tensor([[-0.5508],
            [-3.5437],
            [-2.6895],
            [-4.3654],
            [ 2.0289],
            [ 9.3419],
            [ 1.0810],
            [ 0.8221],
            [-0.1710],
            [ 6.6050],
            [ 3.6237],
            [ 8.1622],
            [-2.5156],
            [ 8.8661],
            [ 2.9062],
            [-1.0792],
            [ 6.3184],
            [ 3.8316],
            [ 8.5339],
            [ 5.0772]])
    tensor([[-0.3314, -0.7783,  0.2522],
            [ 0.3527,  0.6686,  0.3282],
            [ 0.2864,  0.5350, -0.9058],
            [-1.9720, -0.3099,  0.4947],
            [ 0.7386,  1.5635,  0.4574],
            [ 0.7547,  2.2278, -1.3429],
            [ 1.3713, -0.3485,  0.4635],
            [-0.4056, -0.4302,  1.1539],
            [-2.1650,  1.1327,  1.8262],
            [-0.7014, -0.5834,  0.1541],
            [-1.0186, -0.4647, -0.1292],
            [-0.3775, -0.6547, -0.8939],
            [ 0.2630, -0.8565,  1.6462],
            [-0.0858,  0.3251, -0.5006],
            [ 0.0667,  0.4543,  0.2241],
            [-0.1220,  0.7925, -0.3081],
            [ 0.5931,  0.5176,  0.3960],
            [ 1.0415,  2.1404,  2.2892],
            [-0.0217, -1.6442, -1.1317],
            [-1.2354, -0.3282,  0.6105]])
    tensor([[ 6.4140],
            [ 2.6743],
            [ 2.7964],
            [-2.6455],
            [ 1.5716],
            [-1.7635],
            [11.2442],
            [ 4.0107],
            [-9.0716],
            [ 4.3396],
            [ 1.7860],
            [ 5.3902],
            [ 9.3270],
            [ 2.2702],
            [ 2.1380],
            [ 0.7802],
            [ 4.3583],
            [ 0.1188],
            [12.0504],
            [ 0.3012]])
    tensor([[-0.3002,  0.2491, -1.6065],
            [-1.0009, -0.4658,  0.0041],
            [-0.3685, -1.0031, -0.4331],
            [-0.1025,  0.4326,  1.0003],
            [ 0.8706,  0.5249,  0.6616],
            [ 1.0219,  0.2361,  0.4922],
            [ 0.2220,  1.1316, -1.4063],
            [ 0.2144, -1.0907,  0.2033],
            [ 1.5438, -1.2642,  0.4228],
            [-0.4866,  1.7839, -0.8801],
            [ 0.6552,  3.7649,  0.1353],
            [-1.0476,  0.9073, -1.1041],
            [-0.4434,  0.2756, -0.3886],
            [ 0.4087,  0.4478,  0.0906],
            [ 0.7671, -1.3368, -1.4285],
            [ 0.5069, -1.1674,  1.2003],
            [-0.7568,  0.1675, -0.2087],
            [ 0.4948, -0.4539,  0.9268],
            [ 0.4039,  0.6711,  0.4925],
            [-0.0287, -1.8339,  0.1925]])
    tensor([[ 1.6878],
            [ 1.6259],
            [ 6.0383],
            [ 2.0967],
            [ 5.6357],
            [ 7.9575],
            [-0.0355],
            [ 8.8141],
            [16.7065],
            [-4.7589],
            [-8.0262],
            [-3.5133],
            [ 0.5297],
            [ 4.8311],
            [13.1974],
            [10.7427],
            [ 0.7207],
            [ 7.6252],
            [ 2.9148],
            [11.1959]])
    tensor([[ 0.7641, -0.2505, -1.4418],
            [-1.7050,  0.9938,  0.9277],
            [-0.7822,  1.2477,  0.1595],
            [ 2.1692, -0.3017,  1.5722],
            [ 2.3725, -1.9664,  2.3802],
            [ 1.4753,  0.1104,  1.2395],
            [ 0.2048, -0.9704, -0.3908],
            [ 1.7030, -0.8826, -0.2310],
            [-0.7356,  0.3853,  0.2261],
            [ 0.2798, -0.4171, -0.6912],
            [-0.2217,  0.0529, -1.8849],
            [-0.3267, -1.1118,  0.0668],
            [-0.8576, -0.8268,  1.9427],
            [ 0.6042,  0.1731,  0.0336],
            [-0.3565, -1.4052,  0.2632],
            [-2.3992, -0.6850, -0.7758],
            [-1.2147, -0.3952, -1.5490],
            [-0.8903,  0.6684,  0.8988],
            [-0.1539,  0.9876,  0.6239],
            [-0.3385,  0.4034,  0.0310]])
    tensor([[ 8.1489],
            [-6.9729],
            [-4.4690],
            [14.4245],
            [20.6567],
            [ 8.6979],
            [ 8.0916],
            [14.8570],
            [-0.6222],
            [ 7.2450],
            [ 2.3490],
            [ 7.8900],
            [ 3.2649],
            [ 5.5781],
            [ 8.8081],
            [-2.6507],
            [ 1.2808],
            [-1.9712],
            [-0.5667],
            [ 0.9646]])
    tensor([[-1.9623, -0.9569, -2.6180],
            [-1.8576,  0.3843, -0.6040],
            [-0.2846, -0.5214, -0.9688],
            [ 0.2716, -0.0356, -0.8574],
            [ 0.5528,  0.4445, -0.2342],
            [-1.1569,  0.3039, -1.2251],
            [-0.7533, -0.1067,  0.7464],
            [-1.6093, -0.7134, -1.8434],
            [ 0.0073,  0.4898,  0.6274],
            [ 1.3085,  1.5148, -0.2014],
            [ 2.0692, -0.5178,  0.2822],
            [-0.2887, -1.1275,  0.5540],
            [-1.8585,  0.2777,  0.3783],
            [-1.6405,  0.7656,  0.3414],
            [ 0.0772,  1.0958,  1.5861],
            [ 0.7728,  0.1605,  1.4797],
            [ 1.1300, -0.3875, -0.1300],
            [ 0.7409,  0.7478, -1.0844],
            [-1.5247, -1.2240, -2.5115],
            [ 0.3753, -0.6539,  1.8121]])
    tensor([[-0.1014],
            [-5.0963],
            [ 6.3282],
            [ 6.1073],
            [ 4.5085],
            [-1.8375],
            [ 1.6517],
            [ 0.1568],
            [ 2.3236],
            [ 4.0210],
            [13.9995],
            [ 7.5258],
            [-4.5063],
            [-5.7711],
            [ 0.3380],
            [ 6.8233],
            [10.9740],
            [ 4.8432],
            [ 3.0747],
            [ 8.3641]])
    tensor([[-1.4190, -0.0977, -0.1992],
            [-1.0972,  1.7611, -0.1861],
            [ 0.5676,  0.1543, -1.6763],
            [ 0.8710,  1.1483, -0.2562],
            [-0.0194,  0.8378,  1.0214],
            [ 0.9480, -0.7292, -0.2351],
            [-0.8593, -0.3135, -0.3954],
            [-0.8842,  0.1737, -0.9187],
            [-0.3910, -0.5323, -1.0930],
            [-0.5773, -0.6949, -0.1864],
            [ 0.9534,  1.1134, -1.4850],
            [ 0.7504,  0.5575, -1.0551],
            [ 0.7133,  1.0747,  0.5155],
            [ 0.4588,  0.3240,  0.1969],
            [-0.8744,  2.1305,  1.3443],
            [ 0.5785,  1.2283,  1.8724],
            [ 0.3929, -1.0569, -0.1975],
            [ 0.2326, -0.1616, -2.9166],
            [-2.2209,  0.6745, -0.3336],
            [ 0.5480,  1.7745,  0.7055]])
    tensor([[-1.5106],
            [-7.8075],
            [ 5.6531],
            [ 4.3484],
            [ 1.3066],
            [11.2777],
            [ 2.0921],
            [-0.5675],
            [ 4.5755],
            [ 4.6639],
            [ 3.8275],
            [ 5.1509],
            [ 2.3318],
            [ 4.2669],
            [-7.7998],
            [ 1.4842],
            [10.0587],
            [ 5.4209],
            [-7.1589],
            [-1.1586]])
    tensor([[-0.9125,  0.1986, -1.3727],
            [ 0.1203, -0.8980,  0.4552],
            [ 0.5495, -0.6956, -0.1364],
            [ 0.8797, -0.6060, -0.3951],
            [-1.4134,  0.9098,  1.0756],
            [ 0.6173, -0.2954,  1.5691],
            [ 1.7886,  0.4169,  0.3638],
            [ 0.0820, -0.8410, -0.7384],
            [ 0.3549, -0.3484, -1.3630],
            [-0.5694, -0.9939,  0.7618],
            [-2.0779,  0.5148,  0.1049],
            [-0.3887,  0.0240,  0.8875],
            [ 0.8696, -1.3160,  0.9429],
            [ 0.3208,  1.5099,  1.5641],
            [ 0.7503, -1.6506, -0.5284],
            [ 0.0627, -1.0483,  0.2815],
            [ 1.4228, -0.5887,  0.0521],
            [-1.9489,  0.4750, -1.0755],
            [ 0.2315,  1.0728,  2.1343],
            [ 0.2648, -1.1512, -0.2171]])
    tensor([[-0.2354],
            [ 8.0266],
            [ 8.5119],
            [10.6767],
            [-5.3668],
            [ 8.0516],
            [10.2359],
            [ 7.5103],
            [ 7.5451],
            [ 5.2066],
            [-6.2341],
            [ 3.2627],
            [12.8973],
            [-1.4387],
            [14.4037],
            [ 9.0836],
            [11.4843],
            [-5.1487],
            [ 0.7716],
            [ 9.7296]])
    tensor([[ 1.3184,  1.0606, -0.6285],
            [ 0.0189,  1.0177, -0.0027],
            [-0.2689,  0.9281, -0.1082],
            [ 0.6991,  0.9412,  0.9150],
            [ 1.1105, -0.2418, -1.7976],
            [ 1.2120,  0.6796,  0.8446],
            [ 0.0555,  1.5666, -1.3201],
            [ 1.6169,  0.1512,  0.6355],
            [ 1.3757, -2.2675, -0.8321],
            [-1.1992,  0.6193,  0.0309],
            [-2.4549, -0.6184, -2.1439],
            [ 0.5249, -1.1299, -0.4482],
            [-0.4714,  0.5159,  0.6341],
            [ 1.2227,  0.0685,  0.9979],
            [-0.3117,  0.4106, -0.5320],
            [ 1.0406, -1.1745, -0.9786],
            [ 1.4393,  0.3534, -0.7446],
            [-0.5905, -0.2514,  0.3295],
            [ 0.2353,  0.4585, -0.7704],
            [-1.3209, -1.4288, -0.3997]])
    tensor([[ 4.4701],
            [-0.0791],
            [-1.1888],
            [ 4.1896],
            [ 9.9004],
            [ 6.7787],
            [-2.2239],
            [10.0668],
            [18.6577],
            [-2.4243],
            [-3.6047],
            [10.2548],
            [-0.0612],
            [ 9.3035],
            [ 1.4245],
            [13.3451],
            [ 8.9961],
            [ 2.7516],
            [ 2.8307],
            [ 4.6235]])
    tensor([[-1.2447, -0.0268,  1.3969],
            [-0.8098, -0.5156,  0.3082],
            [-1.1865,  1.4916,  1.9552],
            [-0.0786, -1.1000,  0.6323],
            [ 0.7994,  2.3544, -0.9623],
            [ 0.3977, -0.6646, -0.2692],
            [ 1.0421,  0.8808, -1.6408],
            [-1.3501,  0.8660,  0.4901],
            [ 1.4133, -1.5295,  0.4593],
            [ 1.1167,  1.4609, -0.6300],
            [-0.2207, -1.0561, -0.6364],
            [ 1.5409,  0.7230, -0.2909],
            [-2.4326, -2.1902,  1.1990],
            [ 0.8519, -0.5104,  1.5069],
            [ 0.4489, -0.1673,  0.6766],
            [ 1.1006,  0.5591, -0.4248],
            [-0.2711,  1.1419,  0.1262],
            [-0.0670, -0.2529,  1.3670],
            [-0.2790,  0.8119, -0.6237],
            [ 0.1897, -0.6877,  0.4253]])
    tensor([[-0.8691],
            [ 2.2317],
            [-6.6245],
            [ 8.5698],
            [-2.0542],
            [ 9.4281],
            [ 3.5080],
            [-4.8258],
            [16.1466],
            [ 2.2991],
            [ 7.8644],
            [ 7.5282],
            [ 4.0125],
            [ 9.8635],
            [ 6.4430],
            [ 6.7275],
            [-0.8746],
            [ 4.2064],
            [ 0.4681],
            [ 7.4872]])
    tensor([[-1.0405, -0.1793, -0.2663],
            [-0.6315,  0.5792,  0.0081],
            [ 1.4313, -0.3124, -0.3280],
            [ 1.1849,  0.2644,  0.5466],
            [ 1.6661,  0.9232,  0.1825],
            [-0.0709, -0.3409, -0.8390],
            [-0.7933, -1.2820, -0.0131],
            [ 0.4241, -0.3581, -0.5719],
            [ 0.1526,  0.2054,  0.2577],
            [-1.8259, -1.2023,  0.2107],
            [-0.1537, -0.3124,  0.1902],
            [-0.1596, -0.6952, -0.8160],
            [ 0.6528,  0.8309, -0.9029],
            [ 1.6495,  1.6559,  0.1964],
            [-1.1279,  0.4739, -1.4747],
            [-1.1272,  1.3952, -1.0960],
            [ 0.4358,  0.2309,  1.2708],
            [-0.4814, -0.5229, -1.3105],
            [-0.8187, -0.5373, -0.3809],
            [-1.0609, -1.4085, -0.4811]])
    tensor([[ 0.7425],
            [ 0.4858],
            [11.3755],
            [ 7.7247],
            [ 7.1996],
            [ 4.9992],
            [ 6.4904],
            [ 6.9274],
            [ 3.5065],
            [ 0.7400],
            [ 4.3049],
            [ 5.9892],
            [ 3.4319],
            [ 3.7415],
            [-1.8984],
            [-5.9132],
            [ 5.3838],
            [ 4.3282],
            [ 2.7647],
            [ 6.1025]])
    tensor([[-1.0551e+00,  7.5096e-01, -1.4075e+00],
            [-1.0893e+00, -3.8793e-01,  1.3744e+00],
            [-6.3216e-01,  3.3512e-01,  1.3013e+00],
            [-7.2074e-01, -5.0575e-01,  8.9490e-01],
            [-7.0509e-01,  3.4066e-02, -8.9298e-01],
            [-6.4015e-01,  1.4002e-02, -2.5387e-01],
            [ 9.4656e-01, -7.4954e-01,  1.0293e+00],
            [-8.9979e-01,  6.0619e-01,  7.1383e-01],
            [ 1.3895e+00, -7.2156e-01, -5.7672e-01],
            [ 7.4782e-01, -1.9124e+00, -1.3226e+00],
            [-4.2237e-01, -1.8890e-01,  1.2025e+00],
            [ 1.0931e+00, -1.8273e-03,  9.9160e-01],
            [-1.1168e+00, -3.9097e-01,  1.0477e-01],
            [-4.4996e-03,  1.2482e+00, -1.2982e+00],
            [ 1.5986e+00, -7.0500e-01,  1.7146e-02],
            [-6.6684e-01, -2.5393e+00, -2.7621e-01],
            [ 1.3844e+00, -2.7524e-02, -1.1073e+00],
            [-7.6633e-02, -1.6430e+00, -8.0669e-01],
            [ 3.6001e-01,  2.7236e-01, -9.6930e-01],
            [ 3.4576e-01, -6.6754e-01,  7.4425e-01]])
    tensor([[-2.8150],
            [ 1.6307],
            [-0.7538],
            [ 3.8923],
            [ 1.4094],
            [ 1.2490],
            [10.6256],
            [-2.5780],
            [12.6901],
            [15.1280],
            [ 3.2847],
            [ 8.1353],
            [ 1.7358],
            [-1.5873],
            [13.0011],
            [12.4110],
            [ 9.9579],
            [10.9958],
            [ 5.0149],
            [ 7.3459]])
    

## 定义模型
* 对于标准深度学习模型，我们可以[**使用框架的预定义好的层**]。这使我们只需关注使用哪些层来构造模型，而不必关注层的实现细节。
* 我们首先定义一个模型变量`net`，它是一个`Sequential`类的实例。
    * `Sequential`类将多个层串联在一起。
    * 当给定输入数据时，`Sequential`实例将数据传入到第一层，
    * 然后将第一层的输出作为第二层的输入，以此类推。
    * 在下面的例子中，我们的模型只包含一个层，因此实际上不需要`Sequential`。
    * 但是由于以后几乎所有的模型都是多层的，在这里使用`Sequential`会让你熟悉“标准的流水线”。
* *全连接层*（fully-connected layer）是每一个结点都与上一层的所有结点相连，用来把前边提取到的特征综合起来。

* 在PyTorch中，全连接层在Linear类中定义。 值得注意的是，我们将两个参数传递到nn.Linear中。 第一个指定输入特征形状，即2，第二个指定输出特征形状，输出特征形状为单个标量，因此为1。




```python
import torch.nn as nn
net = nn.Sequential(nn.Linear(3,1))
```

## 初始化模型参数
* 我们通过`net[0]`选择网络中的第一个图层，
* 然后使用`weight.data`和`bias.data`方法访问参数。
* 使用替换方法`normal_`和`fill_`来重写参数值。


```python
net[0].weight.data.normal_(0,0.01)
net[0].bias.data.fill_(0)
```




    tensor([0.])



## 定义损失函数
* [**计算均方误差使用的是`MSELoss`类，也称为平方$L_2$范数**]。
* 默认情况下，它返回所有样本损失的平均值。
* 


```python
loss = nn.MSELoss(reduction="mean")
# loss = nn.MSELoss(reduction="sum")
```

## 定义优化算法
* 小批量随机梯度下降算法是一种优化神经网络的标准工具，
* PyTorch在`optim`模块中实现了该算法的许多变种。
* 当我们(**实例化一个`SGD`实例**)时，我们要指定优化的参数
* （可通过`net.parameters()`从我们的模型中获得）以及优化算法所需的超参数字典。
* 小批量随机梯度下降只需要设置`lr`值，这里设置为0.03。
* 
* 参数：
    * params (iterable) – 待优化参数的iterable或者是定义了参数组的dict
    * lr (float) – 学习率
    * momentum (float, 可选) – 动量因子（默认：0）
    * weight_decay (float, 可选) – 权重衰减（L2惩罚）（默认：0）
    * dampening (float, 可选) – 动量的抑制因子（默认：0）
    * nesterov (bool, 可选) – 使用Nesterov动量（默认：False）



```python
trainer = torch.optim.SGD(net.parameters(),lr=0.03)
```

## 三个概念：Epoch, Batch, Iteration
* Epoch（时期）：
* 一个Epoch就是将所有训练样本训练一次的过程。
* 
* Batch（批 / 一批样本）：
* 当一个Epoch的样本（也就是所有的训练样本）数量可能太过庞大（对于计算机而言），就需要把它分成多个小块，也就是就是分成多个Batch 来进行训练。
* 将整个训练样本分成若干个Batch。
* 
* Batch_Size（批大小）：
* 每批样本的大小。
* 
* Iteration（一次迭代）：
* 训练一个Batch就是一次Iteration

## 训练
* 通过深度学习框架的高级API来实现我们的模型只需要相对较少的代码。
* 我们不必单独分配参数、不必定义我们的损失函数，也不必手动实现小批量随机梯度下降。
* 当我们需要更复杂的模型时，高级API的优势将大大增加。
* 
* 回顾一下：在每个迭代周期里，我们将完整遍历一次数据集（`train_data`），
* 不停地从中获取一个小批量的输入和相应的标签。
* 对于每一个小批量，我们会进行以下步骤:
    * 通过调用`net(X)`生成预测并计算损失`l`（前向传播）。
    * 通过进行反向传播来计算梯度。
    * 通过调用优化器来更新模型参数。
* 为了更好的衡量训练效果，我们计算每个迭代周期后的损失，并打印它来监控训练过程。


```python
epochTimes=4
for i in range(epochTimes):
    for samples,labels in iterableBatchList:
        los = loss(net(samples),labels)      #前向传播，计算损失函数
        # print("patchLoss:",los)
        trainer.zero_grad()                 #置零模型所有参数的偏导
        los.backward()                       #反向传播梯度
        trainer.step()                      #根据梯度计算并更新模型参数
    
    print("epochTimes:",i)
    print(loss(net(samplesX),labelsY))
    

```

    epochTimes: 0
    tensor(3.0501, grad_fn=<MseLossBackward>)
    epochTimes: 1
    tensor(0.4196, grad_fn=<MseLossBackward>)
    epochTimes: 2
    tensor(0.2494, grad_fn=<MseLossBackward>)
    epochTimes: 3
    tensor(0.2393, grad_fn=<MseLossBackward>)
    


```python
epochTimes=4
for i in range(epochTimes):
    # print(real_w)
    # print(net[0].weight.data.reshape(3,1))
    # fig=plt.figure(num="id-1",figsize=(40,5))
    # axes1=fig.add_subplot(1,3,1)
    # axes1.scatter(samplesX[:,0].detach(),labelsY[:].detach(),color="r")
    # # axes1.plot(samplesX[:,0].detach(), net[0].weight.data[0][0] * samplesX[:,0].detach() ,color="b")
    # axes1.scatter(samplesX[:,0].detach(), net(samplesX)[:].detach() ,color="b")
    # axes2=fig.add_subplot(1,3,2)
    # axes2.scatter(samplesX[:,1].detach(),labelsY[:].detach(),color="r")
    # # axes2.plot(samplesX[:,1].detach(), net[0].weight.data[0][1] * samplesX[:,1].detach() ,color="b")
    # axes2.scatter(samplesX[:,1].detach(),net(samplesX)[:].detach(),color="b")
    # axes3=fig.add_subplot(1,3,3)
    # axes3.scatter(samplesX[:,2].detach(),labelsY[:].detach(),color="r")
    # # axes3.plot(samplesX[:,2].detach(), net[0].weight.data[0][2] * samplesX[:,2].detach() ,color="b")
    # axes3.scatter(samplesX[:,2].detach(),net(samplesX)[:].detach(),color="b")
    # plt.show()

    for samples,labels in iterableBatchList:
        los = loss(net(samples),labels)      #前向传播，计算损失函数
        trainer.zero_grad()                 #置零模型所有参数的偏导
        los.backward()                       #反向传播梯度
        trainer.step()                      #根据梯度计算并更新模型参数
    

```

## 小结
* 我们可以使用PyTorch的高级API更简洁地实现模型。
* 在PyTorch中，`data`模块提供了数据处理工具，`nn`模块定义了大量的神经网络层和常见损失函数。
* 我们可以通过`_`结尾的方法将参数替换，从而初始化参数。


## 练习

1. 如果将小批量的总损失替换为小批量损失的平均值，你需要如何更改学习率？
    * 意思是用nn.MSELoss(reduction=‘sum’)替换 ，nn.MSELoss（）”为了使代码的行为相同，需要怎么更改学习速率？为什么？
    * 答：应该把学习率除以batch_size，因为默认参数是’mean’，换成’sum’需要除以批量数，一般会采用默认，因为这样学习率可以跟batch_size解耦(老师直播讲了~~
1. 查看深度学习框架文档，它们提供了哪些损失函数和初始化方法？用Huber损失代替原损失，即
    $$l(y,y') = \begin{cases}|y-y'| -\frac{\sigma}{2} & \text{ if } |y-y'| > \sigma \\ \frac{1}{2 \sigma} (y-y')^2 & \text{ 其它情况}\end{cases}$$
    * 答 loss = nn.SmoothL1Loss(beta=1.0)
1. 你如何访问线性回归的梯度？


```python
loss = nn.SmoothL1Loss(beta=1.0)
```
