---
title: 卡尔曼滤波器:卡尔曼增益推导
shortTitle: 卡尔曼增益推导
date: 2025-01-08T03:50:00+08:00
article: false 
index: true
order: 4
---

## 卡尔曼滤波器学习笔记

> [`【卡尔曼滤波器】_DR_CAN合集`学习笔记](https://www.bilibili.com/video/BV1hC4y1b7K7)

## 卡尔曼增益推导


对于一个经过离散化的包含过程噪声和测量噪声的状态空间方程：

$$
\begin{cases}
    \mathbf{x}_{k} &= A \mathbf{x}_{k-1} + B \mathbf{u}_{k-1} + \mathbf{w}_{k-1} \\
    \mathbf{z}_k &= H\mathbf{x}_k + \mathbf{v}_k \\
\end{cases}
$$

其中过程噪声$\mathbf{w}$符合正态分布:

$$
\begin{align*}
    \mathbf{w} &\sim \mathcal{N}(\mu,\,Q) \\
      \mu &= E(\mathbf{w}) = 0 \\
      Q &= \text{Var}(\mathbf{w}) \\
        &= E(\mathbf{w}^2) - E^2(\mathbf{w}) \\
        &= E(\mathbf{w}^2) - 0 \\
        &= E(\mathbf{w}\mathbf{w}^T)\\
\end{align*} \\

$$

举例：
$$
\begin{align*}
    \mathbf{w} &= \begin{bmatrix} w_1 \\ w_2 \end{bmatrix} \\
    \\
    \text{Var}(\mathbf{w})
        &= E(\mathbf{w}\mathbf{w}^T) \\
        &= E(\begin{bmatrix} w_1 \\ w_2 \end{bmatrix}\begin{bmatrix} w_1 & w_2 \end{bmatrix}) \\
        &= E(\begin{bmatrix} w_1w_1 & w_1w_2 \\ w_2w_1 & w_2w_2\end{bmatrix}) \\
        &= \begin{bmatrix} E(w_1w_1) & E(w_1w_2) \\ E(w_2w_1) & E(w_2w_2)\end{bmatrix} \\
        &= \begin{bmatrix} E(w^2_1) & E(w_1w_2) \\ E(w_2w_1) & E(w^2_2)\end{bmatrix} \\
        &= \begin{bmatrix} \text{Var}(w_1)+E^2(w_1) &\text{Cov}(w_1,w_2)+E(w_1)E(w_2) \\ \text{Cov}(w_2,w_1)+E(w_2)E(w_1) & \text{Var}(w_2)+E^2(w_2)\end{bmatrix} \\
        &= \begin{bmatrix} \text{Var}(w_1)+0 & \text{Cov}(w_1,w_2)+0  \\ \text{Cov}(w_2,w_1)+0 & \text{Var}(w_2)+0 \end{bmatrix} \\
        &= \begin{bmatrix} \text{Var}(w_1) & \text{Cov}(w_1,w_2)  \\ \text{Cov}(w_2,w_1) & \text{Var}(w_2) \end{bmatrix} &\text{(协方差矩阵)}\\
        &= \begin{bmatrix} \sigma_{w_1}^2 & \sigma_{w_1}\sigma_{w_2} \\ \sigma_{w_2}\sigma_{w_1} & \sigma_{w_2}^2 \end{bmatrix}
\end{align*}
$$

### 先验估计和测量估计

忽略模型的过程噪声，根据上一时刻状态(后验估计)，计算下一时刻状态，称为先验估计：

$$
\hat{\mathbf{x}}^-_k = A\hat{\mathbf{x}}_{k-1} + B\mathbf{u}_{k-1}
$$


忽略传感器的测量噪声，根据传感器测量得到的状态Z,反推状态X,称测量估计：

$$
{\hat{\mathbf{x}}_k}_{MES} = H^{-}\mathbf{z}_k
$$

### 数据融合

上述两个状态，

- 前者为忽略**过程噪声**利用**模型**对X的`预测`，
- 后者为忽略**测量噪声**利用**传感器**对X的`测量`，

利用卡尔曼滤波器对两者进行数据融合（Data Fusion）,得到后验估计：

$$
\hat{\mathbf{x}}_k = \hat{\mathbf{x}}^-_{k} + G(H^{-}\mathbf{z}_k-\hat{\mathbf{x}}^-_k)
$$

> 其中$G \in [0,1]$
> - 当 $G \to 0$ 时，$\hat{\mathbf{x}}_k \to \hat{\mathbf{x}}^-_k$ 即: 估计值 -> 预测值
> - 当 $G \to 1$ 时，$\hat{\mathbf{x}}_k \to {\hat{\mathbf{x}}_k}_{MES}$ 即: 估计值 -> 测量值



如若定义$G=K_kH$，则可消除广义逆矩阵$N^{-}$：

$$
\hat{\mathbf{x}}_k = \hat{\mathbf{x}}^-_{k} + K_k(\mathbf{z}_k-H\hat{\mathbf{x}}^-_k)
$$

> 其中$K_k \in [0,H^{-}]$
> - 当 $K_k \to 0$ 时，$\hat{\mathbf{x}}_k \to \hat{\mathbf{x}}^-_k$ 即: 估计值 -> 预测值
> - 当 $K_k \to H^{-}$ 时，$\hat{\mathbf{x}}_k \to {\hat{\mathbf{x}}_k}_{MES}$ 即: 估计值 -> 测量值

