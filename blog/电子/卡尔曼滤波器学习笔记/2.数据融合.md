---
title: 卡尔曼滤波器:数据融合
article: false 
index: true
---

## 卡尔曼滤波器

## 数据融合（Data Fusion）


假设用两个测量误差不同的秤,测量同一个的物体的质量，两个秤的测量误差都符合正态分布，

**数据融合**就是综合两个秤的测量结果和测量误差，估计物体的真实质量。


|          |     A秤     |     B秤     |      说明      |
| :------: | :---------: | :---------: | :------------: |
| 测量结果 |  $z_1=30g$  |  $z_1=32g$  |
| 测量误差 | $\sigma=2g$ | $\sigma=4g$ | 正态分布标准差 |


**估计真实值**

令：
$$
\begin{align*}
    \hat{Z} &= Z_1 + K(Z_2-Z_1) & K∈[0,1]\\
    \text{估计值} &= \text{测量结果1} + \text{系数K}(\text{测量结果2}-\text{测量结果1})
\end{align*}
$$

**计算K**

要使得估计值的标准差$\sigma(\hat{Z})$最小，即方差$\sigma^2(\hat{Z}) = \text{Var}(\hat{Z})$最小  
> Var(X) 表示随机变量X的方差

$$
\begin{align*}
    \sigma^2(\hat{Z}) &= \text{Var}(\hat{Z}) \\
                      &= \text{Var}(Z_1+K(Z_2-Z_1)) \\
                      &= \text{Var}(Z_1+KZ_2-KZ_1) \\
                      &= \text{Var}((1-K)Z_1+KZ_2) \\
                      &= \text{Var}((1-K)Z_1)+\text{Var}(KZ_2)  & \text{(两个随机变量相互独立)} \\
                      &= (1-K)^2\text{Var}(Z_1)+K^2\text{Var}(Z_2) \\
                      &= (1-K)^2\sigma^2(Z_1)+K^2\sigma^2(Z_2) \\
\end{align*}
$$

要想知道K取何值时方差最小，即求其对k的导数=0


$$
\begin{align*}
    \frac{d(\sigma^2(\hat{Z}))}{dK} &= 0 \\
    \frac{d((1-K)^2\sigma^2(Z_1)+K^2\sigma^2(Z_2))}{dK} = 0 \\
    -2(1-K)\sigma^2(Z_1) + 2K\sigma^2(Z_2) &= 0 \\
    -(1-K)\sigma^2(Z_1) + K\sigma^2(Z_2) &= 0 \\
    K\sigma^2(Z_1) - \sigma^2(Z_1) + K\sigma^2(Z_2) &= 0 \\
    K\sigma^2(Z_1)  + K\sigma^2(Z_2) &= \sigma^2(Z_1) \\
    K(\sigma^2(Z_1)  + \sigma^2(Z_2)) &= \sigma^2(Z_1) \\
    K &= \frac{\sigma^2(Z_1)}{\sigma^2(Z_1)  + \sigma^2(Z_2)} \\
\end{align*}

$$


**所以**
$$
\begin{align*}
    K &= \frac{\sigma^2(Z_1)}{\sigma^2(Z_1)  + \sigma^2(Z_2)} \\
      &= \frac{2^2}{2^2+4^2}\\
      &=\frac{4}{4+16}\\
      &=0.2 \\
    \hat{Z} &= Z_1 + K(Z_2-Z_1) \\
            &= 30 + 0.2(32-30) \\
            &= 30+ 0.4 \\
            &= 30.4 \\
    \sigma^2(\hat{Z}) &= (1-K)^2\sigma^2(Z_1)+K^2\sigma^2(Z_2) \\
                    &= (1-0.2)^22^2+0.2^24^2 \\
                    &= 0.64 \times 4 + 0.04 \times 16 \\
                    &= 2.56 + 0.64 \\
                    &= 3.2 \\
    \sigma(\hat{Z}) &= \sqrt{\sigma^2(\hat{Z})} \\
                    &= \sqrt{3.2} \\
                    &= 1.7888\\
\end{align*}

$$

|       |     A秤     |     B秤     |      估计       |
| :---: | :---------: | :---------: | :-------------: |
| 结果  |  $z_1=30g$  |  $z_1=32g$  | $\hat{Z}=30.4$  |
| 误差  | $\sigma=2g$ | $\sigma=4g$ | $\sigma=1.7888$ |

<Desmos
    :state="{
        version: 11,
        randomSeed: 'e5501e2f4077b24d230223915e32ee43',
        expressions:{
            'list': [
                {
                    'type': 'expression',
                    'id': '1',
                    'color': '#2d70b3',
                    'latex': 'N(x,\\sigma,\\phi)=\\frac{1}{\\sigma\\sqrt{2\\pi}}e^{-\\frac{(x-\\phi)^{2}}{2\\sigma^{2}}}'
                },
                {
                    'type': 'expression',
                    'id': '2',
                    'color': '#388c46',
                    'latex': 'f_{1}(x)=N(x,2,30)'
                },
                {
                    'type': 'expression',
                    'id': '3',
                    'color': '#6042a6',
                    'latex': 'f_{2}(x)=N(x,4,32)'
                },
                {
                    'type': 'expression',
                    'id': '4',
                    'color': '#ff0000',
                    'latex': 'f_{3}(x)=N(x,1.78,30.4)'
                }
            ]
        },
        graph:{
            squareAxes: false,
            viewport: {
                xmax: 40,
                xmin: 20,
                ymax: 0.3,
                ymin: -0.1,
            },
        },
    }"
/>


## 协方差矩阵（Covariance Matrix）

**方差**

方差衡量的是数据相对于均值的离散程度。

$$
\text{Var}(X) = \frac{1}{n} \sum_{i=1}^{n} (x_i - \mu)^2
$$

其中，$X$ 是随机变量，$x_i$ 是数据点，$\mu$ 是均值，$n$ 是数据点的数量。这个公式计算的是所有数据点与均值之差的平方的平均值。

方差是各个数据点与均值之差的平方的平均值。这个值越大，表示数据点越分散；值越小，表示数据点越集中。方差是统计学中用来描述数据波动大小的一个重要指标。

**协方差**

协方差是衡量两个随机变量之间线性相关程度的统计量

$$
\text{Cov}(X, Y) = \frac{1}{n} \sum_{i=1}^{n} (x_i - \mu_X)(y_i - \mu_Y)
$$

其中，$X$ 和 $Y$ 是两个随机变量，$x_i$ 和 $y_i$ 分别是 $X$ 和 $Y$ 的数据点，$\mu_X$ 和 $\mu_Y$ 分别是 $X$ 和 $Y$ 的均值，$n$ 是数据点的数量。这个公式计算的是 $X$ 和 $Y$ 的数据点分别与它们均值之差的乘积的平均值。

协方差的值可以是正的、负的或零。如果协方差为正，表示两个变量正相关；如果协方差为负，表示两个变量负相关；如果协方差为零，表示两个变量不相关。但是，协方差的值受变量单位和量级的影响，因此在实际应用中，通常使用相关系数（协方差除以两个变量的标准差的乘积）来衡量相关程度。



## 状态空间方程

## 观测器