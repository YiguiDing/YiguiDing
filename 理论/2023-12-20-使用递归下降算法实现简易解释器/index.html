<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://dingdingdang.online/%E7%90%86%E8%AE%BA/2023-12-20-%E4%BD%BF%E7%94%A8%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93%E8%A7%A3%E9%87%8A%E5%99%A8/"><meta property="og:site_name" content="YiguiDing的Blog小站"><meta property="og:title" content="使用递归下降算法实现简易解释器"><meta property="og:description" content="尝试使用递归下降算法实现简易词法分析器和文法分析器以及解释器"><meta property="og:type" content="article"><meta property="og:image" content="https://dingdingdang.online/cover/使用递归下降算法实现简易解释器.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-18T09:30:40.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://dingdingdang.online/cover/使用递归下降算法实现简易解释器.png"><meta name="twitter:image:alt" content="使用递归下降算法实现简易解释器"><meta property="article:author" content="丁毅桂"><meta property="article:tag" content="递归下降"><meta property="article:tag" content="解释器"><meta property="article:tag" content="编译原理"><meta property="article:published_time" content="2023-12-20T17:21:35.000Z"><meta property="article:modified_time" content="2024-03-18T09:30:40.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"使用递归下降算法实现简易解释器","image":["https://dingdingdang.online/cover/使用递归下降算法实现简易解释器.png"],"datePublished":"2023-12-20T17:21:35.000Z","dateModified":"2024-03-18T09:30:40.000Z","author":[{"@type":"Person","name":"丁毅桂","email":"2449695354@qq.com"}]}</script><meta name="baidu-site-verification" content="codeva-PwE9Ts6nMl"><link rel="icon" href="/images/favicon_icon.jpg"><link rel="icon" href="/images/favicon_icon.jpg" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/images/favicon_icon.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/images/favicon_icon.jpg"><meta name="msapplication-TileColor" content="#46bd87"><link rel="alternate" type="application/rss+xml" href="https://dingdingdang.online/rss.xml" title="YiguiDing的Blog小站 RSS Feed"><title>使用递归下降算法实现简易解释器 | YiguiDing的Blog小站</title><meta name="description" content="尝试使用递归下降算法实现简易词法分析器和文法分析器以及解释器">
    <link rel="preload" href="/assets/style-1xHYhfFG.css" as="style"><link rel="stylesheet" href="/assets/style-1xHYhfFG.css">
    <link rel="modulepreload" href="/assets/app-B8JFERy0.js"><link rel="modulepreload" href="/assets/index.html-Cm3Jtz9L.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><!----><!----><span class="vp-site-name">YiguiDing的Blog小站</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-house-chimney" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="笔记"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>笔记<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%89%8D%E7%AB%AF/" aria-label="前端"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><!--]-->前端<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%90%8E%E7%AB%AF/" aria-label="后端"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-server" style=""></span><!--]-->后端<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E7%AE%97%E6%B3%95/" aria-label="算法"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-diagram-project" style=""></span><!--]-->算法<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E7%94%B5%E5%AD%90/" aria-label="电子"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-bolt" style=""></span><!--]-->电子<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/%E7%90%86%E8%AE%BA/" aria-label="理论"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book-bookmark" style=""></span><!--]-->理论<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E5%B7%A5%E5%85%B7/" aria-label="工具"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-screwdriver-wrench" style=""></span><!--]-->工具<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E9%9A%8F%E7%AC%94/" aria-label="随笔"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-note-sticky" style=""></span><!--]-->随笔<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E8%AE%A1%E5%88%92/" aria-label="计划"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-list-check" style=""></span><!--]-->计划<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E9%A1%B9%E7%9B%AE/" aria-label="项目"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-box" style=""></span><!--]-->项目<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E7%BD%91%E7%AB%99/%E5%8F%8B%E9%93%BE.html" aria-label="友链"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-group" style=""></span><!--]-->友链<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E7%BD%91%E7%AB%99/%E5%85%B3%E4%BA%8E.html" aria-label="关于"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-address-card" style=""></span><!--]-->关于<!----></a></div></nav><!----><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">23种设计模式学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023 12 13 游戏设计模式学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023 12 15 实现简易编译器和解释器</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">2023 12 20 使用递归下降算法实现简易解释器</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/%E7%90%86%E8%AE%BA/2023-12-20-%E4%BD%BF%E7%94%A8%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93%E8%A7%A3%E9%87%8A%E5%99%A8/" aria-label="使用递归下降算法实现简易解释器"><!---->使用递归下降算法实现简易解释器<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2023 12 23 【编译原理】重学笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Ffmpeg学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">设计模式学习笔记( Java版)</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">设计模式学习笔记( Type Script版)</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="/cover/使用递归下降算法实现简易解释器.png" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->使用递归下降算法实现简易解释器</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">丁毅桂</span></span><span property="author" content="丁毅桂"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-12-20T17:21:35.512Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 5 分钟</span><meta property="timeRequired" content="PT5M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color5 clickable" role="navigation">理论</span><!--]--><meta property="articleSection" content="理论"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color7 clickable" role="navigation">递归下降</span><span class="page-tag-item color4 clickable" role="navigation">解释器</span><span class="page-tag-item color2 clickable" role="navigation">编译原理</span><!--]--><meta property="keywords" content="递归下降,解释器,编译原理"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#目录">目录</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#缘由">缘由</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#目前支持的语法">目前支持的语法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#实现效果">实现效果</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#解释器测试">解释器测试</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#词法分析的实现">词法分析的实现</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#文法定义">文法定义</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#文法分析的实现">文法分析的实现</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#解释器的实现">解释器的实现</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="尝试使用递归下降算法实现简易词法分析器和文法分析器以及解释器" tabindex="-1"><a class="header-anchor" href="#尝试使用递归下降算法实现简易词法分析器和文法分析器以及解释器"><span>尝试使用递归下降算法实现简易词法分析器和文法分析器以及解释器</span></a></h1><p><img src="/assets/%E4%BD%BF%E7%94%A8%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93%E8%A7%A3%E9%87%8A%E5%99%A8-DC6iFKlG.png" alt=""></p><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录"><span>目录</span></a></h2><ul><li><a href="#%E5%B0%9D%E8%AF%95%E4%BD%BF%E7%94%A8%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8%E5%92%8C%E6%96%87%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8%E4%BB%A5%E5%8F%8A%E8%A7%A3%E9%87%8A%E5%99%A8">尝试使用递归下降算法实现简易词法分析器和文法分析器以及解释器</a><ul><li><a href="#%E7%9B%AE%E5%BD%95">目录</a></li><li><a href="#%E7%BC%98%E7%94%B1">缘由</a></li><li><a href="#%E7%9B%AE%E5%89%8D%E6%94%AF%E6%8C%81%E7%9A%84%E8%AF%AD%E6%B3%95">目前支持的语法</a></li><li><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C">实现效果</a><ul><li><a href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%B5%8B%E8%AF%95">解释器测试</a></li></ul></li><li><a href="#%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%9E%E7%8E%B0">词法分析的实现</a></li><li><a href="#%E6%96%87%E6%B3%95%E5%AE%9A%E4%B9%89">文法定义</a></li><li><a href="#%E6%96%87%E6%B3%95%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%9E%E7%8E%B0">文法分析的实现</a></li><li><a href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0">解释器的实现</a></li></ul></li></ul><h2 id="缘由" tabindex="-1"><a class="header-anchor" href="#缘由"><span>缘由</span></a></h2><p>2021年08月的时候，在bilibili上看到过一个讲解如何用700行手写实现一个编译器的<a href="https://www.bilibili.com/video/BV1Kf4y1V783" target="_blank" rel="noopener noreferrer">视频</a>，<br> 源代码在这里，<a href="https://github.com/archeryue/cpc" target="_blank" rel="noopener noreferrer">cpc</a></p><p>当时虽然调侃的评论了一句<code>c--</code>,但其实内心对写出这种东西的人还是感到由衷的钦佩的，</p><p>视频的内容我那时只大概的浏览过一些，当时没有时间仔细去看。</p><p>再那后来不久的时间里，我又看到过另外一个编译器项目，<a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener noreferrer"><code>the-super-tiny-compiler</code></a>,</p><p>这个项目仅用几百行的代码用比较贴近真实编译器的流程实现了将某种作者定义的代码翻译成为类似于c语言的代码，</p><p>这个项目的代码我大概看过，并用ts尝试着将它重新实现了一遍，最近，就是上周的时候，我另外尝试着为其实现了一个解释器，使得可以将其生成的抽象语法树翻译执行。</p><p>还有一个项目，<a href="https://github.com/AttackOnMorty/rdp" target="_blank" rel="noopener noreferrer">Recursive Descent Parser</a> 一个递归下降Parser的实现，用的是js实现的。</p><p>这个项目中的代码提供了一种比较完美编程范式，但是在文法的定义部分有些让人感到难以理解，我那时刚看到这个项目的时候，完全看不懂，过于沮丧，放弃了。</p><p>后来还看到过一个项目，名字忘了，大概就是在前端中实现了一个虚拟机，使得可以加载并执行那种语言编写的游戏，</p><p>还有iPhone上的iSH,也是开源项目,32bit虚拟机，解释执行字节码，可以运行Linux。</p><p>还有就是UTM,一款可以在手机上运行的开源的虚拟机，能在平板电脑上运行win7系统。</p><p>总之，这些都是我之前接触过、看过、用过、让我感到Amazing的项目,这些项目或多或少都影响了我，使我产生了也要写一个类似东西的想法。</p><p>然后，最近在学游戏设计模式，其中作者在讲解行为模式的部分时，提到了解释器模式和如何实现一个虚拟机并执行字节码的内容，用于使得玩家可以用另外一种和游戏本身的编程语言无关的语言来二次开发游戏角色的行为。</p><p>这部分内容中作者虽然讲了很多这种解释器模式的缺点和实现虚拟机执行字节码的优点，但却没有提及如何生成字节码，作者只给了一种通过图形界面拖拽生成指令序列的方式来生成字节码，优点自然是对用户友好，但缺点也是显然的，图形化的界面感觉就不如直接编写程序那样能对游戏做到非常精细化的控制。</p><p>总之，但这让我回想起了这之前看到过的上述几个项目，让我突然也想完整的实现一个编译器，编译出字节码，另外再实现一个虚拟机，用来执行字节码。有这个想法后我便抑制不住内心的想要实现它的冲动。</p><p>这几天我重新阅读了上面几个项目的源代码，甚至去读了js的标准文档，去看了它的文法定义，另外还大概看了另一个项目 <a href="https://github.com/gfwilliams/tiny-js" target="_blank" rel="noopener noreferrer">tiny-js</a>,这个项目用大概2000行的代码实现了一款可嵌入至c++程序的js解释器，虽然没有完全看完，但给我的感觉还是挺震撼的，就是太牛了。</p><p>最近几天，终于尝试着把词法分析和文法分析的内容搞懂了，特别是如何定义文法的那部分。</p><p>昨天下午(2023/12/20)五点的时候，感觉已经差不多完整理解了，然后通宵敲了一晚上的代码，一直到今天早上，完整的从头实现了Tokenizer Parser 以及，解释器，支持的语法包括：变量、函数的定义和调用，循环语句，块作用域变量和全局作用域变量，甚至可以注入预定义函数，某种程度上讲，我认为这已经图灵完备了。感觉就像是玩游戏终于通过了某一关 Exciting!</p><h2 id="目前支持的语法" tabindex="-1"><a class="header-anchor" href="#目前支持的语法"><span>目前支持的语法</span></a></h2><ul><li>语句： <ul><li>空语句 <code>;</code></li><li>块语句 <code>{}</code></li><li>if语句 <code>if(){}else{}</code></li><li>where语句 <code>where(){}</code></li><li>标识符定义语句 <ul><li>变量定义 <code>def a=1,b=2,c;</code></li><li>函数定义 <code>def main(def a){};</code></li></ul></li></ul></li><li>表达式： <ul><li>逗号表达式 <code>,</code></li><li>赋值表达式： <ul><li>基本赋值表达式 <code>=</code></li><li>复合赋值表达式 <code>+= -= *= /=</code></li></ul></li><li>逻辑或表达式 <code>||</code></li><li>逻辑与表达试 <code>&amp;&amp;</code></li><li>等值判断表达式 <code>== !=</code></li><li>条件表达式 <code>&lt; &gt; &lt;= &gt;=</code></li><li>加减运算表达式 <code>+ -</code></li><li>乘除取余运算表达式 <code>* / %</code></li><li>括号表达式: <code>(表达式)</code></li><li>标识符表达式 <code>a</code></li><li>函数调用表达式 <code>main(1,2,3);</code></li></ul></li></ul><h2 id="实现效果" tabindex="-1"><a class="header-anchor" href="#实现效果"><span>实现效果</span></a></h2><h3 id="解释器测试" tabindex="-1"><a class="header-anchor" href="#解释器测试"><span>解释器测试</span></a></h3><div class="vp-code-tabs"><div class="vp-code-tabs-nav" role="tablist"><button type="button" class="vp-code-tab-nav active" role="tab" aria-controls="codetab-251-0" aria-selected="true">解释器代码:<code>test/index.ts</code></button><button type="button" class="vp-code-tab-nav" role="tab" aria-controls="codetab-251-1" aria-selected="false">输出结果:<code>output.txt</code></button></div><!--[--><div class="vp-code-tab active" id="codetab-251-0" role="tabpanel" aria-expanded="true"><div class="vp-code-tab-title">解释器代码:<code>test/index.ts</code></div><!--[--><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span>import { Interpreater } from &#39;../Interpreater&#39;;</span></span>
<span class="line"><span>import { Parser } from &#39;../Parser&#39;;</span></span>
<span class="line"><span>import { Tokenizer } from &#39;../Tokenizer&#39;;</span></span>
<span class="line"><span>import { regFuncs } from &#39;../functions&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>function testForInterpreater(code: string) {</span></span>
<span class="line"><span>  let tokenizer = new Tokenizer();</span></span>
<span class="line"><span>  let parser = new Parser();</span></span>
<span class="line"><span>  let interpreater = new Interpreater();</span></span>
<span class="line"><span>  regFuncs(interpreater);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  let tokens = tokenizer.getTokens(code);</span></span>
<span class="line"><span>  let ast = parser.parse(tokens);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  console.log(&#39;源代码:&#39;);</span></span>
<span class="line"><span>  console.log(code);</span></span>
<span class="line"><span>  console.log(&#39;解释器执行结果:&#39;);</span></span>
<span class="line"><span>  interpreater.exec(ast);</span></span>
<span class="line"><span>  console.log(&#39;源代码词法分析结果:&#39;);</span></span>
<span class="line"><span>  console.log(tokens);</span></span>
<span class="line"><span>  console.log(&#39;源代码文法分析结果:&#39;);</span></span>
<span class="line"><span>  console.dir(ast, { depth: null });</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>function main() {</span></span>
<span class="line"><span>  // 测试解释器</span></span>
<span class="line"><span>  testForInterpreater(</span></span>
<span class="line"><span>    `</span></span>
<span class="line"><span>      def fbnq(def max){</span></span>
<span class="line"><span>        def a=1,b=1,c;</span></span>
<span class="line"><span>        while(a&lt;max){</span></span>
<span class="line"><span>          print(a);</span></span>
<span class="line"><span>          c = b;</span></span>
<span class="line"><span>          b = a + b;</span></span>
<span class="line"><span>          a = c;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      def main(){</span></span>
<span class="line"><span>        fbnq(200); // 输出200以内斐波那契数列</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span>      main();</span></span>
<span class="line"><span>    `</span></span>
<span class="line"><span>  );</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>main();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="vp-code-tab" id="codetab-251-1" role="tabpanel" aria-expanded="false"><div class="vp-code-tab-title">输出结果:<code>output.txt</code></div><!--[--><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span>源代码:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      def fbnq(def max){</span></span>
<span class="line"><span>        def a=1,b=1,c;</span></span>
<span class="line"><span>        while(a&lt;max){</span></span>
<span class="line"><span>          print(a);</span></span>
<span class="line"><span>          c = b;</span></span>
<span class="line"><span>          b = a + b;</span></span>
<span class="line"><span>          a = c;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      def main(){</span></span>
<span class="line"><span>        fbnq(200); // 输出200以内斐波那契数列</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span>      main();</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>解释器执行结果:</span></span>
<span class="line"><span>1</span></span>
<span class="line"><span>1</span></span>
<span class="line"><span>2</span></span>
<span class="line"><span>3</span></span>
<span class="line"><span>5</span></span>
<span class="line"><span>8</span></span>
<span class="line"><span>13</span></span>
<span class="line"><span>21</span></span>
<span class="line"><span>34</span></span>
<span class="line"><span>55</span></span>
<span class="line"><span>89</span></span>
<span class="line"><span>144</span></span>
<span class="line"><span>源代码词法分析结果:</span></span>
<span class="line"><span>[</span></span>
<span class="line"><span>  { type: &#39;def&#39;, value: &#39;def&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;fbnq&#39; },</span></span>
<span class="line"><span>  { type: &#39;(&#39;, value: &#39;(&#39; },</span></span>
<span class="line"><span>  { type: &#39;def&#39;, value: &#39;def&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;max&#39; },</span></span>
<span class="line"><span>  { type: &#39;)&#39;, value: &#39;)&#39; },</span></span>
<span class="line"><span>  { type: &#39;{&#39;, value: &#39;{&#39; },</span></span>
<span class="line"><span>  { type: &#39;def&#39;, value: &#39;def&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;a&#39; },</span></span>
<span class="line"><span>  { type: &#39;AssignOpSimple&#39;, value: &#39;=&#39; },</span></span>
<span class="line"><span>  { type: &#39;Number&#39;, value: &#39;1&#39; },</span></span>
<span class="line"><span>  { type: &#39;,&#39;, value: &#39;,&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;b&#39; },</span></span>
<span class="line"><span>  { type: &#39;AssignOpSimple&#39;, value: &#39;=&#39; },</span></span>
<span class="line"><span>  { type: &#39;Number&#39;, value: &#39;1&#39; },</span></span>
<span class="line"><span>  { type: &#39;,&#39;, value: &#39;,&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;c&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; },</span></span>
<span class="line"><span>  { type: &#39;while&#39;, value: &#39;while&#39; },</span></span>
<span class="line"><span>  { type: &#39;(&#39;, value: &#39;(&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;a&#39; },</span></span>
<span class="line"><span>  { type: &#39;EqualityOp&#39;, value: &#39;&lt;&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;max&#39; },</span></span>
<span class="line"><span>  { type: &#39;)&#39;, value: &#39;)&#39; },</span></span>
<span class="line"><span>  { type: &#39;{&#39;, value: &#39;{&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;print&#39; },</span></span>
<span class="line"><span>  { type: &#39;(&#39;, value: &#39;(&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;a&#39; },</span></span>
<span class="line"><span>  { type: &#39;)&#39;, value: &#39;)&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;c&#39; },</span></span>
<span class="line"><span>  { type: &#39;AssignOpSimple&#39;, value: &#39;=&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;b&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;b&#39; },</span></span>
<span class="line"><span>  { type: &#39;AssignOpSimple&#39;, value: &#39;=&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;a&#39; },</span></span>
<span class="line"><span>  { type: &#39;AddOp&#39;, value: &#39;+&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;b&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;a&#39; },</span></span>
<span class="line"><span>  { type: &#39;AssignOpSimple&#39;, value: &#39;=&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;c&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; },</span></span>
<span class="line"><span>  { type: &#39;}&#39;, value: &#39;}&#39; },</span></span>
<span class="line"><span>  { type: &#39;}&#39;, value: &#39;}&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; },</span></span>
<span class="line"><span>  { type: &#39;def&#39;, value: &#39;def&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;main&#39; },</span></span>
<span class="line"><span>  { type: &#39;(&#39;, value: &#39;(&#39; },</span></span>
<span class="line"><span>  { type: &#39;)&#39;, value: &#39;)&#39; },</span></span>
<span class="line"><span>  { type: &#39;{&#39;, value: &#39;{&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;fbnq&#39; },</span></span>
<span class="line"><span>  { type: &#39;(&#39;, value: &#39;(&#39; },</span></span>
<span class="line"><span>  { type: &#39;Number&#39;, value: &#39;200&#39; },</span></span>
<span class="line"><span>  { type: &#39;)&#39;, value: &#39;)&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; },</span></span>
<span class="line"><span>  { type: &#39;}&#39;, value: &#39;}&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; },</span></span>
<span class="line"><span>  { type: &#39;Identifier&#39;, value: &#39;main&#39; },</span></span>
<span class="line"><span>  { type: &#39;(&#39;, value: &#39;(&#39; },</span></span>
<span class="line"><span>  { type: &#39;)&#39;, value: &#39;)&#39; },</span></span>
<span class="line"><span>  { type: &#39;;&#39;, value: &#39;;&#39; }</span></span>
<span class="line"><span>]</span></span>
<span class="line"><span>源代码文法分析结果:</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  type: &#39;Program&#39;,</span></span>
<span class="line"><span>  statements: [</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>      type: &#39;IdentifierDeclarationsStatement&#39;,</span></span>
<span class="line"><span>      declarations: [</span></span>
<span class="line"><span>        {</span></span>
<span class="line"><span>          type: &#39;FunctionDeclaration&#39;,</span></span>
<span class="line"><span>          name: &#39;fbnq&#39;,</span></span>
<span class="line"><span>          FormedArguments: [</span></span>
<span class="line"><span>            {</span></span>
<span class="line"><span>              type: &#39;VariableDeclaration&#39;,</span></span>
<span class="line"><span>              name: &#39;max&#39;,</span></span>
<span class="line"><span>              value: undefined</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>          ],</span></span>
<span class="line"><span>          statements: {</span></span>
<span class="line"><span>            type: &#39;BlockStatement&#39;,</span></span>
<span class="line"><span>            statements: [</span></span>
<span class="line"><span>              {</span></span>
<span class="line"><span>                type: &#39;IdentifierDeclarationsStatement&#39;,</span></span>
<span class="line"><span>                declarations: [</span></span>
<span class="line"><span>                  {</span></span>
<span class="line"><span>                    type: &#39;VariableDeclaration&#39;,</span></span>
<span class="line"><span>                    name: &#39;a&#39;,</span></span>
<span class="line"><span>                    value: { type: &#39;NumberLiteral&#39;, value: &#39;1&#39; }</span></span>
<span class="line"><span>                  },</span></span>
<span class="line"><span>                  {</span></span>
<span class="line"><span>                    type: &#39;VariableDeclaration&#39;,</span></span>
<span class="line"><span>                    name: &#39;b&#39;,</span></span>
<span class="line"><span>                    value: { type: &#39;NumberLiteral&#39;, value: &#39;1&#39; }</span></span>
<span class="line"><span>                  },</span></span>
<span class="line"><span>                  {</span></span>
<span class="line"><span>                    type: &#39;VariableDeclaration&#39;,</span></span>
<span class="line"><span>                    name: &#39;c&#39;,</span></span>
<span class="line"><span>                    value: undefined</span></span>
<span class="line"><span>                  }</span></span>
<span class="line"><span>                ]</span></span>
<span class="line"><span>              },</span></span>
<span class="line"><span>              {</span></span>
<span class="line"><span>                type: &#39;WhileStatement&#39;,</span></span>
<span class="line"><span>                condition: {</span></span>
<span class="line"><span>                  type: &#39;BineryExpression&#39;,</span></span>
<span class="line"><span>                  operator: &#39;&lt;&#39;,</span></span>
<span class="line"><span>                  left: { type: &#39;Identifier&#39;, name: &#39;a&#39; },</span></span>
<span class="line"><span>                  right: { type: &#39;Identifier&#39;, name: &#39;max&#39; }</span></span>
<span class="line"><span>                },</span></span>
<span class="line"><span>                statement: {</span></span>
<span class="line"><span>                  type: &#39;BlockStatement&#39;,</span></span>
<span class="line"><span>                  statements: [</span></span>
<span class="line"><span>                    {</span></span>
<span class="line"><span>                      type: &#39;ExpressionStatement&#39;,</span></span>
<span class="line"><span>                      expression: {</span></span>
<span class="line"><span>                        type: &#39;FunctionCall&#39;,</span></span>
<span class="line"><span>                        calee: { type: &#39;Identifier&#39;, name: &#39;print&#39; },</span></span>
<span class="line"><span>                        args: [ { type: &#39;Identifier&#39;, name: &#39;a&#39; } ]</span></span>
<span class="line"><span>                      }</span></span>
<span class="line"><span>                    },</span></span>
<span class="line"><span>                    {</span></span>
<span class="line"><span>                      type: &#39;ExpressionStatement&#39;,</span></span>
<span class="line"><span>                      expression: {</span></span>
<span class="line"><span>                        type: &#39;AssignExpression&#39;,</span></span>
<span class="line"><span>                        operator: &#39;=&#39;,</span></span>
<span class="line"><span>                        left: { type: &#39;Identifier&#39;, name: &#39;c&#39; },</span></span>
<span class="line"><span>                        right: { type: &#39;Identifier&#39;, name: &#39;b&#39; }</span></span>
<span class="line"><span>                      }</span></span>
<span class="line"><span>                    },</span></span>
<span class="line"><span>                    {</span></span>
<span class="line"><span>                      type: &#39;ExpressionStatement&#39;,</span></span>
<span class="line"><span>                      expression: {</span></span>
<span class="line"><span>                        type: &#39;AssignExpression&#39;,</span></span>
<span class="line"><span>                        operator: &#39;=&#39;,</span></span>
<span class="line"><span>                        left: { type: &#39;Identifier&#39;, name: &#39;b&#39; },</span></span>
<span class="line"><span>                        right: {</span></span>
<span class="line"><span>                          type: &#39;BineryExpression&#39;,</span></span>
<span class="line"><span>                          operator: &#39;+&#39;,</span></span>
<span class="line"><span>                          left: { type: &#39;Identifier&#39;, name: &#39;a&#39; },</span></span>
<span class="line"><span>                          right: { type: &#39;Identifier&#39;, name: &#39;b&#39; }</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                      }</span></span>
<span class="line"><span>                    },</span></span>
<span class="line"><span>                    {</span></span>
<span class="line"><span>                      type: &#39;ExpressionStatement&#39;,</span></span>
<span class="line"><span>                      expression: {</span></span>
<span class="line"><span>                        type: &#39;AssignExpression&#39;,</span></span>
<span class="line"><span>                        operator: &#39;=&#39;,</span></span>
<span class="line"><span>                        left: { type: &#39;Identifier&#39;, name: &#39;a&#39; },</span></span>
<span class="line"><span>                        right: { type: &#39;Identifier&#39;, name: &#39;c&#39; }</span></span>
<span class="line"><span>                      }</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                  ]</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>              }</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      ]</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>      type: &#39;IdentifierDeclarationsStatement&#39;,</span></span>
<span class="line"><span>      declarations: [</span></span>
<span class="line"><span>        {</span></span>
<span class="line"><span>          type: &#39;FunctionDeclaration&#39;,</span></span>
<span class="line"><span>          name: &#39;main&#39;,</span></span>
<span class="line"><span>          FormedArguments: [],</span></span>
<span class="line"><span>          statements: {</span></span>
<span class="line"><span>            type: &#39;BlockStatement&#39;,</span></span>
<span class="line"><span>            statements: [</span></span>
<span class="line"><span>              {</span></span>
<span class="line"><span>                type: &#39;ExpressionStatement&#39;,</span></span>
<span class="line"><span>                expression: {</span></span>
<span class="line"><span>                  type: &#39;FunctionCall&#39;,</span></span>
<span class="line"><span>                  calee: { type: &#39;Identifier&#39;, name: &#39;fbnq&#39; },</span></span>
<span class="line"><span>                  args: [ { type: &#39;NumberLiteral&#39;, value: &#39;200&#39; } ]</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>              }</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      ]</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>      type: &#39;ExpressionStatement&#39;,</span></span>
<span class="line"><span>      expression: {</span></span>
<span class="line"><span>        type: &#39;FunctionCall&#39;,</span></span>
<span class="line"><span>        calee: { type: &#39;Identifier&#39;, name: &#39;main&#39; },</span></span>
<span class="line"><span>        args: []</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  ]</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h2 id="词法分析的实现" tabindex="-1"><a class="header-anchor" href="#词法分析的实现"><span>词法分析的实现</span></a></h2><p><code>Tokenizer.ts</code></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span>export type TokenType =</span></span>
<span class="line"><span>  | &#39;Space&#39; //空白符</span></span>
<span class="line"><span>  | &#39;Comment&#39; // 注释</span></span>
<span class="line"><span>  | &#39;;&#39; // 分号</span></span>
<span class="line"><span>  | &#39;if&#39; // if语句</span></span>
<span class="line"><span>  | &#39;else&#39; // else语句</span></span>
<span class="line"><span>  | &#39;while&#39;</span></span>
<span class="line"><span>  | &#39;do&#39;</span></span>
<span class="line"><span>  | &#39;def&#39; // 声明</span></span>
<span class="line"><span>  | &#39;AssignOpSimple&#39; // 简单赋值操作符</span></span>
<span class="line"><span>  | &#39;AssignOpComplex&#39; // 复杂赋值操作符</span></span>
<span class="line"><span>  | &#39;TernaryOp?&#39; // 三目运算符</span></span>
<span class="line"><span>  | &#39;TernaryOp:&#39; // 三目运算符</span></span>
<span class="line"><span>  | &#39;LogicalOr&#39; // 逻辑或运算符</span></span>
<span class="line"><span>  | &#39;LogicalAnd&#39; // 逻辑与运算符</span></span>
<span class="line"><span>  | &#39;EqualityOp&#39; // 等值运算符</span></span>
<span class="line"><span>  | &#39;RelationalOp&#39; // 关系运算符</span></span>
<span class="line"><span>  | &#39;AddOp&#39; // 算数加减运算符</span></span>
<span class="line"><span>  | &#39;MutOp&#39; // 算数乘除取余运算符</span></span>
<span class="line"><span>  | &#39;Number&#39; // 字面量</span></span>
<span class="line"><span>  | &#39;Boolean&#39; // 字面量</span></span>
<span class="line"><span>  | &#39;String&#39; // 字面量</span></span>
<span class="line"><span>  | &#39;null&#39; // 字面量</span></span>
<span class="line"><span>  | &#39;(&#39;</span></span>
<span class="line"><span>  | &#39;)&#39;</span></span>
<span class="line"><span>  | &#39;[&#39;</span></span>
<span class="line"><span>  | &#39;]&#39;</span></span>
<span class="line"><span>  | &#39;{&#39;</span></span>
<span class="line"><span>  | &#39;}&#39;</span></span>
<span class="line"><span>  | &#39;.&#39;</span></span>
<span class="line"><span>  | &#39;,&#39;</span></span>
<span class="line"><span>  | &#39;this&#39;</span></span>
<span class="line"><span>  | &#39;super&#39;</span></span>
<span class="line"><span>  | &#39;Identifier&#39;;</span></span>
<span class="line"><span>export type TokenDef = [TokenType, RegExp];</span></span>
<span class="line"><span>export type Token = { type: TokenType; value: string };</span></span>
<span class="line"><span>export const TokenDefs: Array&lt;TokenDef&gt; = [</span></span>
<span class="line"><span>  [&#39;Space&#39;, /^\s+/],</span></span>
<span class="line"><span>  [&#39;Comment&#39;, /^\/\/[^\n]*/],</span></span>
<span class="line"><span>  [&#39;Comment&#39;, /^\/\*(\s|.)*?\*\//],</span></span>
<span class="line"><span>  [&#39;;&#39;, /^;/],</span></span>
<span class="line"><span>  [&#39;if&#39;, /^\bif\b/],</span></span>
<span class="line"><span>  [&#39;else&#39;, /^\belse\b/],</span></span>
<span class="line"><span>  [&#39;while&#39;, /^\bwhile\b/],</span></span>
<span class="line"><span>  [&#39;do&#39;, /^\bdo\b/],</span></span>
<span class="line"><span>  [&#39;def&#39;, /^\bdef\b/],</span></span>
<span class="line"><span>  [&#39;EqualityOp&#39;, /^[&gt;&lt;][=]?/],</span></span>
<span class="line"><span>  [&#39;RelationalOp&#39;, /^[=!]=/],</span></span>
<span class="line"><span>  [&#39;AssignOpSimple&#39;, /^=/],</span></span>
<span class="line"><span>  [&#39;AssignOpComplex&#39;, /^[\+\-\*\/\%]=/],</span></span>
<span class="line"><span>  [&#39;TernaryOp?&#39;, /^\?/],</span></span>
<span class="line"><span>  [&#39;TernaryOp:&#39;, /^[:]/],</span></span>
<span class="line"><span>  [&#39;LogicalOr&#39;, /^\|\|/],</span></span>
<span class="line"><span>  [&#39;LogicalAnd&#39;, /^&amp;&amp;/],</span></span>
<span class="line"><span>  [&#39;AddOp&#39;, /^[+-]/],</span></span>
<span class="line"><span>  [&#39;MutOp&#39;, /^[\*\/\%]/],</span></span>
<span class="line"><span>  [&#39;Number&#39;, /^\d+\.\d+/], // 0.123</span></span>
<span class="line"><span>  [&#39;Number&#39;, /^\d+/], // 123</span></span>
<span class="line"><span>  [&#39;Boolean&#39;, /^\btrue\b/],</span></span>
<span class="line"><span>  [&#39;Boolean&#39;, /^\bfalse\b/],</span></span>
<span class="line"><span>  [&#39;null&#39;, /^\bnull\b/],</span></span>
<span class="line"><span>  [&#39;String&#39;, /^\&#39;[^\&#39;]*\&#39;/],</span></span>
<span class="line"><span>  [&#39;String&#39;, /^\&quot;[^\&quot;]*\&quot;/],</span></span>
<span class="line"><span>  [&#39;(&#39;, /^\(/],</span></span>
<span class="line"><span>  [&#39;)&#39;, /^\)/],</span></span>
<span class="line"><span>  [&#39;[&#39;, /^\[/],</span></span>
<span class="line"><span>  [&#39;]&#39;, /^\]/],</span></span>
<span class="line"><span>  [&#39;{&#39;, /^\{/],</span></span>
<span class="line"><span>  [&#39;}&#39;, /^\}/],</span></span>
<span class="line"><span>  [&#39;.&#39;, /^\./],</span></span>
<span class="line"><span>  [&#39;,&#39;, /^\,/],</span></span>
<span class="line"><span>  [&#39;this&#39;, /^\bthis\b/],</span></span>
<span class="line"><span>  [&#39;super&#39;, /^\bsuper\b/],</span></span>
<span class="line"><span>  [&#39;Identifier&#39;, /^\w+/],</span></span>
<span class="line"><span>];</span></span>
<span class="line"><span>export class Tokenizer {</span></span>
<span class="line"><span>  idx!: number;</span></span>
<span class="line"><span>  code!: string;</span></span>
<span class="line"><span>  tokens!: Array&lt;Token&gt;;</span></span>
<span class="line"><span>  init(code: string) {</span></span>
<span class="line"><span>    this.idx = 0;</span></span>
<span class="line"><span>    this.code = code;</span></span>
<span class="line"><span>    this.tokens = [];</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  getTokens(code: string) {</span></span>
<span class="line"><span>    this.init(code);</span></span>
<span class="line"><span>    while (this.hasMore()) {</span></span>
<span class="line"><span>      let token = this.getNextToken();</span></span>
<span class="line"><span>      if (token.type == &#39;Space&#39;) continue;</span></span>
<span class="line"><span>      if (token.type == &#39;Comment&#39;) continue;</span></span>
<span class="line"><span>      this.tokens.push(token);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return this.tokens;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  private hasMore() {</span></span>
<span class="line"><span>    return this.idx &lt; this.code.length;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  private getNextToken(): Token {</span></span>
<span class="line"><span>    if (!this.hasMore()) throw new SyntaxError(&#39;no more token.&#39;);</span></span>
<span class="line"><span>    const rest = this.code.slice(this.idx);</span></span>
<span class="line"><span>    for (const [tokenType, reg] of TokenDefs) {</span></span>
<span class="line"><span>      let tokenValue = this.match(reg, rest);</span></span>
<span class="line"><span>      if (tokenValue == null) continue;</span></span>
<span class="line"><span>      else return { type: tokenType, value: tokenValue };</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    throw new SyntaxError(`unknow token: ${rest[0]}`);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  private match(reg: RegExp, str: string) {</span></span>
<span class="line"><span>    let matchs = reg.exec(str);</span></span>
<span class="line"><span>    if (matchs == null) return null; // 没有匹配到</span></span>
<span class="line"><span>    let matched = matchs[0]; // 匹配到了</span></span>
<span class="line"><span>    this.idx += matched.length; // 移动指针</span></span>
<span class="line"><span>    return matched;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="文法定义" tabindex="-1"><a class="header-anchor" href="#文法定义"><span>文法定义</span></a></h2><p><code>ast.ts</code></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span>import { TokenType } from &#39;./Tokenizer&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Program</span></span>
<span class="line"><span> * : Statements</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface Program extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;Program&#39;;</span></span>
<span class="line"><span>  statements: Statements;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Statements</span></span>
<span class="line"><span> * : Statement</span></span>
<span class="line"><span> * | Statements Statement</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type Statements = Array&lt;Statement&gt;;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 语句</span></span>
<span class="line"><span> * Statement</span></span>
<span class="line"><span> * : EmptyStatement</span></span>
<span class="line"><span> * | IdentifierDeclarationsStatement</span></span>
<span class="line"><span> * | ExpressionStatement</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type Statement =</span></span>
<span class="line"><span>  | EmptyStatement</span></span>
<span class="line"><span>  | BlockStatement</span></span>
<span class="line"><span>  | IfStatement</span></span>
<span class="line"><span>  | WhileStatement</span></span>
<span class="line"><span>  | IdentifierDeclarationsStatement</span></span>
<span class="line"><span>  | ExpressionStatement;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 空语句</span></span>
<span class="line"><span> * EmptyStatement</span></span>
<span class="line"><span> * : &#39;;&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface EmptyStatement extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;EmptyStatement&#39;;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 代码块</span></span>
<span class="line"><span> * BlockStatement</span></span>
<span class="line"><span> * | &#39;{&#39; Statements &#39;}&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface BlockStatement extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;BlockStatement&#39;;</span></span>
<span class="line"><span>  statements: Statements;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * if语句：</span></span>
<span class="line"><span> * IfStatement</span></span>
<span class="line"><span> * : if(Expression) [空语句,块语句]</span></span>
<span class="line"><span> * | IfStatement [&#39;else&#39; [空语句,块语句,if语句]]*</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * 简化</span></span>
<span class="line"><span> * 由于 `Statement:=空语句|块语句|if语句|...;` 所以可以直接简化：</span></span>
<span class="line"><span> * IfStatement</span></span>
<span class="line"><span> * : if(Expression) Statement</span></span>
<span class="line"><span> * | IfStatement [else Statement]?</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface IfStatement extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;IfStatement&#39;;</span></span>
<span class="line"><span>  condition: Expression;</span></span>
<span class="line"><span>  case1: Statement;</span></span>
<span class="line"><span>  case2?: Statement;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * WhileStatement</span></span>
<span class="line"><span> * : while(表达式) 空语句|单语句|块语句|....</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * 简化</span></span>
<span class="line"><span> * WhileStatement</span></span>
<span class="line"><span> * : while(表达式) 语句</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface WhileStatement extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;WhileStatement&#39;;</span></span>
<span class="line"><span>  condition: Expression;</span></span>
<span class="line"><span>  statement: Statement;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 标识符声明语句可以用来声明多个变量或函数</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * 标识符声明语句</span></span>
<span class="line"><span> * | &#39;def&#39; [变量或函数声明]+ &#39;;&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface IdentifierDeclarationsStatement extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;IdentifierDeclarationsStatement&#39;;</span></span>
<span class="line"><span>  declarations: Array&lt;VariableOrFunctionDeclaration&gt;;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 变量或函数声明，</span></span>
<span class="line"><span> * 函数声明的写法是 ：标识符 + [(]</span></span>
<span class="line"><span> * 变量声明的写法是 ：标识符 + [= 表达式]?</span></span>
<span class="line"><span> * 区别就在于有没有括号</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * 变量或函数声明:</span></span>
<span class="line"><span> * | 函数声明</span></span>
<span class="line"><span> * : 变量声明</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type VariableOrFunctionDeclaration =</span></span>
<span class="line"><span>  | VariableDeclaration</span></span>
<span class="line"><span>  | FunctionDeclaration;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 变量声明由一个标识符和一个可选的初始化语句组成，初始化语句由&#39;=&#39;符号开头。</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * 变量声明</span></span>
<span class="line"><span> * : 标识符 [&#39;=&#39; 逻辑或表达式]?</span></span>
<span class="line"><span> * : 标识符 变量声明初始化?</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface VariableDeclaration extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;VariableDeclaration&#39;;</span></span>
<span class="line"><span>  name: string;</span></span>
<span class="line"><span>  value?: VariableDeclarationInit;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 变量声明初始化</span></span>
<span class="line"><span> * : [&#39;=&#39; 逻辑或表达式]?</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type VariableDeclarationInit = LogicalOrExpression | undefined;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 函数声明</span></span>
<span class="line"><span> * : 标识符 函数形式参数列表 块语句组成</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * FunctionDeclaration</span></span>
<span class="line"><span> * | Identifier FormedArguments  BlockStatement</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface FunctionDeclaration extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;FunctionDeclaration&#39;;</span></span>
<span class="line"><span>  name: string;</span></span>
<span class="line"><span>  FormedArguments: FormedArguments;</span></span>
<span class="line"><span>  statements: BlockStatement;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 函数形式参数列表</span></span>
<span class="line"><span> * : (   [    [def 变量或函数声明]    [,def 变量或函数声明]*    ]*    )</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * FormedArguments</span></span>
<span class="line"><span> * : (   [    [def VariableOrFunctionDeclaration]    [,def VariableOrFunctionDeclaration]*    ]*    )</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type FormedArguments = Array&lt;VariableOrFunctionDeclaration&gt;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 表达式语句</span></span>
<span class="line"><span> * ExpressionStatement</span></span>
<span class="line"><span> * : Expression &#39;;&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface ExpressionStatement extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;ExpressionStatement&#39;;</span></span>
<span class="line"><span>  expression: Expression;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 表达式</span></span>
<span class="line"><span> * Expression</span></span>
<span class="line"><span> * : CommaExpression</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type Expression = CommaExpression;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 逗号表达式</span></span>
<span class="line"><span> * CommaExpression</span></span>
<span class="line"><span> * | AssignExpression [CommaOp AssignExpression]*</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type CommaExpression = AssignExpression | _CommaExpression;</span></span>
<span class="line"><span>export interface _CommaExpression extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;CommaExpression&#39;;</span></span>
<span class="line"><span>  expressions: Array&lt;AssignExpression&gt;;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 赋值表达式</span></span>
<span class="line"><span> * AssignExpression</span></span>
<span class="line"><span> * : TernaryExpression</span></span>
<span class="line"><span> * | MumberAccessExpression [AssignOp AssignExpression]*</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type AssignExpression = TernaryExpression | _AssignExpression;</span></span>
<span class="line"><span>export interface _AssignExpression extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;AssignExpression&#39;;</span></span>
<span class="line"><span>  operator: string;</span></span>
<span class="line"><span>  left: MumberAccessExpression | Identifier;</span></span>
<span class="line"><span>  right: AssignExpression;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 三目表达式</span></span>
<span class="line"><span> * TernaryExpression</span></span>
<span class="line"><span> * : LogicalOrExpression [? TernaryExpression : TernaryExpression]</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type TernaryExpression = LogicalOrExpression | _TernaryExpression;</span></span>
<span class="line"><span>export interface _TernaryExpression extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;TernaryExpression&#39;;</span></span>
<span class="line"><span>  condition: LogicalOrExpression;</span></span>
<span class="line"><span>  case1: TernaryExpression;</span></span>
<span class="line"><span>  case2: TernaryExpression;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 双目运算表达式</span></span>
<span class="line"><span> * BineryExpression&lt;Child,OpType&gt;</span></span>
<span class="line"><span> * | Child OpType Child</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface BineryExpression&lt;Child, OpType extends TokenType&gt;</span></span>
<span class="line"><span>  extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;BineryExpression&#39;;</span></span>
<span class="line"><span>  operatorType: Extract&lt;TokenType, OpType&gt;;</span></span>
<span class="line"><span>  operator: string;</span></span>
<span class="line"><span>  left: Child;</span></span>
<span class="line"><span>  right: Child;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 逻辑或表达式</span></span>
<span class="line"><span> * LogicalOrExpression</span></span>
<span class="line"><span> * : LogicalAndExpression [LogicalOr LogicalAndExpression]*</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type LogicalOrExpression =</span></span>
<span class="line"><span>  | LogicalAndExpression</span></span>
<span class="line"><span>  | BineryExpression&lt;LogicalAndExpression, &#39;LogicalOr&#39;&gt;;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 逻辑或表达式</span></span>
<span class="line"><span> * LogicalAndExpression</span></span>
<span class="line"><span> * : EqualityExpression [LogicalAnd EqualityExpression]*</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type LogicalAndExpression =</span></span>
<span class="line"><span>  | EqualityExpression</span></span>
<span class="line"><span>  | BineryExpression&lt;EqualityExpression, &#39;LogicalAnd&#39;&gt;;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 等值表达式</span></span>
<span class="line"><span> * EqualityExpression</span></span>
<span class="line"><span> * : RelationalExpression [EqualityOp RelationalExpression]*</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type EqualityExpression =</span></span>
<span class="line"><span>  | RelationalExpression</span></span>
<span class="line"><span>  | BineryExpression&lt;RelationalExpression, &#39;EqualityOp&#39;&gt;;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 关系表达式</span></span>
<span class="line"><span> * EqualityExpression</span></span>
<span class="line"><span> * : AdditiveExpression [RelationalOp AdditiveExpression]*</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type RelationalExpression =</span></span>
<span class="line"><span>  | AdditiveExpression</span></span>
<span class="line"><span>  | BineryExpression&lt;AdditiveExpression, &#39;RelationalOp&#39;&gt;;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 加减表达式</span></span>
<span class="line"><span> * AdditiveExpression</span></span>
<span class="line"><span> * : MultiplicativeExpression</span></span>
<span class="line"><span> * | AdditiveExpression AddOp MultiplicativeExpression</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type AdditiveExpression =</span></span>
<span class="line"><span>  | MultiplicativeExpression</span></span>
<span class="line"><span>  | BineryExpression&lt;MultiplicativeExpression, &#39;AddOp&#39;&gt;;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 乘除取余表达式</span></span>
<span class="line"><span> * MultiplicativeExpression</span></span>
<span class="line"><span> * : PrimaryExpression</span></span>
<span class="line"><span> * | PrimaryExpression MutOp PrimaryExpression</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type MultiplicativeExpression =</span></span>
<span class="line"><span>  | PrimaryExpression</span></span>
<span class="line"><span>  | BineryExpression&lt;PrimaryExpression, &#39;MutOp&#39;&gt;;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 成员属性访问表达式和函数调用都以标识符开头，这是字面量所没有的特征</span></span>
<span class="line"><span> * 所以在主表达式中可以根据该特征来做区分</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * PrimaryExpression</span></span>
<span class="line"><span> * : MumberAccessExpressionOrFunctionCallExpression</span></span>
<span class="line"><span> * | BracketedExpression</span></span>
<span class="line"><span> * | Literal</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type PrimaryExpression =</span></span>
<span class="line"><span>  | MumberAccessExpressionOrFunctionCallExpression</span></span>
<span class="line"><span>  | BracketedExpression</span></span>
<span class="line"><span>  | Literal;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 成员属性访问表达式和函数调用的区分就在于后续有没有括号</span></span>
<span class="line"><span> * 所以可以先假设这里是一个成员属性访问表达式，如果后面接着一个括号，则假设错误，说明这里是一个函数调用</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * MumberAccessExpressionOrFunctionCallExpression</span></span>
<span class="line"><span> * : MumberAccessExpression</span></span>
<span class="line"><span> * | FunctionCall</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type MumberAccessExpressionOrFunctionCallExpression =</span></span>
<span class="line"><span>  | MumberAccessExpression</span></span>
<span class="line"><span>  | FunctionCall;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 成员属性访问表达式</span></span>
<span class="line"><span> * 把this,super,标识符,都归到这类，因为他们都有相同的特征</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * MumberAccessExpression</span></span>
<span class="line"><span> * : This</span></span>
<span class="line"><span> * | Super</span></span>
<span class="line"><span> * | Identifier</span></span>
<span class="line"><span> * | MumberAccessExpression &#39;.&#39; Identifier</span></span>
<span class="line"><span> * | MumberAccessExpression &#39;[&#39; Expression &#39;]&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type MumberAccessExpression =</span></span>
<span class="line"><span>  | This</span></span>
<span class="line"><span>  | Super</span></span>
<span class="line"><span>  | Identifier</span></span>
<span class="line"><span>  | _MumberAccessExpression;</span></span>
<span class="line"><span>export interface _MumberAccessExpression extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;MumberAccessExpression&#39;;</span></span>
<span class="line"><span>  object: MumberAccessExpression;</span></span>
<span class="line"><span>  property: Identifier | Expression;</span></span>
<span class="line"><span>  isIndex: boolean;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * FunctionCall</span></span>
<span class="line"><span> * : Calee Arguments</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface FunctionCall extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;FunctionCall&#39;;</span></span>
<span class="line"><span>  calee: Calee;</span></span>
<span class="line"><span>  args: Arguments;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Calee</span></span>
<span class="line"><span> * : MumberAccessExpression</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type Calee = MumberAccessExpression;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Arguments</span></span>
<span class="line"><span> * : &#39;(&#39; AssignExpression &#39;)&#39;</span></span>
<span class="line"><span> * | &#39;(&#39; &#39;)&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type Arguments = Array&lt;AssignExpression&gt;;</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * This</span></span>
<span class="line"><span> * : &#39;this&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface This extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;this&#39;;</span></span>
<span class="line"><span>  name: string;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Super</span></span>
<span class="line"><span> * : &#39;super&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface Super extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;super&#39;;</span></span>
<span class="line"><span>  name: string;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Identifier</span></span>
<span class="line"><span> * : [\w]+</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface Identifier extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;Identifier&#39;;</span></span>
<span class="line"><span>  name: string;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * 括号表达式</span></span>
<span class="line"><span> * BracketedExpression</span></span>
<span class="line"><span> * : &#39;(&#39; Expression &#39;)&#39;</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> * 这里原本可以直接写 BracketedExpression = Expression; 但是这会导致类型循环定义。</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export interface BracketedExpression extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;BracketedExpression&#39;;</span></span>
<span class="line"><span>  expression: Expression;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Literal</span></span>
<span class="line"><span> * : NumberLiteral</span></span>
<span class="line"><span> * | BooleanLiteral</span></span>
<span class="line"><span> * | StringLiteral</span></span>
<span class="line"><span> * | NullLiteral</span></span>
<span class="line"><span> * ;</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>export type Literal =</span></span>
<span class="line"><span>  | NumberLiteral</span></span>
<span class="line"><span>  | BooleanLiteral</span></span>
<span class="line"><span>  | StringLiteral</span></span>
<span class="line"><span>  | NullLiteral;</span></span>
<span class="line"><span>export interface NumberLiteral extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;NumberLiteral&#39;;</span></span>
<span class="line"><span>  value: string;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>export interface BooleanLiteral extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;BooleanLiteral&#39;;</span></span>
<span class="line"><span>  value: string;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>export interface StringLiteral extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;StringLiteral&#39;;</span></span>
<span class="line"><span>  value: string;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>export interface NullLiteral extends AST_BASE_NODE {</span></span>
<span class="line"><span>  type: &#39;NullLiteral&#39;;</span></span>
<span class="line"><span>  value: string;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export type AST_NODE_TYPE =</span></span>
<span class="line"><span>  | &#39;Program&#39;</span></span>
<span class="line"><span>  | &#39;Statement&#39;</span></span>
<span class="line"><span>  | &#39;EmptyStatement&#39;</span></span>
<span class="line"><span>  | &#39;BlockStatement&#39;</span></span>
<span class="line"><span>  | &#39;IfStatement&#39;</span></span>
<span class="line"><span>  | &#39;WhileStatement&#39;</span></span>
<span class="line"><span>  | &#39;IdentifierDeclarationsStatement&#39;</span></span>
<span class="line"><span>  | &#39;VariableDeclaration&#39;</span></span>
<span class="line"><span>  | &#39;FunctionDeclaration&#39;</span></span>
<span class="line"><span>  | &#39;ExpressionStatement&#39;</span></span>
<span class="line"><span>  | &#39;AssignExpression&#39;</span></span>
<span class="line"><span>  | &#39;CommaExpression&#39;</span></span>
<span class="line"><span>  | &#39;TernaryExpression&#39;</span></span>
<span class="line"><span>  | &#39;BineryExpression&#39;</span></span>
<span class="line"><span>  | &#39;MumberAccessExpression&#39;</span></span>
<span class="line"><span>  | &#39;this&#39;</span></span>
<span class="line"><span>  | &#39;super&#39;</span></span>
<span class="line"><span>  | &#39;Identifier&#39;</span></span>
<span class="line"><span>  | &#39;FunctionCall&#39;</span></span>
<span class="line"><span>  | &#39;NumberLiteral&#39;</span></span>
<span class="line"><span>  | &#39;BooleanLiteral&#39;</span></span>
<span class="line"><span>  | &#39;StringLiteral&#39;</span></span>
<span class="line"><span>  | &#39;NullLiteral&#39;</span></span>
<span class="line"><span>  | &#39;BracketedExpression&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export type AST_NODE =</span></span>
<span class="line"><span>  | Program</span></span>
<span class="line"><span>  | Statement</span></span>
<span class="line"><span>  | EmptyStatement</span></span>
<span class="line"><span>  | BlockStatement</span></span>
<span class="line"><span>  | IfStatement</span></span>
<span class="line"><span>  | WhileStatement</span></span>
<span class="line"><span>  | IdentifierDeclarationsStatement</span></span>
<span class="line"><span>  | VariableDeclaration</span></span>
<span class="line"><span>  | FunctionDeclaration</span></span>
<span class="line"><span>  | ExpressionStatement</span></span>
<span class="line"><span>  | Expression /* Expression中以递归下降的方式定义了其他所有表达式 */;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export interface AST_BASE_NODE {</span></span>
<span class="line"><span>  type: AST_NODE_TYPE;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="文法分析的实现" tabindex="-1"><a class="header-anchor" href="#文法分析的实现"><span>文法分析的实现</span></a></h2><p><code>Parser.ts</code></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span>import { TokenType, Token } from &#39;./Tokenizer&#39;;</span></span>
<span class="line"><span>import {</span></span>
<span class="line"><span>  Program,</span></span>
<span class="line"><span>  Statements,</span></span>
<span class="line"><span>  Statement,</span></span>
<span class="line"><span>  EmptyStatement,</span></span>
<span class="line"><span>  BlockStatement,</span></span>
<span class="line"><span>  IfStatement,</span></span>
<span class="line"><span>  WhileStatement,</span></span>
<span class="line"><span>  ExpressionStatement,</span></span>
<span class="line"><span>  IdentifierDeclarationsStatement,</span></span>
<span class="line"><span>  VariableOrFunctionDeclaration,</span></span>
<span class="line"><span>  VariableDeclaration,</span></span>
<span class="line"><span>  VariableDeclarationInit,</span></span>
<span class="line"><span>  FunctionDeclaration,</span></span>
<span class="line"><span>  FormedArguments,</span></span>
<span class="line"><span>  Expression,</span></span>
<span class="line"><span>  CommaExpression,</span></span>
<span class="line"><span>  AssignExpression,</span></span>
<span class="line"><span>  TernaryExpression,</span></span>
<span class="line"><span>  LogicalOrExpression,</span></span>
<span class="line"><span>  LogicalAndExpression,</span></span>
<span class="line"><span>  EqualityExpression,</span></span>
<span class="line"><span>  RelationalExpression,</span></span>
<span class="line"><span>  AdditiveExpression,</span></span>
<span class="line"><span>  MultiplicativeExpression,</span></span>
<span class="line"><span>  PrimaryExpression,</span></span>
<span class="line"><span>  MumberAccessExpressionOrFunctionCallExpression,</span></span>
<span class="line"><span>  MumberAccessExpression,</span></span>
<span class="line"><span>  Identifier,</span></span>
<span class="line"><span>  This,</span></span>
<span class="line"><span>  Super,</span></span>
<span class="line"><span>  Arguments,</span></span>
<span class="line"><span>  BracketedExpression,</span></span>
<span class="line"><span>  Literal,</span></span>
<span class="line"><span>  NumberLiteral,</span></span>
<span class="line"><span>  BooleanLiteral,</span></span>
<span class="line"><span>  StringLiteral,</span></span>
<span class="line"><span>  NullLiteral,</span></span>
<span class="line"><span>  BineryExpression,</span></span>
<span class="line"><span>} from &#39;./ast&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export class Parser {</span></span>
<span class="line"><span>  curToken!: Token | null;</span></span>
<span class="line"><span>  tk_idx = 0;</span></span>
<span class="line"><span>  tokens!: Token[];</span></span>
<span class="line"><span>  parse(tokens: Token[]) {</span></span>
<span class="line"><span>    this.tokens = tokens;</span></span>
<span class="line"><span>    this.curToken = this.tokens[(this.tk_idx = 0)];</span></span>
<span class="line"><span>    return this.Program();</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  Program(): Program {</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;Program&#39;,</span></span>
<span class="line"><span>      statements: this.Statements(),</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  Statements(stopAt?: TokenType): Statements {</span></span>
<span class="line"><span>    let statements = [this.Statement()];</span></span>
<span class="line"><span>    while (this.curToken != null &amp;&amp; this.curToken?.type != stopAt) {</span></span>
<span class="line"><span>      statements.push(this.Statement());</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return statements;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  Statement(): Statement {</span></span>
<span class="line"><span>    switch (this.curToken?.type) {</span></span>
<span class="line"><span>      case &#39;;&#39;:</span></span>
<span class="line"><span>        return this.EmptyStatement();</span></span>
<span class="line"><span>      case &#39;{&#39;:</span></span>
<span class="line"><span>        return this.BlockStatement();</span></span>
<span class="line"><span>      case &#39;if&#39;:</span></span>
<span class="line"><span>        return this.IfStatement();</span></span>
<span class="line"><span>      case &#39;while&#39;:</span></span>
<span class="line"><span>        return this.WhileStatement();</span></span>
<span class="line"><span>      case &#39;def&#39;:</span></span>
<span class="line"><span>        return this.IdentifierDeclarationsStatement();</span></span>
<span class="line"><span>      default:</span></span>
<span class="line"><span>        return this.ExpressionStatement();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  EmptyStatement(): EmptyStatement {</span></span>
<span class="line"><span>    this.eat(&#39;;&#39;);</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;EmptyStatement&#39;,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  BlockStatement(): BlockStatement {</span></span>
<span class="line"><span>    this.eat(&#39;{&#39;);</span></span>
<span class="line"><span>    let statements = this.curToken?.type != &#39;}&#39; ? this.Statements(&#39;}&#39;) : [];</span></span>
<span class="line"><span>    this.eat(&#39;}&#39;);</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;BlockStatement&#39;,</span></span>
<span class="line"><span>      statements,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  IfStatement(): IfStatement {</span></span>
<span class="line"><span>    this.eat(&#39;if&#39;);</span></span>
<span class="line"><span>    this.eat(&#39;(&#39;);</span></span>
<span class="line"><span>    let condition = this.Expression();</span></span>
<span class="line"><span>    this.eat(&#39;)&#39;);</span></span>
<span class="line"><span>    let case1 = this.Statement();</span></span>
<span class="line"><span>    let case2: Statement | undefined;</span></span>
<span class="line"><span>    if (this.curToken?.type == &#39;else&#39;) {</span></span>
<span class="line"><span>      this.eat(&#39;else&#39;);</span></span>
<span class="line"><span>      case2 = this.Statement();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;IfStatement&#39;,</span></span>
<span class="line"><span>      condition,</span></span>
<span class="line"><span>      case1,</span></span>
<span class="line"><span>      case2,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  WhileStatement(): WhileStatement {</span></span>
<span class="line"><span>    this.eat(&#39;while&#39;);</span></span>
<span class="line"><span>    this.eat(&#39;(&#39;);</span></span>
<span class="line"><span>    let condition = this.Expression();</span></span>
<span class="line"><span>    this.eat(&#39;)&#39;);</span></span>
<span class="line"><span>    let statement = this.Statement();</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;WhileStatement&#39;,</span></span>
<span class="line"><span>      condition,</span></span>
<span class="line"><span>      statement,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  ExpressionStatement(): ExpressionStatement {</span></span>
<span class="line"><span>    let expression = this.Expression();</span></span>
<span class="line"><span>    this.eat(&#39;;&#39;);</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;ExpressionStatement&#39;,</span></span>
<span class="line"><span>      expression,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  IdentifierDeclarationsStatement(): IdentifierDeclarationsStatement {</span></span>
<span class="line"><span>    this.eat(&#39;def&#39;);</span></span>
<span class="line"><span>    let declarations = [this.VariableOrFunctionDeclaration()];</span></span>
<span class="line"><span>    while (this.curToken?.type == &#39;,&#39;) {</span></span>
<span class="line"><span>      this.eat(&#39;,&#39;);</span></span>
<span class="line"><span>      declarations.push(this.VariableOrFunctionDeclaration());</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    this.eat(&#39;;&#39;);</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;IdentifierDeclarationsStatement&#39;,</span></span>
<span class="line"><span>      declarations,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  VariableOrFunctionDeclaration(): VariableOrFunctionDeclaration {</span></span>
<span class="line"><span>    let identifier = this.eat(&#39;Identifier&#39;).value;</span></span>
<span class="line"><span>    switch (this.curToken?.type) {</span></span>
<span class="line"><span>      case &#39;(&#39;:</span></span>
<span class="line"><span>        return this.FunctionDeclaration(identifier);</span></span>
<span class="line"><span>      default:</span></span>
<span class="line"><span>        return this.VariableDeclaration(identifier);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  VariableDeclaration(variableName: string): VariableDeclaration {</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;VariableDeclaration&#39;,</span></span>
<span class="line"><span>      name: variableName,</span></span>
<span class="line"><span>      value: this.VariableDeclarationInit(),</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  VariableDeclarationInit(): VariableDeclarationInit {</span></span>
<span class="line"><span>    if (this.curToken?.type == &#39;AssignOpSimple&#39;) {</span></span>
<span class="line"><span>      this.eat(&#39;AssignOpSimple&#39;);</span></span>
<span class="line"><span>      return this.LogicalOrExpression();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return undefined;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  FunctionDeclaration(functionName: string): FunctionDeclaration {</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;FunctionDeclaration&#39;,</span></span>
<span class="line"><span>      name: functionName,</span></span>
<span class="line"><span>      FormedArguments: this.FormedArguments(),</span></span>
<span class="line"><span>      statements: this.BlockStatement(),</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  FormedArguments(): FormedArguments {</span></span>
<span class="line"><span>    this.eat(&#39;(&#39;);</span></span>
<span class="line"><span>    let args: VariableOrFunctionDeclaration[] = [];</span></span>
<span class="line"><span>    while (this.curToken?.type == &#39;def&#39;) {</span></span>
<span class="line"><span>      this.eat(&#39;def&#39;);</span></span>
<span class="line"><span>      args.push(this.VariableOrFunctionDeclaration());</span></span>
<span class="line"><span>      // @ts-ignore</span></span>
<span class="line"><span>      if (this.curToken.type == &#39;,&#39;) this.eat(&#39;,&#39;);</span></span>
<span class="line"><span>      else break;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    this.eat(&#39;)&#39;);</span></span>
<span class="line"><span>    return args;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  Expression(): Expression {</span></span>
<span class="line"><span>    return this.CommaExpression();</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  CommaExpression(): CommaExpression {</span></span>
<span class="line"><span>    let exp = this.AssignExpression();</span></span>
<span class="line"><span>    if (this.curToken?.type == &#39;,&#39;) {</span></span>
<span class="line"><span>      let exps = [exp];</span></span>
<span class="line"><span>      while (this.curToken?.type == &#39;,&#39;) {</span></span>
<span class="line"><span>        this.eat(&#39;,&#39;);</span></span>
<span class="line"><span>        exps.push(this.AssignExpression());</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>      return {</span></span>
<span class="line"><span>        type: &#39;CommaExpression&#39;,</span></span>
<span class="line"><span>        expressions: exps,</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return exp;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  AssignExpression(): AssignExpression {</span></span>
<span class="line"><span>    let left: AssignExpression = this.TernaryExpression();</span></span>
<span class="line"><span>    while (</span></span>
<span class="line"><span>      (left.type == &#39;MumberAccessExpression&#39; || left.type == &#39;Identifier&#39;) &amp;&amp;</span></span>
<span class="line"><span>      (this.curToken?.type == &#39;AssignOpSimple&#39; ||</span></span>
<span class="line"><span>        this.curToken?.type == &#39;AssignOpComplex&#39;)</span></span>
<span class="line"><span>    ) {</span></span>
<span class="line"><span>      let operator = this.eat(this.curToken.type).value;</span></span>
<span class="line"><span>      let right = this.AssignExpression();</span></span>
<span class="line"><span>      left = {</span></span>
<span class="line"><span>        type: &#39;AssignExpression&#39;,</span></span>
<span class="line"><span>        operator,</span></span>
<span class="line"><span>        left,</span></span>
<span class="line"><span>        right,</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return left;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  TernaryExpression(): TernaryExpression {</span></span>
<span class="line"><span>    let condition: TernaryExpression = this.LogicalOrExpression();</span></span>
<span class="line"><span>    if (this.curToken?.type == &#39;TernaryOp?&#39;) {</span></span>
<span class="line"><span>      this.eat(&#39;TernaryOp?&#39;);</span></span>
<span class="line"><span>      let case1 = this.TernaryExpression();</span></span>
<span class="line"><span>      this.eat(&#39;TernaryOp:&#39;);</span></span>
<span class="line"><span>      let case2 = this.TernaryExpression();</span></span>
<span class="line"><span>      return {</span></span>
<span class="line"><span>        type: &#39;TernaryExpression&#39;,</span></span>
<span class="line"><span>        condition,</span></span>
<span class="line"><span>        case1,</span></span>
<span class="line"><span>        case2,</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return condition;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  LogicalOrExpression(): LogicalOrExpression {</span></span>
<span class="line"><span>    return this.BineryExpression(this.LogicalAndExpression, &#39;LogicalOr&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  LogicalAndExpression(): LogicalAndExpression {</span></span>
<span class="line"><span>    return this.BineryExpression(this.EqualityExpression, &#39;LogicalAnd&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  EqualityExpression(): EqualityExpression {</span></span>
<span class="line"><span>    return this.BineryExpression(this.RelationalExpression, &#39;EqualityOp&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  RelationalExpression(): RelationalExpression {</span></span>
<span class="line"><span>    return this.BineryExpression(this.AdditiveExpression, &#39;RelationalOp&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  AdditiveExpression(): AdditiveExpression {</span></span>
<span class="line"><span>    return this.BineryExpression(this.MultiplicativeExpression, &#39;AddOp&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  MultiplicativeExpression(): MultiplicativeExpression {</span></span>
<span class="line"><span>    return this.BineryExpression(this.PrimaryExpression, &#39;MutOp&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  PrimaryExpression(): PrimaryExpression {</span></span>
<span class="line"><span>    switch (this.curToken?.type) {</span></span>
<span class="line"><span>      case &#39;Identifier&#39;:</span></span>
<span class="line"><span>      case &#39;this&#39;:</span></span>
<span class="line"><span>      case &#39;super&#39;:</span></span>
<span class="line"><span>        return this.MumberAccessExpressionOrFunctionCallExpression();</span></span>
<span class="line"><span>      case &#39;(&#39;:</span></span>
<span class="line"><span>        return this.BracketedExpression();</span></span>
<span class="line"><span>      default:</span></span>
<span class="line"><span>        return this.Literal();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  MumberAccessExpressionOrFunctionCallExpression(): MumberAccessExpressionOrFunctionCallExpression {</span></span>
<span class="line"><span>    let mumberExp = this.MumberAccessExpression();</span></span>
<span class="line"><span>    if (this.curToken?.type == &#39;(&#39;) {</span></span>
<span class="line"><span>      return {</span></span>
<span class="line"><span>        type: &#39;FunctionCall&#39;,</span></span>
<span class="line"><span>        calee: mumberExp,</span></span>
<span class="line"><span>        args: this.Arguments(),</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return mumberExp;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  MumberAccessExpression(): MumberAccessExpression {</span></span>
<span class="line"><span>    let object!: MumberAccessExpression;</span></span>
<span class="line"><span>    switch (this.curToken?.type) {</span></span>
<span class="line"><span>      case &#39;this&#39;:</span></span>
<span class="line"><span>        object = this.This();</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      case &#39;super&#39;:</span></span>
<span class="line"><span>        object = this.Super();</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      case &#39;Identifier&#39;:</span></span>
<span class="line"><span>        object = this.Identifier();</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      default:</span></span>
<span class="line"><span>        throw new SyntaxError(`unexpectted token:${this.curToken?.value}`);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // @ts-ignore</span></span>
<span class="line"><span>    while (this.curToken?.type == &#39;.&#39; || this.curToken.type == &#39;[&#39;) {</span></span>
<span class="line"><span>      let property!: Identifier | Expression;</span></span>
<span class="line"><span>      let isIndex = false;</span></span>
<span class="line"><span>      if (this.curToken.type == &#39;.&#39;) {</span></span>
<span class="line"><span>        this.eat(&#39;.&#39;);</span></span>
<span class="line"><span>        property = this.Identifier();</span></span>
<span class="line"><span>        isIndex = false;</span></span>
<span class="line"><span>      } else if (this.curToken.type == &#39;[&#39;) {</span></span>
<span class="line"><span>        this.eat(&#39;[&#39;);</span></span>
<span class="line"><span>        property = this.Expression();</span></span>
<span class="line"><span>        this.eat(&#39;]&#39;);</span></span>
<span class="line"><span>        isIndex = true;</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>      object = {</span></span>
<span class="line"><span>        type: &#39;MumberAccessExpression&#39;,</span></span>
<span class="line"><span>        object: object,</span></span>
<span class="line"><span>        property: property,</span></span>
<span class="line"><span>        isIndex,</span></span>
<span class="line"><span>      };</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return object;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  This(): This {</span></span>
<span class="line"><span>    let ts = this.eat(&#39;this&#39;).value;</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;this&#39;,</span></span>
<span class="line"><span>      name: ts,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  Super(): Super {</span></span>
<span class="line"><span>    let sp = this.eat(&#39;super&#39;).value;</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;super&#39;,</span></span>
<span class="line"><span>      name: sp,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  Identifier(): Identifier {</span></span>
<span class="line"><span>    let id = this.eat(&#39;Identifier&#39;).value;</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;Identifier&#39;,</span></span>
<span class="line"><span>      name: id,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  Arguments(): Arguments {</span></span>
<span class="line"><span>    this.eat(&#39;(&#39;);</span></span>
<span class="line"><span>    let args: Array&lt;AssignExpression&gt; = [];</span></span>
<span class="line"><span>    if (this.curToken?.type == &#39;)&#39;) {</span></span>
<span class="line"><span>      this.eat(&#39;)&#39;);</span></span>
<span class="line"><span>      return args;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    args.push(this.AssignExpression());</span></span>
<span class="line"><span>    if (this.curToken?.type == &#39;,&#39;) {</span></span>
<span class="line"><span>      this.eat(&#39;,&#39;);</span></span>
<span class="line"><span>      args.push(this.AssignExpression());</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    this.eat(&#39;)&#39;);</span></span>
<span class="line"><span>    return args;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  BracketedExpression(): BracketedExpression {</span></span>
<span class="line"><span>    this.eat(&#39;(&#39;);</span></span>
<span class="line"><span>    let expression = this.Expression();</span></span>
<span class="line"><span>    this.eat(&#39;)&#39;);</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;BracketedExpression&#39;,</span></span>
<span class="line"><span>      expression,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  Literal(): Literal {</span></span>
<span class="line"><span>    switch (this.curToken?.type) {</span></span>
<span class="line"><span>      case &#39;Number&#39;:</span></span>
<span class="line"><span>        return this.NumberLiteral();</span></span>
<span class="line"><span>      case &#39;String&#39;:</span></span>
<span class="line"><span>        return this.StringLiteral();</span></span>
<span class="line"><span>      case &#39;null&#39;:</span></span>
<span class="line"><span>        return this.NullLiteral();</span></span>
<span class="line"><span>      case &#39;Boolean&#39;:</span></span>
<span class="line"><span>        return this.BooleanLiteral();</span></span>
<span class="line"><span>      default:</span></span>
<span class="line"><span>        throw new SyntaxError(`unknow Literal: ${this.curToken?.value}`);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  NumberLiteral(): NumberLiteral {</span></span>
<span class="line"><span>    let val = this.eat(&#39;Number&#39;).value;</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;NumberLiteral&#39;,</span></span>
<span class="line"><span>      value: val,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  BooleanLiteral(): BooleanLiteral {</span></span>
<span class="line"><span>    let val = this.eat(&#39;Boolean&#39;).value;</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;BooleanLiteral&#39;,</span></span>
<span class="line"><span>      value: val,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  StringLiteral(): StringLiteral {</span></span>
<span class="line"><span>    let val = this.eat(&#39;String&#39;).value;</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;StringLiteral&#39;,</span></span>
<span class="line"><span>      value: val,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  NullLiteral(): NullLiteral {</span></span>
<span class="line"><span>    let val = this.eat(&#39;null&#39;).value;</span></span>
<span class="line"><span>    return {</span></span>
<span class="line"><span>      type: &#39;NullLiteral&#39;,</span></span>
<span class="line"><span>      value: val,</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  BineryExpression&lt;ChildNode, operatorType extends TokenType&gt;(</span></span>
<span class="line"><span>    childBuilder: () =&gt; ChildNode,</span></span>
<span class="line"><span>    operatorType: operatorType</span></span>
<span class="line"><span>  ): ChildNode | BineryExpression&lt;ChildNode, operatorType&gt; {</span></span>
<span class="line"><span>    let left: ChildNode | BineryExpression&lt;ChildNode, operatorType&gt; =</span></span>
<span class="line"><span>      childBuilder.apply(this);</span></span>
<span class="line"><span>    while (this.curToken?.type == operatorType) {</span></span>
<span class="line"><span>      let operator = this.eat(operatorType).value;</span></span>
<span class="line"><span>      let right = childBuilder.apply(this);</span></span>
<span class="line"><span>      left = {</span></span>
<span class="line"><span>        type: &#39;BineryExpression&#39;,</span></span>
<span class="line"><span>        operator,</span></span>
<span class="line"><span>        left,</span></span>
<span class="line"><span>        right,</span></span>
<span class="line"><span>      } as BineryExpression&lt;ChildNode, operatorType&gt;;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return left;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  eat(tkt: TokenType) {</span></span>
<span class="line"><span>    if (this.curToken?.type != tkt) {</span></span>
<span class="line"><span>      throw new SyntaxError(</span></span>
<span class="line"><span>        `expected:&#39;${tkt}&#39;;but actually get:&#39;${this.curToken?.value}&#39;`</span></span>
<span class="line"><span>      );</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    let token = this.tokens[this.tk_idx];</span></span>
<span class="line"><span>    this.curToken =</span></span>
<span class="line"><span>      this.tk_idx + 1 &lt; this.tokens.length ? this.tokens[++this.tk_idx] : null;</span></span>
<span class="line"><span>    return token;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="解释器的实现" tabindex="-1"><a class="header-anchor" href="#解释器的实现"><span>解释器的实现</span></a></h2><p><code>Interpreater.ts</code></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#e1e4e8;--shiki-dark:#E6E6E6;--shiki-light-bg:#24292e;--shiki-dark-bg:#222222;"><pre class="shiki shiki-themes github-dark slack-dark vp-code"><code><span class="line"><span>import { AST_NODE } from &#39;./ast&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export class Interpreater {</span></span>
<span class="line"><span>  /**</span></span>
<span class="line"><span>   * 暂时的想法是，进入一个块作用域，就创建一个上下文对象，压入栈顶，</span></span>
<span class="line"><span>   * 当要在该作用域定义变量时，把变量存储到栈顶的上下文对象中。</span></span>
<span class="line"><span>   * 当要寻找一个变量的值时，则从栈顶往栈底遍历。</span></span>
<span class="line"><span>   * 当离开一个作用域时，弹出栈顶上下文对象，并将其销毁</span></span>
<span class="line"><span>   */</span></span>
<span class="line"><span>  ctxIdx = 0; // 上下文栈指针，第0个栈为系统栈</span></span>
<span class="line"><span>  ctxStack: Array&lt;Map&lt;string, any&gt;&gt; = [new Map()]; // 上下文对象栈</span></span>
<span class="line"><span>  constructor() {}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  exec(node?: AST_NODE): any {</span></span>
<span class="line"><span>    if (!node) return undefined;</span></span>
<span class="line"><span>    switch (node.type) {</span></span>
<span class="line"><span>      case &#39;Program&#39;:</span></span>
<span class="line"><span>      case &#39;BlockStatement&#39;:</span></span>
<span class="line"><span>        // 执行代码块，返回最后一条语句的值</span></span>
<span class="line"><span>        this.ctxIdx++;</span></span>
<span class="line"><span>        let res = node.statements.map((stm) =&gt; this.exec(stm)).pop();</span></span>
<span class="line"><span>        this.ctxIdx--;</span></span>
<span class="line"><span>        return res;</span></span>
<span class="line"><span>      case &#39;EmptyStatement&#39;:</span></span>
<span class="line"><span>        return undefined;</span></span>
<span class="line"><span>      case &#39;IfStatement&#39;:</span></span>
<span class="line"><span>        // TODO: 需要考虑 return 和 break</span></span>
<span class="line"><span>        if (this.exec(node.condition)) this.exec(node.case1);</span></span>
<span class="line"><span>        else if (node.case2) this.exec(node.case2);</span></span>
<span class="line"><span>        return undefined;</span></span>
<span class="line"><span>      case &#39;WhileStatement&#39;:</span></span>
<span class="line"><span>        // TODO: 需要考虑return 和 break</span></span>
<span class="line"><span>        while (this.exec(node.condition)) this.exec(node.statement);</span></span>
<span class="line"><span>        // 返回最后执行的一条语句</span></span>
<span class="line"><span>        return undefined;</span></span>
<span class="line"><span>      case &#39;IdentifierDeclarationsStatement&#39;:</span></span>
<span class="line"><span>        // 返回标识符列表</span></span>
<span class="line"><span>        return node.declarations.map((dec) =&gt; this.exec(dec));</span></span>
<span class="line"><span>      case &#39;VariableDeclaration&#39;:</span></span>
<span class="line"><span>        // 变量声明以及初始化</span></span>
<span class="line"><span>        return this.declear(node.name, this.exec(node.value));</span></span>
<span class="line"><span>      case &#39;FunctionDeclaration&#39;:</span></span>
<span class="line"><span>        // 返回函数名</span></span>
<span class="line"><span>        return this.declear(node.name, node);</span></span>
<span class="line"><span>      case &#39;ExpressionStatement&#39;:</span></span>
<span class="line"><span>        this.exec(node.expression);</span></span>
<span class="line"><span>        return undefined;</span></span>
<span class="line"><span>      case &#39;CommaExpression&#39;:</span></span>
<span class="line"><span>        // 计算并返回逗号表达式的最后一个值</span></span>
<span class="line"><span>        return node.expressions.map((exp) =&gt; this.exec(exp)).pop();</span></span>
<span class="line"><span>      case &#39;AssignExpression&#39;:</span></span>
<span class="line"><span>        switch (node.left.type) {</span></span>
<span class="line"><span>          case &#39;Identifier&#39;:</span></span>
<span class="line"><span>            return this.assign(</span></span>
<span class="line"><span>              node.left.name,</span></span>
<span class="line"><span>              node.operator,</span></span>
<span class="line"><span>              this.exec(node.right)</span></span>
<span class="line"><span>            );</span></span>
<span class="line"><span>          default:</span></span>
<span class="line"><span>            throw new SyntaxError(&#39;unimplement functions.&#39;);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      case &#39;TernaryExpression&#39;:</span></span>
<span class="line"><span>        return this.exec(node.condition)</span></span>
<span class="line"><span>          ? this.exec(node.case1)</span></span>
<span class="line"><span>          : this.exec(node.case2);</span></span>
<span class="line"><span>      case &#39;BineryExpression&#39;:</span></span>
<span class="line"><span>        switch (node.operator) {</span></span>
<span class="line"><span>          case &#39;||&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) || this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;&amp;&amp;&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) &amp;&amp; this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;==&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) == this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;!=&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) != this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;&lt;&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) &lt; this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;&gt;&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) &gt; this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;&lt;=&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) &lt;= this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;&gt;=&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) &gt;= this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;+&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) + this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;-&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) - this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;*&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) * this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;/&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) / this.exec(node.right);</span></span>
<span class="line"><span>          case &#39;%&#39;:</span></span>
<span class="line"><span>            return this.exec(node.left) % this.exec(node.right);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        throw new SyntaxError(`unknow operator:${node.operator}`);</span></span>
<span class="line"><span>      case &#39;FunctionCall&#39;:</span></span>
<span class="line"><span>        switch (node.calee.type) {</span></span>
<span class="line"><span>          case &#39;Identifier&#39;:</span></span>
<span class="line"><span>            let symbol = node.calee.name;</span></span>
<span class="line"><span>            let fun: Function | AST_NODE = this.getVal(symbol);</span></span>
<span class="line"><span>            if (fun) {</span></span>
<span class="line"><span>              if (fun instanceof Function) {</span></span>
<span class="line"><span>                let args = node.args.map((arg) =&gt; this.exec(arg));</span></span>
<span class="line"><span>                return fun(args);</span></span>
<span class="line"><span>              } else if (fun.type == &#39;FunctionDeclaration&#39;) {</span></span>
<span class="line"><span>                // 计算实参</span></span>
<span class="line"><span>                let argValus = node.args.map((arg) =&gt; this.exec(arg));</span></span>
<span class="line"><span>                // 进入函数调用</span></span>
<span class="line"><span>                this.ctxIdx++;</span></span>
<span class="line"><span>                // 声明初始化形式参数</span></span>
<span class="line"><span>                let argNames = fun.FormedArguments.map((arg) =&gt; this.exec(arg));</span></span>
<span class="line"><span>                // 把实参传给形式参数</span></span>
<span class="line"><span>                argNames.forEach((name, idx) =&gt;</span></span>
<span class="line"><span>                  this.assign(name, &#39;=&#39;, argValus[idx])</span></span>
<span class="line"><span>                );</span></span>
<span class="line"><span>                let result = this.exec(fun.statements);</span></span>
<span class="line"><span>                this.ctxIdx--;</span></span>
<span class="line"><span>                return result;</span></span>
<span class="line"><span>              }</span></span>
<span class="line"><span>            } else {</span></span>
<span class="line"><span>              throw new SyntaxError(`unimplement function ${symbol}.`);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>          default:</span></span>
<span class="line"><span>            throw new SyntaxError(&#39;unimplement functions.&#39;);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      case &#39;BracketedExpression&#39;:</span></span>
<span class="line"><span>        return this.exec(node.expression);</span></span>
<span class="line"><span>      case &#39;Identifier&#39;:</span></span>
<span class="line"><span>        return this.getVal(node.name);</span></span>
<span class="line"><span>      case &#39;NumberLiteral&#39;:</span></span>
<span class="line"><span>        return Number(node.value);</span></span>
<span class="line"><span>      case &#39;BooleanLiteral&#39;:</span></span>
<span class="line"><span>        return node.value == &#39;true&#39; ? true : false;</span></span>
<span class="line"><span>      case &#39;StringLiteral&#39;:</span></span>
<span class="line"><span>        return node.value;</span></span>
<span class="line"><span>      case &#39;NullLiteral&#39;:</span></span>
<span class="line"><span>        return null;</span></span>
<span class="line"><span>      case &#39;MumberAccessExpression&#39;:</span></span>
<span class="line"><span>      case &#39;super&#39;:</span></span>
<span class="line"><span>      case &#39;this&#39;:</span></span>
<span class="line"><span>        throw new SyntaxError(&#39;unimplement functions.&#39;);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  /**</span></span>
<span class="line"><span>   * 获取当前作用域的上下文对象</span></span>
<span class="line"><span>   * 如果不存在，则要负责创建它</span></span>
<span class="line"><span>   */</span></span>
<span class="line"><span>  getCurrentContext() {</span></span>
<span class="line"><span>    this.ctxStack.length = this.ctxIdx + 1;</span></span>
<span class="line"><span>    let ctx = this.ctxStack[this.ctxIdx];</span></span>
<span class="line"><span>    if (!ctx) {</span></span>
<span class="line"><span>      ctx = this.ctxStack[this.ctxIdx] = new Map&lt;string, any&gt;();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return ctx;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  /**</span></span>
<span class="line"><span>   * 自上而下的到上下文对象栈中去寻找定义了某个符号的上下文对象。</span></span>
<span class="line"><span>   */</span></span>
<span class="line"><span>  findContextWithSymbol(symbol: string) {</span></span>
<span class="line"><span>    this.ctxStack.length = this.ctxIdx + 1;</span></span>
<span class="line"><span>    let stack = this.ctxStack;</span></span>
<span class="line"><span>    for (let idx = this.ctxIdx; 0 &lt;= idx; idx--) {</span></span>
<span class="line"><span>      const ctx = stack[idx];</span></span>
<span class="line"><span>      if (ctx &amp;&amp; ctx.has(symbol)) return ctx;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return null;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  registerFun(funName: string, fun: Function) {</span></span>
<span class="line"><span>    // 把预定义函数定义在系统栈中</span></span>
<span class="line"><span>    this.ctxStack[0].set(funName, fun);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  /**</span></span>
<span class="line"><span>   * 在当前的作用域中声明变量</span></span>
<span class="line"><span>   */</span></span>
<span class="line"><span>  declear(symbol: string, val: any | undefined) {</span></span>
<span class="line"><span>    let ctx = this.getCurrentContext();</span></span>
<span class="line"><span>    if (ctx.has(symbol)) throw new SyntaxError(`redefined symbol: ${symbol}`);</span></span>
<span class="line"><span>    ctx.set(symbol, val);</span></span>
<span class="line"><span>    return symbol;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  /**</span></span>
<span class="line"><span>   * 对一个已经定义的变量赋值</span></span>
<span class="line"><span>   */</span></span>
<span class="line"><span>  assign(symbol: string, operator: string, val: number) {</span></span>
<span class="line"><span>    let ctx = this.findContextWithSymbol(symbol);</span></span>
<span class="line"><span>    if (!ctx) throw new SyntaxError(`undefined symbol: ${symbol}`);</span></span>
<span class="line"><span>    let newVal = ctx.get(symbol);</span></span>
<span class="line"><span>    switch (operator) {</span></span>
<span class="line"><span>      case &#39;=&#39;:</span></span>
<span class="line"><span>        newVal = val;</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      case &#39;+=&#39;:</span></span>
<span class="line"><span>        newVal += val;</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      case &#39;-=&#39;:</span></span>
<span class="line"><span>        newVal -= val;</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      case &#39;*=&#39;:</span></span>
<span class="line"><span>        newVal *= val;</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      case &#39;/=&#39;:</span></span>
<span class="line"><span>        newVal /= val;</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      case &#39;%=&#39;:</span></span>
<span class="line"><span>        newVal %= val;</span></span>
<span class="line"><span>        break;</span></span>
<span class="line"><span>      default:</span></span>
<span class="line"><span>        throw new SyntaxError(`unknow operator:${operator}`);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    ctx.set(symbol, newVal);</span></span>
<span class="line"><span>    return newVal;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  /**</span></span>
<span class="line"><span>   * 获取一个已经定义的变量的值</span></span>
<span class="line"><span>   */</span></span>
<span class="line"><span>  getVal(symbol: string) {</span></span>
<span class="line"><span>    let ctx = this.findContextWithSymbol(symbol);</span></span>
<span class="line"><span>    if (!ctx) throw new SyntaxError(`undefined symbol: ${symbol}`);</span></span>
<span class="line"><span>    return ctx.get(symbol);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2449695354@qq.com">YiguiDing</span><!--]--><!--]--></div></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">MIT Licensed | Copyright © 2019-present Yigui-Ding</div></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-B8JFERy0.js" defer></script>
  </body>
</html>
